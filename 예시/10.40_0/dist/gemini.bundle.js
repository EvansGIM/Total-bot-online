/*! For license information please see gemini.bundle.js.LICENSE.txt */
var e,n,t;!function(e){e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT"}(e||(e={})),function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"}(n||(n={})),function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(t||(t={}));const o=["user","model","function","system"];var i,s,a,r,l,c,u,d;!function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"}(i||(i={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(s||(s={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(a||(a={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(r||(r={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER"}(l||(l={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(c||(c={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"}(u||(u={}));class p extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class m extends p{constructor(e,n){super(e),this.response=n}}class g extends p{constructor(e,n,t,o){super(e),this.status=n,this.statusText=t,this.errorDetails=o}}class h extends p{}!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(d||(d={}));class f{constructor(e,n,t,o,i){this.model=e,this.task=n,this.apiKey=t,this.stream=o,this.requestOptions=i}toString(){var e,n;const t=(null===(e=this.requestOptions)||void 0===e?void 0:e.apiVersion)||"v1beta";let o=`${(null===(n=this.requestOptions)||void 0===n?void 0:n.baseUrl)||"https://generativelanguage.googleapis.com"}/${t}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}async function y(e){var n;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",function(e){const n=[];return(null==e?void 0:e.apiClient)&&n.push(e.apiClient),n.push("genai-js/0.17.2"),n.join(" ")}(e.requestOptions)),t.append("x-goog-api-key",e.apiKey);let o=null===(n=e.requestOptions)||void 0===n?void 0:n.customHeaders;if(o){if(!(o instanceof Headers))try{o=new Headers(o)}catch(e){throw new h(`unable to convert customHeaders value ${JSON.stringify(o)} to Headers: ${e.message}`)}for(const[e,n]of o.entries()){if("x-goog-api-key"===e)throw new h(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new h(`Header name ${e} can only be set using the apiClient field`);t.append(e,n)}}return t}async function w(e,n,t,o,i,s={},a=fetch){const{url:r,fetchOptions:l}=await async function(e,n,t,o,i,s){const a=new f(e,n,t,o,s);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},T(s)),{method:"POST",headers:await y(a),body:i})}}(e,n,t,o,i,s);return async function(e,n,t=fetch){let o;try{o=await t(e,n)}catch(n){!function(e,n){let t=e;throw e instanceof g||e instanceof h||(t=new p(`Error fetching from ${n.toString()}: ${e.message}`),t.stack=e.stack),t}(n,e)}return o.ok||await async function(e,n){let t,o="";try{const n=await e.json();o=n.error.message,n.error.details&&(o+=` ${JSON.stringify(n.error.details)}`,t=n.error.details)}catch(e){}throw new g(`Error fetching from ${n.toString()}: [${e.status} ${e.statusText}] ${o}`,e.status,e.statusText,t)}(o,e),o}(r,l,a)}function T(e){const n={};if(void 0!==(null==e?void 0:e.signal)||(null==e?void 0:e.timeout)>=0){const t=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout((()=>t.abort()),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",(()=>{t.abort()})),n.signal=t.signal}return n}function O(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),N(e.candidates[0]))throw new m(`${v(e)}`,e);return function(e){var n,t,o,i;const s=[];if(null===(t=null===(n=e.candidates)||void 0===n?void 0:n[0].content)||void 0===t?void 0:t.parts)for(const n of null===(i=null===(o=e.candidates)||void 0===o?void 0:o[0].content)||void 0===i?void 0:i.parts)n.text&&s.push(n.text),n.executableCode&&s.push("\n```"+n.executableCode.language+"\n"+n.executableCode.code+"\n```\n"),n.codeExecutionResult&&s.push("\n```\n"+n.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}(e)}if(e.promptFeedback)throw new m(`Text not available. ${v(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),N(e.candidates[0]))throw new m(`${v(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),I(e)[0]}if(e.promptFeedback)throw new m(`Function call not available. ${v(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),N(e.candidates[0]))throw new m(`${v(e)}`,e);return I(e)}if(e.promptFeedback)throw new m(`Function call not available. ${v(e)}`,e)},e}function I(e){var n,t,o,i;const s=[];if(null===(t=null===(n=e.candidates)||void 0===n?void 0:n[0].content)||void 0===t?void 0:t.parts)for(const n of null===(i=null===(o=e.candidates)||void 0===o?void 0:o[0].content)||void 0===i?void 0:i.parts)n.functionCall&&s.push(n.functionCall);return s.length>0?s:void 0}const b=[l.RECITATION,l.SAFETY,l.LANGUAGE];function N(e){return!!e.finishReason&&b.includes(e.finishReason)}function v(e){var n,t,o;let i="";if(e.candidates&&0!==e.candidates.length||!e.promptFeedback){if(null===(o=e.candidates)||void 0===o?void 0:o[0]){const n=e.candidates[0];N(n)&&(i+=`Candidate was blocked due to ${n.finishReason}`,n.finishMessage&&(i+=`: ${n.finishMessage}`))}}else i+="Response was blocked",(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReason)&&(i+=` due to ${e.promptFeedback.blockReason}`),(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReasonMessage)&&(i+=`: ${e.promptFeedback.blockReasonMessage}`);return i}function E(e){return this instanceof E?(this.v=e,this):new E(e)}"function"==typeof SuppressedError&&SuppressedError;const S=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function A(e){const n=[],t=e.getReader();for(;;){const{done:e,value:o}=await t.read();if(e)return O(C(n));n.push(o)}}function x(e){return function(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,i=t.apply(e,n||[]),s=[];return o={},a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o;function a(e){i[e]&&(o[e]=function(n){return new Promise((function(t,o){s.push([e,n,t,o])>1||r(e,n)}))})}function r(e,n){try{(t=i[e](n)).value instanceof E?Promise.resolve(t.value.v).then(l,c):u(s[0][2],t)}catch(e){u(s[0][3],e)}var t}function l(e){r("next",e)}function c(e){r("throw",e)}function u(e,n){e(n),s.shift(),s.length&&r(s[0][0],s[0][1])}}(this,arguments,(function*(){const n=e.getReader();for(;;){const{value:e,done:t}=yield E(n.read());if(t)break;yield yield E(O(e))}}))}function C(e){const n=e[e.length-1],t={promptFeedback:null==n?void 0:n.promptFeedback};for(const n of e){if(n.candidates)for(const e of n.candidates){const n=e.index;if(t.candidates||(t.candidates=[]),t.candidates[n]||(t.candidates[n]={index:e.index}),t.candidates[n].citationMetadata=e.citationMetadata,t.candidates[n].finishReason=e.finishReason,t.candidates[n].finishMessage=e.finishMessage,t.candidates[n].safetyRatings=e.safetyRatings,e.content&&e.content.parts){t.candidates[n].content||(t.candidates[n].content={role:e.content.role||"user",parts:[]});const o={};for(const i of e.content.parts)i.text&&(o.text=i.text),i.functionCall&&(o.functionCall=i.functionCall),i.executableCode&&(o.executableCode=i.executableCode),i.codeExecutionResult&&(o.codeExecutionResult=i.codeExecutionResult),0===Object.keys(o).length&&(o.text=""),t.candidates[n].content.parts.push(o)}}n.usageMetadata&&(t.usageMetadata=n.usageMetadata)}return t}async function R(e,n,t,o){return function(e){const n=function(e){const n=e.getReader();return new ReadableStream({start(e){let t="";return function o(){return n.read().then((({value:n,done:i})=>{if(i)return t.trim()?void e.error(new p("Failed to parse stream")):void e.close();t+=n;let s,a=t.match(S);for(;a;){try{s=JSON.parse(a[1])}catch(n){return void e.error(new p(`Error parsing JSON response: "${a[1]}"`))}e.enqueue(s),t=t.substring(a[0].length),a=t.match(S)}return o()}))}()}})}(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))),[t,o]=n.tee();return{stream:x(t),response:A(o)}}(await w(n,d.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(t),o))}async function M(e,n,t,o){const i=await w(n,d.GENERATE_CONTENT,e,!1,JSON.stringify(t),o);return{response:O(await i.json())}}function L(e){if(null!=e)return"string"==typeof e?{role:"system",parts:[{text:e}]}:e.text?{role:"system",parts:[e]}:e.parts?e.role?e:{role:"system",parts:e.parts}:void 0}function $(e){let n=[];if("string"==typeof e)n=[{text:e}];else for(const t of e)"string"==typeof t?n.push({text:t}):n.push(t);return function(e){const n={role:"user",parts:[]},t={role:"function",parts:[]};let o=!1,i=!1;for(const s of e)"functionResponse"in s?(t.parts.push(s),i=!0):(n.parts.push(s),o=!0);if(o&&i)throw new p("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!o&&!i)throw new p("No content is provided for sending chat message.");return o?n:t}(n)}function k(e){let n;return n=e.contents?e:{contents:[$(e)]},e.systemInstruction&&(n.systemInstruction=L(e.systemInstruction)),n}const U=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],_={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]},H="SILENT_ERROR";class P{constructor(e,n,t,i={}){this.model=n,this.params=t,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==t?void 0:t.history)&&(function(e){let n=!1;for(const t of e){const{role:e,parts:i}=t;if(!n&&"user"!==e)throw new p(`First content should be with role 'user', got ${e}`);if(!o.includes(e))throw new p(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(o)}`);if(!Array.isArray(i))throw new p("Content should have 'parts' property with an array of Parts");if(0===i.length)throw new p("Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const e of i)for(const n of U)n in e&&(s[n]+=1);const a=_[e];for(const n of U)if(!a.includes(n)&&s[n]>0)throw new p(`Content with role '${e}' can't contain '${n}' part`);n=!0}}(t.history),this._history=t.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var t,o,i,s,a,r;await this._sendPromise;const l=$(e),c={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(o=this.params)||void 0===o?void 0:o.generationConfig,tools:null===(i=this.params)||void 0===i?void 0:i.tools,toolConfig:null===(s=this.params)||void 0===s?void 0:s.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(r=this.params)||void 0===r?void 0:r.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),n);let d;return this._sendPromise=this._sendPromise.then((()=>M(this._apiKey,this.model,c,u))).then((e=>{var n;if(e.response.candidates&&e.response.candidates.length>0){this._history.push(l);const t=Object.assign({parts:[],role:"model"},null===(n=e.response.candidates)||void 0===n?void 0:n[0].content);this._history.push(t)}else{const n=v(e.response);n&&console.warn(`sendMessage() was unsuccessful. ${n}. Inspect response object for details.`)}d=e})),await this._sendPromise,d}async sendMessageStream(e,n={}){var t,o,i,s,a,r;await this._sendPromise;const l=$(e),c={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(o=this.params)||void 0===o?void 0:o.generationConfig,tools:null===(i=this.params)||void 0===i?void 0:i.tools,toolConfig:null===(s=this.params)||void 0===s?void 0:s.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(r=this.params)||void 0===r?void 0:r.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),n),d=R(this._apiKey,this.model,c,u);return this._sendPromise=this._sendPromise.then((()=>d)).catch((e=>{throw new Error(H)})).then((e=>e.response)).then((e=>{if(e.candidates&&e.candidates.length>0){this._history.push(l);const n=Object.assign({},e.candidates[0].content);n.role||(n.role="model"),this._history.push(n)}else{const n=v(e);n&&console.warn(`sendMessageStream() was unsuccessful. ${n}. Inspect response object for details.`)}})).catch((e=>{e.message!==H&&console.error(e)})),d}}class D{constructor(e,n,t={}){this.apiKey=e,this._requestOptions=t,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=L(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var t;const o=k(e),i=Object.assign(Object.assign({},this._requestOptions),n);return M(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},o),i)}async generateContentStream(e,n={}){var t;const o=k(e),i=Object.assign(Object.assign({},this._requestOptions),n);return R(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},o),i)}startChat(e){var n;return new P(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const t=function(e,n){var t;let o={model:null==n?void 0:n.model,generationConfig:null==n?void 0:n.generationConfig,safetySettings:null==n?void 0:n.safetySettings,tools:null==n?void 0:n.tools,toolConfig:null==n?void 0:n.toolConfig,systemInstruction:null==n?void 0:n.systemInstruction,cachedContent:null===(t=null==n?void 0:n.cachedContent)||void 0===t?void 0:t.name,contents:[]};const i=null!=e.generateContentRequest;if(e.contents){if(i)throw new h("CountTokensRequest must have one of contents or generateContentRequest, not both.");o.contents=e.contents}else if(i)o=Object.assign(Object.assign({},o),e.generateContentRequest);else{const n=$(e);o.contents=[n]}return{generateContentRequest:o}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),o=Object.assign(Object.assign({},this._requestOptions),n);return async function(e,n,t,o){return(await w(n,d.COUNT_TOKENS,e,!1,JSON.stringify(t),o)).json()}(this.apiKey,this.model,t,o)}async embedContent(e,n={}){const t="string"==typeof(i=e)||Array.isArray(i)?{content:$(i)}:i,o=Object.assign(Object.assign({},this._requestOptions),n);var i;return async function(e,n,t,o){return(await w(n,d.EMBED_CONTENT,e,!1,JSON.stringify(t),o)).json()}(this.apiKey,this.model,t,o)}async batchEmbedContents(e,n={}){const t=Object.assign(Object.assign({},this._requestOptions),n);return async function(e,n,t,o){const i=t.requests.map((e=>Object.assign(Object.assign({},e),{model:n})));return(await w(n,d.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:i}),o)).json()}(this.apiKey,this.model,e,t)}}class G{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new p("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new D(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n){if(!e.name)throw new h("Cached content must contain a `name` field.");if(!e.model)throw new h("Cached content must contain a `model` field.");const t={model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e};return new D(this.apiKey,t,n)}}async function F(e){console.log("ğŸš€ generateDetailHtmlContent í•¨ìˆ˜ ì‹œì‘",{imageUrl:e.imageUrl,originImageUrl:e.originImageUrl,productName:e.productName,hasTextAreas:e.textAreas?.length>0,additionalOptions:e.additionalOptions});try{const{imageUrl:n,textAreas:t=[],originImageUrl:o,productName:i,additionalOptions:s={},apiKey:a,geminiModel:r="gemini-2.0-flash"}=e;if(!a)throw console.error("âŒ Gemini API Keyê°€ ì—†ìŠµë‹ˆë‹¤"),new Error("Gemini API Keyê°€ í•„ìš”í•©ë‹ˆë‹¤");if(!n)throw console.error("âŒ ì´ë¯¸ì§€ URLì´ ì—†ìŠµë‹ˆë‹¤"),new Error("ì´ë¯¸ì§€ URLì´ í•„ìš”í•©ë‹ˆë‹¤");console.log(`ğŸ“Š í…ìŠ¤íŠ¸ ì˜ì—­ ìˆ˜: ${t.length}`),t.length>0&&console.log("ğŸ“ ì²« ë²ˆì§¸ í…ìŠ¤íŠ¸ ì˜ì—­ ìƒ˜í”Œ:",t[0]),console.log(`ğŸ”„ Gemini API ì´ˆê¸°í™” ì¤‘... (ëª¨ë¸: ${r})`);const l=new G(a).getGenerativeModel({model:r,generation_config:{temperature:.3,topP:.8,topK:40}});console.log(`âœ… Gemini API ì´ˆê¸°í™” ì™„ë£Œ (ëª¨ë¸: ${r})`),console.log("ğŸ”„ 1ë‹¨ê³„: ì´ë¯¸ì§€ ë¼ë²¨ë§ ì‹œì‘");let c=null;try{console.log("ğŸ–¼ï¸ ì´ë¯¸ì§€ ë¼ë²¨ë§ ìš”ì²­:",o),c=await ee(o,a,r),console.log("âœ… ì´ë¯¸ì§€ ë¼ë²¨ë§ ê²°ê³¼:",c)}catch(e){console.error("âŒ ì´ë¯¸ì§€ ë¼ë²¨ë§ ì˜¤ë¥˜:",e),c={imageType:"Unknown",mainContent:"ì´ë¯¸ì§€ ë¶„ì„ ì‹¤íŒ¨",marketingAngle:"Unknown",details:"ì´ë¯¸ì§€ ë¼ë²¨ë§ ì¤‘ ì˜¤ë¥˜ ë°œìƒ"},console.log("âš ï¸ ê¸°ë³¸ ì´ë¯¸ì§€ ì •ë³´ ì‚¬ìš©:",c)}console.log("ğŸ”„ 2ë‹¨ê³„: ì´ˆê¸° HTML ìƒì„± ì‹œì‘"),console.time("ì´ˆê¸°HTMLìƒì„±ì‹œê°„");const u=await async function(e){console.log("ğŸ”„ generateInitialHtml í•¨ìˆ˜ ì‹œì‘");const{aiModel:n,imageUrl:t,textAreas:o=[],productName:i,additionalOptions:s={},imageInfo:a}=e;try{console.log("ğŸ”„ ì´ë¯¸ì§€ ë³€í™˜ ì¤‘...");const e=await le(t);console.log("âœ… ì´ë¯¸ì§€ ë³€í™˜ ì™„ë£Œ");const r=JSON.stringify(o,null,2);console.log("ğŸ”„ í”„ë¡¬í”„íŠ¸ êµ¬ì„± ì¤‘...");const l=`\n  ë‹¹ì‹ ì€ ì „ììƒê±°ë˜ ì¹´í”¼ë¼ì´íŒ…ê³¼ HTML ë””ìì¸ ì „ë¬¸ê°€ë¡œ, ë§¤ë ¥ì ì¸ ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ë¥¼ ë§Œë“œëŠ” ì—­í• ì„ ë§¡ê³  ìˆìŠµë‹ˆë‹¤.\n\n  ### ì‘ì—…\n  ì´ ìƒí’ˆ ì´ë¯¸ì§€ì— ëŒ€í•œ ë§¤ë ¥ì ì¸ í•œêµ­ì–´ HTML ì„¹ì…˜ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”.\n  ì¶”ì¶œëœ í…ìŠ¤íŠ¸ ì˜ì—­ì„ ì„¤ë“ë ¥ ìˆëŠ” ë§ˆì¼€íŒ… ì¹´í”¼ë¡œ ë³€í™˜í•˜ê³  ì ì ˆí•œ ìŠ¤íƒ€ì¼ë§ê³¼ ë ˆì´ì•„ì›ƒì„ ì ìš©í•˜ì„¸ìš”.\n\n  ### ìƒí’ˆ ì •ë³´\n  ìƒí’ˆëª…: ${i}\n  ì´ë¯¸ì§€ ìœ í˜•: ${a.imageType||"ì•Œ ìˆ˜ ì—†ìŒ"}\n  ì´ë¯¸ì§€ ë‚´ìš©: ${a.mainContent||"ë¶„ì„ë˜ì§€ ì•ŠìŒ"}\n  ë§ˆì¼€íŒ… ê°ë„: ${a.marketingAngle||"ì•Œ ìˆ˜ ì—†ìŒ"}\n  ì„¸ë¶€ ì •ë³´: ${a.details||"ì‚¬ìš© ë¶ˆê°€"}\n\n  ### í…ìŠ¤íŠ¸ ì˜ì—­ (ì´ë¯¸ì§€ì—ì„œ ì¶”ì¶œ)\n  ${r}\n\n  ### ìš”êµ¬ì‚¬í•­\n  1. HTML ì»¨í…Œì´ë„ˆ div ìƒì„±:\n     - ì¤‘ì•™ ì •ë ¬ ë ˆì´ì•„ì›ƒ\n     - ê³ ìœ  id="${s.uniqueId||`detail-${s.index||0}`}"\n     - í´ë˜ìŠ¤ëŠ” ìƒëµ\n\n  2. ì›ë³¸ ì´ë¯¸ì§€ í¬í•¨:\n     - ì „ì²´ ë„ˆë¹„, ë¹„ìœ¨ ìœ ì§€\n     - img srcëŠ” ë°˜ë“œì‹œ ${t}ë¡œ ì…ë ¥\n     - ìƒí’ˆëª…ì„ ì‚¬ìš©í•œ ì ì ˆí•œ alt í…ìŠ¤íŠ¸\n\n  3. ì •ë³´ ì„¤ëª… ì„¹ì…˜ ì¶”ê°€:\n     - ì´ë¯¸ì§€ ì•„ë˜ì— ì„¸ë ¨ëœ div ìƒì„±\n     - ì´ë¯¸ì§€ì˜ í…ìŠ¤íŠ¸ë¥¼ í™œìš©í•˜ë˜ ê°œì„ :\n       * ì¤‘êµ­ì–´ í…ìŠ¤íŠ¸ë¥¼ ìì—°ìŠ¤ëŸ½ê³  ë§¤ë ¥ì ì¸ í•œêµ­ì–´ë¡œ ë²ˆì—­\n       * MZì„¸ëŒ€ ì¹œí™”ì ì´ê³  ë§ˆì¼€íŒ… ì§€í–¥ì ì¸ ì–¸ì–´ ì‚¬ìš©\n       * ì£¼ìš” ìƒí’ˆ íŠ¹ì§•ê³¼ ì´ì  ê°•ì¡°\n     - ê¹”ë”í•˜ê³  ì „ë¬¸ì ì¸ ìŠ¤íƒ€ì¼ë§ê³¼ ì ì ˆí•œ ê°„ê²© ì ìš©\n\n  4. ìŠ¤íƒ€ì¼ë§ ì›ì¹™:\n     - í˜„ì¬ í…ìŠ¤íŠ¸ ì˜ì—­ í¬ê¸°, í°íŠ¸, ìƒ‰ìƒì„ ìµœëŒ€í•œ ì°¸ì¡°\n     - ì¤‘êµ­ì–´ì— ë¹„í•´ ë„ˆë¬´ ê¸¸ê±°ë‚˜ ë„ˆë¬´ ì§§ì§€ ì•Šê²Œ êµ¬ì„±\n     - ë‹¨ë½ì„ ê°„ê²°í•˜ê³  ì½ê¸° ì‰½ê²Œ ìœ ì§€\n     - ì ì ˆí•œ ì¤„ ë†’ì´ë¡œ ê°€ë…ì„± ìœ ì§€\n     - ìƒí’ˆ ì´ë¯¸ì§€ë¥¼ ë³´ì™„í•˜ëŠ” ìƒ‰ìƒ ì‚¬ìš©\n     - textëŠ” p, span íƒœê·¸ë§Œ ì‚¬ìš©í•´ì„œ ìŠ¤íƒ€ì¼ë§\n     - text positionì€ absoluteë¡œ ì ìš©\n\n  ### ì¶œë ¥ í˜•ì‹\n  ì¸ë¼ì¸ CSS ìŠ¤íƒ€ì¼ë§ì´ í¬í•¨ëœ HTML ì½”ë“œë§Œ ë°˜í™˜í•˜ì„¸ìš”. ì„¤ëª…ì´ë‚˜ ì¶”ê°€ í…ìŠ¤íŠ¸ëŠ” ì—†ì–´ì•¼ í•©ë‹ˆë‹¤.\n  ìµœì¢… HTMLì€ ë” í° í˜ì´ì§€ì— ì‚½ì…ë  ìˆ˜ ìˆëŠ” ë‹¨ì¼ div ì»¨í…Œì´ë„ˆì—¬ì•¼ í•©ë‹ˆë‹¤.\n  `;console.log("âœ… êµ¬ì„±ëœ í”„ë¡¬í”„íŠ¸: "),console.log(l),console.log(`ğŸ“ í”„ë¡¬í”„íŠ¸ ê¸¸ì´: ${l.length}ì`),console.log("ğŸ”„ Gemini API í˜¸ì¶œ ì¤‘..."),console.time("GeminiAPIí˜¸ì¶œì‹œê°„");const c=await n.generateContent([l,e]);console.timeEnd("GeminiAPIí˜¸ì¶œì‹œê°„");const u=await c.response,d=await u.text();console.log(`âœ… Gemini API ì‘ë‹µ ë°›ìŒ (ê¸¸ì´: ${d.length}ì)`),console.log("ğŸ”„ ì‘ë‹µì—ì„œ HTML ì¶”ì¶œ ì¤‘...");const p=function(e){const n=e.match(/<div[\s\S]*<\/div>/m);return n?n[0].trim():e.replace(/```html\n?/g,"").replace(/```/g,"").trim()}(d);return p?(console.log(`âœ… HTML ì¶”ì¶œ ì„±ê³µ (ê¸¸ì´: ${p.length}ì)`),console.log("ğŸ“ HTML ë¯¸ë¦¬ë³´ê¸°:",p.substring(0,150)+"...")):(console.warn("âš ï¸ HTML ì¶”ì¶œ ì‹¤íŒ¨. ì›ì‹œ ì‘ë‹µ ë°˜í™˜"),console.log("ğŸ“ ì›ì‹œ ì‘ë‹µ ë¯¸ë¦¬ë³´ê¸°:",d.substring(0,150)+"...")),p||d}catch(e){return console.error("âŒ ì´ˆê¸° HTML ìƒì„± ì˜¤ë¥˜:",e),null}}({aiModel:l,imageUrl:n,textAreas:t,productName:i,additionalOptions:s,imageInfo:c});if(console.timeEnd("ì´ˆê¸°HTMLìƒì„±ì‹œê°„"),!u)throw console.error("âŒ ì´ˆê¸° HTML ìƒì„± ì‹¤íŒ¨"),new Error("ì´ˆê¸° HTML ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");console.log(`âœ… ì´ˆê¸° HTML ìƒì„± ì™„ë£Œ (ê¸¸ì´: ${u.length}ì)`),console.log("ğŸ“ ì´ˆê¸° HTML ë¯¸ë¦¬ë³´ê¸°:",u.substring(0,150)+"..."),console.log("ğŸ”„ 3ë‹¨ê³„: HTML ìì²´ í‰ê°€ ë° ê°œì„  ë£¨í”„ ì‹œì‘");let d=u,p=0,m=u,g=null;for(let e=0;e<2;e++)try{console.log(`ğŸ”„ ê°œì„  ë°˜ë³µ ${e+1} ì‹œì‘`),console.time(`ê°œì„ ë°˜ë³µ${e+1}ì‹œê°„`);const o=await B({aiModel:l,currentHtml:d,imageUrl:n,textAreas:t,productName:i,additionalOptions:s,imageInfo:c,iterationNumber:e+1});if(console.timeEnd(`ê°œì„ ë°˜ë³µ${e+1}ì‹œê°„`),d=o.html,console.log(`âœ… ê°œì„  ë°˜ë³µ ${e+1} ì™„ë£Œ, ì ìˆ˜: ${o.score}`),o.review&&console.log("ğŸ“Š ì„¸ë¶€ í‰ê°€:",{ì¹´í”¼ë¼ì´íŒ…:`${o.review.copywriting?.score||"?"}/10`,ë ˆì´ì•„ì›ƒ:`${o.review.layout?.score||"?"}/10`,ìŠ¤íƒ€ì¼ë§:`${o.review.styling?.score||"?"}/10`,ë§ˆì¼€íŒ…:`${o.review.marketing?.score||"?"}/10`}),o.improvements&&o.improvements.length>0&&console.log("ğŸ› ï¸ ê°œì„  ì‚¬í•­:",o.improvements),o.score>p&&(p=o.score,m=d,g=o.review,console.log(`ğŸ† ìƒˆë¡œìš´ ìµœê³  ì ìˆ˜: ${p}`)),p>=9){console.log("ğŸ¯ ëª©í‘œ ì ìˆ˜ ë‹¬ì„±(9.0+). ê°œì„  ë£¨í”„ ì¡°ê¸° ì¢…ë£Œ");break}}catch(n){console.error(`âŒ ìì²´ ê°œì„  ë°˜ë³µ ${e+1} ì¤‘ ì˜¤ë¥˜:`,n),console.log("âš ï¸ í˜„ì¬ê¹Œì§€ì˜ ìµœìƒì˜ HTMLë¡œ ê³„ì† ì§„í–‰");break}console.log(`ğŸ HTML ìì²´ ê°œì„  ë£¨í”„ ì™„ë£Œ, ìµœì¢… ì ìˆ˜: ${p}`),console.log(`ğŸ“ ìµœì¢… HTML ê¸¸ì´: ${m.length}ì`);const h={htmlContent:m,imageInfo:c,additionalOptions:s,score:p,review:g};return console.log("âœ… generateDetailHtmlContent í•¨ìˆ˜ ì™„ë£Œ"),h}catch(n){return console.error("âŒ generateDetailHtmlContent ì¹˜ëª…ì  ì˜¤ë¥˜:",n),console.log("âš ï¸ ê¸°ë³¸ HTML í´ë°± ì‚¬ìš©"),{htmlContent:function(e,n,t={}){console.log("ğŸ”„ generateFallbackHtml í•¨ìˆ˜ ì‹œì‘");const o=`\n  <div id="${t.uniqueId||`detail-${t.index||0}`}" style="margin-bottom: ${t.imageMargin||20}px; text-align: center;" class="detail-image-container">\n    <img src="${e}" alt="${n||"ìƒí’ˆ ì´ë¯¸ì§€"}" style="max-width: 100%; height: auto; display: block; margin: 0 auto;">\n    <div style="padding: 15px; margin-top: 10px; background: #f8f9fa; border-radius: 8px; text-align: left;">\n      <h3 style="margin-top: 0; color: #333; font-size: 18px;">${n||"ìƒí’ˆ ì •ë³´"}</h3>\n      <p style="margin-bottom: 10px; font-size: 14px; line-height: 1.5;">\n        ìƒì„¸ ì •ë³´ëŠ” ì´ë¯¸ì§€ë¥¼ ì°¸ê³ í•´ ì£¼ì„¸ìš”.\n      </p>\n    </div>\n  </div>\n  `;return console.log("âœ… í´ë°± HTML ìƒì„± ì™„ë£Œ"),console.log(`ğŸ“ í´ë°± HTML ê¸¸ì´: ${o.length}ì`),o}(e.imageUrl,e.productName,e.additionalOptions),imageInfo:null,additionalOptions:e.additionalOptions,error:n.message}}}async function B(e){console.log(`ğŸ”„ selfImproveHtml í•¨ìˆ˜ ì‹œì‘ (ë°˜ë³µ ${e.iterationNumber})`);const{aiModel:n,currentHtml:t,imageUrl:o,textAreas:i,productName:s,additionalOptions:a,imageInfo:r,iterationNumber:l}=e;try{console.log("ğŸ”„ ìì²´ ê°œì„  í”„ë¡¬í”„íŠ¸ êµ¬ì„± ì¤‘...");const e=`\n  ë‹¹ì‹ ì€ ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ HTMLì˜ í’ˆì§ˆì„ í‰ê°€í•˜ê³  ìµœì í™”í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.\n\n  ### í˜„ì¬ HTML\n  \`\`\`html\n  ${t}\n  \`\`\`\n\n  ### ìƒí’ˆ ì •ë³´\n  ìƒí’ˆëª…: ${s}\n  ì´ë¯¸ì§€ ìœ í˜•: ${r.imageType||"ì•Œ ìˆ˜ ì—†ìŒ"}\n  ì´ë¯¸ì§€ ë‚´ìš©: ${r.mainContent||"ë¶„ì„ë˜ì§€ ì•ŠìŒ"}\n  ë§ˆì¼€íŒ… ê°ë„: ${r.marketingAngle||"ì•Œ ìˆ˜ ì—†ìŒ"}\n  ì´ë¯¸ì§€ ì‹œí€€ìŠ¤ ìœ„ì¹˜: #${a.index+1}\n\n  ### í…ìŠ¤íŠ¸ ì˜ì—­ (ì´ë¯¸ì§€ì—ì„œ ì¶”ì¶œ)\n  ${JSON.stringify(i,null,2)}\n\n  ### ìì²´ ê²€í†  ì‘ì—… (ë°˜ë³µ ${l})\n  ë‹¤ìŒ ê¸°ì¤€ì— ëŒ€í•´ HTMLì„ ë¹„íŒì ìœ¼ë¡œ í‰ê°€í•´ì£¼ì„¸ìš”:\n\n  1. ì¹´í”¼ë¼ì´íŒ… í’ˆì§ˆ (í•œêµ­ì–´):\n     - í…ìŠ¤íŠ¸ê°€ ìì—°ìŠ¤ëŸ½ê³  ì„¤ë“ë ¥ ìˆìœ¼ë©° ë§ˆì¼€íŒ… ì§€í–¥ì ì¸ê°€?\n     - MZì„¸ëŒ€(ì Šì€ ì„±ì¸) ì¹œí™”ì ì¸ ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?\n     - ì–´ìƒ‰í•œ ì§ì—­ì´ ì—†ëŠ”ê°€?\n\n  2. ë ˆì´ì•„ì›ƒ ë¬´ê²°ì„±:\n     - í…ìŠ¤íŠ¸ ê¸¸ì´ê°€ ì ì ˆí•œê°€(ë„ˆë¬´ ê¸¸ê±°ë‚˜ ì§§ì§€ ì•Šì€ê°€)?\n     - ì—¬ë°±, íŒ¨ë”©, ê°„ê²©ì´ ê· í˜• ì¡í˜”ëŠ”ê°€?\n     - ë ˆì´ì•„ì›ƒì´ ì¢‹ì€ ì‹œê°ì  ê³„ì¸µ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆëŠ”ê°€?\n\n  3. ìŠ¤íƒ€ì¼ë§ íš¨ê³¼:\n     - í°íŠ¸, ìƒ‰ìƒ, ìŠ¤íƒ€ì¼ì´ ì‹œê°ì ìœ¼ë¡œ ë§¤ë ¥ì ì¸ê°€?\n     - ì£¼ìš” í¬ì¸íŠ¸ê°€ ì ì ˆíˆ ê°•ì¡°ë˜ì—ˆëŠ”ê°€?\n     - ìŠ¤íƒ€ì¼ë§ì´ ìƒí’ˆì˜ íŠ¹ì„±ê³¼ ì¼ì¹˜í•˜ëŠ”ê°€?\n\n  4. ë§ˆì¼€íŒ… íš¨ê³¼:\n     - ìƒí’ˆì˜ ì´ì ì„ íš¨ê³¼ì ìœ¼ë¡œ ê°•ì¡°í•˜ëŠ”ê°€?\n     - ì ì¬ì ì¸ ê³ ê° ë‹ˆì¦ˆ/í˜ì¸ í¬ì¸íŠ¸ë¥¼ ë‹¤ë£¨ëŠ”ê°€?\n     - ì „ì²´ ë©”ì‹œì§€ê°€ ì„¤ë“ë ¥ì´ ìˆëŠ”ê°€?\n\n  ### ì¶œë ¥ ì§€ì¹¨\n  1. ë¨¼ì € ê° ê¸°ì¤€ì„ 1-10ì ìœ¼ë¡œ í‰ê°€í•˜ê³  ê°„ëµí•œ ì„¤ëª… ì œê³µ\n  2. 1-10ì ì˜ ì „ì²´ ì ìˆ˜ ì œê³µ\n  3. í•„ìš”í•œ êµ¬ì²´ì ì¸ ê°œì„  ì‚¬í•­ ë‚˜ì—´\n  4. ëª¨ë“  ìˆ˜ì • ì‚¬í•­ì´ ì ìš©ëœ ê°œì„ ëœ HTML ì œê³µ\n\n  ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:\n  \`\`\`json\n  {\n    "review": {\n      "copywriting": {\n        "score": 7,\n        "comments": "í…ìŠ¤íŠ¸ëŠ” ëŒ€ë¶€ë¶„ ìì—°ìŠ¤ëŸ½ì§€ë§Œ..."\n      },\n      "layout": {\n        "score": 8,\n        "comments": "ê°„ê²©ì€ ì¢‹ì§€ë§Œ..."\n      },\n      "styling": {\n        "score": 6,\n        "comments": "ìƒ‰ìƒì´ ë”..."\n      },\n      "marketing": {\n        "score": 7,\n        "comments": "ì´ì ì„ ê°•ì¡°í•˜ì§€ë§Œ..."\n      }\n    },\n    "overallScore": 7.0,\n    "improvements": [\n      "ì œëª©ì„ ë” ë§¤ë ¥ì ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•´...",\n      "ë‹¤ìŒì— ë” ê°•ì¡°...",\n      "ìŠ¤íƒ€ì¼ë§ ë¬¸ì œ ìˆ˜ì •..."\n    ],\n    "improvedHtml": "<div>...ê°œì„ ëœ HTML...</div>"\n  }\n  \`\`\`\n  `;console.log("âœ… ìì²´ ê°œì„  í”„ë¡¬í”„íŠ¸ êµ¬ì„± ì™„ë£Œ"),console.log(`ğŸ“ í”„ë¡¬í”„íŠ¸ ê¸¸ì´: ${e.length}ì`),console.log("ğŸ”„ ìì²´ ê°œì„ ì„ ìœ„í•œ Gemini API í˜¸ì¶œ ì¤‘..."),console.time("ìì²´ê°œì„ APIí˜¸ì¶œì‹œê°„");const o=await n.generateContent(e);console.timeEnd("ìì²´ê°œì„ APIí˜¸ì¶œì‹œê°„");const c=await o.response,u=await c.text();console.log(`âœ… ìì²´ ê°œì„  ì‘ë‹µ ë°›ìŒ (ê¸¸ì´: ${u.length}ì)`),console.log("ğŸ”„ JSON ì‘ë‹µ íŒŒì‹± ì¤‘...");try{const e=function(e){const n=e.match(/```json\n?([\s\S]*?)```/);if(n)return n[1].trim();const t=e.match(/\{[\s\S]*\}/);return t?t[0].trim():e.trim()}(u),n=JSON.parse(e);return console.log("âœ… JSON ì‘ë‹µ íŒŒì‹± ì„±ê³µ"),console.log("ğŸ“Š í‰ê°€ ì ìˆ˜:",{ì „ì²´:n.overallScore,ì¹´í”¼ë¼ì´íŒ…:n.review?.copywriting?.score,ë ˆì´ì•„ì›ƒ:n.review?.layout?.score,ìŠ¤íƒ€ì¼ë§:n.review?.styling?.score,ë§ˆì¼€íŒ…:n.review?.marketing?.score}),n.improvements&&n.improvements.length>0&&console.log("ğŸ› ï¸ ê°œì„  ì‚¬í•­:",n.improvements),n.improvedHtml?console.log(`ğŸ“ ê°œì„ ëœ HTML (ê¸¸ì´: ${n.improvedHtml.length}ì)`):console.warn("âš ï¸ ê°œì„ ëœ HTMLì´ ì—†ìŒ"),{html:n.improvedHtml||t,score:n.overallScore||5,review:n.review||null,improvements:n.improvements||[]}}catch(e){return console.error("âŒ JSON íŒŒì‹± ì˜¤ë¥˜:",e),console.log("ğŸ“ ì›ì‹œ ì‘ë‹µ:",u.substring(0,500)+"..."),{html:t,score:5,review:null,improvements:["JSON íŒŒì‹± ì˜¤ë¥˜ë¡œ ì¸í•œ ìì²´ ê°œì„  ì‹¤íŒ¨"]}}}catch(e){return console.error(`âŒ ìì²´ ê°œì„  ë°˜ë³µ ${l} ì¤‘ ì˜¤ë¥˜:`,e),{html:t,score:5,review:null,improvements:["ìì²´ ê°œì„  ì¤‘ ì˜¤ë¥˜ ë°œìƒ"]}}}async function j(e,n){const{coupangSchema:t,alibabaProductInfo:o,geminiApiKey:i,geminiModel:s="gemini-2.0-flash",defaultSettings:a,applyToAllOptions:r,selectedOptionIndex:l,currentMode:c}=e,u=s;K(n.id,"Starting registration detail generation...");try{const e=t.properties.productPage.properties.commonAttributes.properties.exposedAttributes,s=t.properties.productPage.properties.unexposedAttributes,d=(t.properties.logisticsPage.properties.skuUnitBoxDimension,t.properties.logisticsPage.properties.skuUnitBoxWeight,t.properties.legalPage.properties.notices),p=new G(i).getGenerativeModel({model:u,generation_config:{responseMimeType:"application/json"}});console.log(`ì²˜ë¦¬ ëª¨ë“œ: ${c||(r?"all_options":"single_option")}`),console.log(`ì„ íƒëœ ì˜µì…˜ ì¸ë±ìŠ¤: ${l}`);let m=null;o.allOptions&&o.allOptions.length>0&&(l>=0&&l<o.allOptions.length?(m=o.allOptions[l],console.log("ì„ íƒëœ ì˜µì…˜ ì •ë³´:",m)):o.selectedOption&&(m=o.selectedOption,console.log("ê¸°ë³¸ ì„ íƒ ì˜µì…˜ ì •ë³´:",m))),K(n.id,"Generating exposed attributes... (1/4)"),console.log("Exposed Attributes:");const g=function(e,n,t=null){console.log(e,n,t);const o=[];e.allOf.forEach((e=>{if(e.contains&&e.contains.properties&&e.contains.properties.attributeName){const n=e.contains.properties.attributeName.enum[0],t=e.contains.properties.attributeValue.dropdown&&e.contains.properties.attributeValue.dropdown.length>0;o.push({name:n,required:!0,dropdown:t?e.contains.properties.attributeValue.dropdown:null,guide:e.contains.properties.attributeName.inputGuide||"",example:e.contains.properties.attributeValue.examples?e.contains.properties.attributeValue.examples[0]:""})}}));const i=n.selectedOption||{};let s="";t&&(s=`\n    # TARGET OPTION INFORMATION (HIGHEST PRIORITY):\n    - Option Name: ${t.seoKorName||t.korName||""}\n    - This specific option's name should be prioritized over general product information\n    `);const a=JSON.stringify(n.productAttribute);return`\n    You are a precise AI assistant specialized in creating Coupang product listing attributes.\n    Your task is to generate ONLY the specifically requested exposed attributes for a product listing.\n\n    # CRITICAL INSTRUCTIONS:\n    1. You MUST ONLY generate attributes for the following names: ${o.map((e=>e.name)).join(", ")}\n    2. DO NOT add any additional attribute names that are not in this list\n    3. If a field has dropdown options, you MUST select a value ONLY from that dropdown list\n    4. If appropriate, prioritize values from the product's options and attributes\n    5. Return EXACTLY one value for each attribute name in the required list\n    6. All responses must be in Korean, and all Chinese units must be converted to English units (æ–¤ -> kg, ç  -> size).\n    7. IMPORTANT: If an example value contains specific units (e.g., "2kg", "10cm", "100ml"), MAINTAIN THE SAME UNITS in your response.\n\n    # PRODUCT INFORMATION:\n    - Product Name: ${n.seo?.productName||n.subjectTrans||""}\n    - Brand: ${n.brand||""}\n\n    # PRODUCT ATTRIBUTES:\n    ${a}\n    ${s}\n    # GENERAL OPTION INFORMATION:\n    - Option Name: ${i.korName||""}\n\n    # REQUIRED ATTRIBUTES WITH CONSTRAINTS:\n    ${o.map((e=>`## ${e.name}\n        - Guide: ${e.guide||"No guide available"}\n        - Example: ${e.example||"No example available"}\n        ${e.dropdown?`- MUST choose from: [${e.dropdown.join(", ")}]`:"- No dropdown constraint"}`)).join("\n\n")}\n\n    # HOW TO HANDLE DROPDOWNS:\n    - For attributes with dropdowns: You MUST select a value from the provided options list\n    - If the exact value doesn't exist in the dropdown, find the closest match within the dropdown options\n    - NEVER use values outside the dropdown options for attributes with dropdowns\n\n    # HANDLING UNITS:\n    - If an example value contains specific units (e.g., "2kg", "10cm", "100ml"), you MUST use the SAME UNITS in your response\n    - Do not change units that are provided in examples - maintain consistency with the example format\n    - For example, if the example is "10cm", your response should also use "cm" as the unit, not "mm" or "m"\n\n    # HANDLING COLOR AND SIZE:\n    - When determining "ìƒ‰ìƒ" (Color) and "ì‚¬ì´ì¦ˆ" (Size) attributes:\n    - FIRST check the TARGET OPTION INFORMATION if available\n    - Look for color and size information in the SEO Korean Name or option values\n    - For color, look for terms like "ë ˆë“œ", "ë¸”ë£¨", "í™”ì´íŠ¸", "ë¸”ë™" etc.\n    - For size, look for terms like "S", "M", "L", "XL", "90", "95", "100" etc.\n    - If the target option contains color/size information, use that EXACT information\n    - Only if no specific information exists in the target option, fall back to general product information\n    - Write all values in natural Korean language\n\n    # RESPONSE FORMAT:\n    Return ONLY a valid JSON array containing EXACTLY the attribute names from the required list.\n    Do not include any explanation or text outside the JSON.\n\n    \`\`\`json\n    [\n      {"attributeName": "ìƒ‰ìƒ", "attributeValue": "ë¸”ë™"},\n      {"attributeName": "ì‚¬ì´ì¦ˆ", "attributeValue": "í”„ë¦¬"}\n    ]\n    \`\`\`\n    `}(e,o,m);let h=null;for(let e=1;e<=3;e++)try{const n=await p.generateContent(g),t=await n.response.text();if(h=re(t),h){console.log(`ë…¸ì¶œ ì†ì„± ìƒì„± ì„±ê³µ (ì‹œë„ ${e})`);break}console.warn(`ë…¸ì¶œ ì†ì„± íŒŒì‹± ì‹¤íŒ¨ (ì‹œë„ ${e})`),e<3&&await ce(5e3)}catch(n){console.error(`ë…¸ì¶œ ì†ì„± ìƒì„± ì˜¤ë¥˜ (ì‹œë„ ${e}):`,n),n.message&&n.message.includes("429")?(console.log("Rate Limiting ê°ì§€, 20ì´ˆ ëŒ€ê¸° ì¤‘..."),e<3&&await ce(2e4)):e<3&&await ce(5e3)}await ce(5e3);let f=null;if(!1!==a?.defaultSettings?.enableUnexposedAttributes){K(n.id,"Generating unexposed attributes... (2/4)"),console.log("Unexposed Attributes:");const e=function(e,n,t=null){const o=[];e.allOf.forEach((e=>{if(e.contains&&e.contains.properties&&e.contains.properties.attributeName){const n=e.contains.properties.attributeName.enum[0],t=e.contains.properties.attributeValue.dropdown&&e.contains.properties.attributeValue.dropdown.length>0;o.push({name:n,required:!0,dropdown:t?e.contains.properties.attributeValue.dropdown:null,guide:e.contains.properties.attributeName.inputGuide||"",example:e.contains.properties.attributeValue.examples?e.contains.properties.attributeValue.examples[0]:""})}})),console.log("requiredAttributes:",o),console.log("requiredAttributes:",o.map((e=>`## ${e.name}\n        - Guide: ${e.guide||"No guide available"}\n        - Example: ${e.example||"No example available"}\n        ${e.dropdown?`- MUST choose from: [${e.dropdown.join(", ")}]`:"- No dropdown constraint"}`)).join("\n\n"));const i=n.selectedOption||{};let s="";t&&(s=`\n    # TARGET OPTION INFORMATION (HIGHEST PRIORITY):\n    - Option Name: ${t.seoKorName||t.korName||""}\n    - This specific option's information should be prioritized over general product information\n    `);const a=JSON.stringify(n.productAttribute);return`\n    You are an AI assistant for creating Coupang product attributes.\n    Generate ALL required attributes: ${o.map((e=>e.name)).join(", ")}\n\n    âš ï¸ CRITICAL RULE: For text input fields, you are FORBIDDEN from using "ì•Œìˆ˜ì—†ìŒ", "ì •ë³´ì—†ìŒ", "í•´ë‹¹ì‚¬í•­ì—†ìŒ" or any similar phrases. You MUST provide actual values.\n\n    # PRODUCT INFORMATION:\n    - Product Name: ${n.seo?.productName||n.subjectTrans||""}\n    - Brand: ${n.brand||""}\n    - Product Attributes: ${a}\n    ${s}\n    - Current Option: ${i.korName||""}\n\n    # REQUIRED ATTRIBUTES WITH CONSTRAINTS:\n    ${o.map((e=>`## ${e.name}\n        - Guide: ${e.guide||"No guide available"}\n        - Example: ${e.example||"No example available"}\n        ${e.dropdown?`- MUST choose from: [${e.dropdown.join(", ")}]`:"- No dropdown constraint"}`)).join("\n\n")}\n\n    # PROCESSING RULES:\n\n    ## For DROPDOWN attributes (when dropdown options are provided):\n    - You MUST select ONLY from the provided dropdown options\n    - Find the option that best matches the current product/option information\n    - If no perfect match exists, choose the closest semantic match\n    - NEVER create custom values - only use the exact dropdown options provided\n    - Example: If product is "ë‹¤í¬ê·¸ë ˆì´" and dropdown has "ê·¸ë ˆì´ê³„ì—´", choose "ê·¸ë ˆì´ê³„ì—´"\n\n    ## For TEXT INPUT attributes (when no dropdown is provided):\n    - CRITICAL: NEVER use "null", "ì•Œìˆ˜ì—†ìŒ", "ì •ë³´ì—†ìŒ", "í•´ë‹¹ì‚¬í•­ì—†ìŒ" for text input fields - ALWAYS provide a value\n    - If the example shows units (e.g., "10cm", "2kg", "100ml"), you MUST provide an estimate with the SAME unit\n    - FOLLOW THE GUIDE INSTRUCTIONS EXACTLY - each attribute has specific measurement guidelines in the Guide field\n    - PRIORITIZE analysis order: 1) Follow Guide instructions, 2) Current Option name, 3) Product Attributes, 4) Product name/description\n    - For dimensions/measurements:\n      * Read the Guide carefully for specific measurement rules (e.g., "longer side", "maximum size", "width when unfolded")\n      * Apply Guide rules to estimate based on product category and available information\n      * Use option name patterns (e.g., "ëŒ€í˜•"â†’larger estimate, "ì†Œí˜•"â†’smaller estimate) within Guide parameters\n    - For material attributes: examine product attributes and option details, follow Guide specifications\n    - When no specific information is available, make reasonable estimates that follow the Guide rules and use the correct unit from examples\n\n    ## Special handling for COLOR attributes:\n    - FIRST check the TARGET OPTION INFORMATION if available\n    - Use the specific option's color information over general product information\n    - Look for color terms in Korean names and descriptions\n\n    # RESPONSE FORMAT:\n    Return ONLY a valid JSON array containing ALL the attribute names from the required list.\n    Do not include any explanation or text outside the JSON.\n\n    \`\`\`json\n    [\n      {"attributeName": "ì¿ ì…˜ í˜•íƒœ", "attributeValue": "ì¼ìí˜•"},\n      {"attributeName": "ìƒ‰ìƒê³„ì—´", "attributeValue": "ê·¸ë ˆì´ê³„ì—´"},\n      {"attributeName": "ê°€ë¡œê¸¸ì´", "attributeValue": "45cm"},\n      {"attributeName": "ì„¸ë¡œê¸¸ì´", "attributeValue": "30cm"},\n      {"attributeName": "ë¬´ê²Œ", "attributeValue": "2.5kg"}\n    ]\n    \`\`\`\n\n    Remember: NEVER use "ì•Œìˆ˜ì—†ìŒ", "null", or similar phrases for text inputs. Always provide estimated values with correct units based on Guide instructions.\n    `}(s,o,m);for(let n=1;n<=3;n++)try{const t=await p.generateContent(e),o=await t.response.text();if(f=re(o),f){console.log(`ë¹„ë…¸ì¶œ ì†ì„± ìƒì„± ì„±ê³µ (ì‹œë„ ${n})`);break}console.warn(`ë¹„ë…¸ì¶œ ì†ì„± íŒŒì‹± ì‹¤íŒ¨ (ì‹œë„ ${n})`),n<3&&await ce(5e3)}catch(e){console.error(`ë¹„ë…¸ì¶œ ì†ì„± ìƒì„± ì˜¤ë¥˜ (ì‹œë„ ${n}):`,e),e.message&&e.message.includes("429")?(console.log("Rate Limiting ê°ì§€, 20ì´ˆ ëŒ€ê¸° ì¤‘..."),n<3&&await ce(2e4)):n<3&&await ce(5e3)}}else console.log("â„¹ï¸ ë¹„ë…¸ì¶œì†ì„± ìë™ ìƒì„±ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. Rate Limiting ë°©ì§€ë¥¼ ìœ„í•´ ê±´ë„ˆëœë‹ˆë‹¤."),K(n.id,"Skipping unexposed attributes (disabled in settings)... (2/4)"),f=[];await ce(5e3),K(n.id,"Generating logistics information... (3/4)"),console.log("Logistics Information:");const y=function(e,n){const t=n.productShippingInfo?.skuShippingInfoList?.[0]||{},o=n?.seo?.productName||n.productNameTrans||n.productName||"",i=n.selectedOption||{},s=n.productAttribute||[];return`\n    You are a logistics data specialist for e-commerce product listings. Your task is to provide accurate box dimensions and weight for a product.\n\n    # CRITICAL INSTRUCTIONS:\n    1. You MUST always provide reasonable box dimensions and weight values\n    2. NEVER return empty strings or null values\n    3. If specific information is not available, make an educated estimate based on product type and name\n    4. Return values in the exact format requested\n\n    # PRODUCT INFORMATION:\n    - Product Name: ${o}\n    - Product Type: ${n.categoryPath||""}\n    - Product Attributes: ${JSON.stringify(s)}\n\n    # ADDITIONAL SIZE INFORMATION:\n    ${JSON.stringify(t)}\n\n    # OPTION INFORMATION:\n    - Option Name: ${i.korName||""}\n\n    # FORMAT REQUIREMENTS:\n    1. skuUnitBoxDimension: Must be in format "W*L*H" in millimeters (mm) with no spaces\n       - Example: "300*200*100"\n       - If dimensions in cm are provided, multiply by 10 to convert to mm\n\n    2. skuUnitBoxWeight: Must be weight in grams (g) as a string with no decimal points\n       - Example: "500"\n       - If weight in kg is provided, multiply by 1000 to convert to g\n\n    # ESTIMATION GUIDELINES:\n    - Small items (accessories, small home goods): 200*200*50 mm, 300-500g\n    - Medium items (clothing, small electronics): 300*300*100 mm, 500-1000g\n    - Large items (bedding, larger home goods): 400*400*200 mm, 1000-2000g\n    - Analyze the product name and category to make reasonable estimates\n\n    # RESPONSE FORMAT:\n    Return ONLY the following JSON object with no additional text:\n\n    \`\`\`json\n    {\n      "skuUnitBoxDimension": "300*200*100",\n      "skuUnitBoxWeight": "500"\n    }\n    \`\`\`\n    `}(0,o);let w=null;for(let e=1;e<=3;e++)try{const n=await p.generateContent(y),t=await n.response.text();if(w=re(t),w){console.log(`ë¬¼ë¥˜ ì •ë³´ ìƒì„± ì„±ê³µ (ì‹œë„ ${e})`);break}console.warn(`ë¬¼ë¥˜ ì •ë³´ íŒŒì‹± ì‹¤íŒ¨ (ì‹œë„ ${e})`),e<3&&await ce(5e3)}catch(n){console.error(`ë¬¼ë¥˜ ì •ë³´ ìƒì„± ì˜¤ë¥˜ (ì‹œë„ ${e}):`,n),n.message&&n.message.includes("429")?(console.log("Rate Limiting ê°ì§€, 20ì´ˆ ëŒ€ê¸° ì¤‘..."),e<3&&await ce(2e4)):e<3&&await ce(5e3)}w||(console.warn("ë¬¼ë¥˜ ì •ë³´ ìƒì„± ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©"),w={skuUnitBoxDimension:"300*200*100",skuUnitBoxWeight:"500"}),await ce(5e3),K(n.id,"Generating notices information... (4/4)"),console.log("Notices Information:");const T=function(e,n,t,o=null){const i=[];e.allOf.forEach((e=>{if(e.contains&&e.contains.properties&&e.contains.properties.noticeItemName){const n=e.contains.properties.noticeItemName.enum[0],t=e.contains.properties.noticeItemValue.dropdown&&e.contains.properties.noticeItemValue.dropdown.length>0;i.push({name:n,required:!0,dropdown:t?e.contains.properties.noticeItemValue.dropdown:null,guide:e.contains.properties.noticeItemName.inputGuide||"",example:e.contains.properties.noticeItemValue.examples?e.contains.properties.noticeItemValue.examples[0]:""})}}));const s=n.selectedOption||{};let a="";o&&(a=`\n    # TARGET OPTION INFORMATION (HIGHEST PRIORITY):\n    - Option Name: ${o.seoKorName||o.korName||""}\n    - This specific option's information should be prioritized over general product information\n    `);const r=JSON.stringify(n.productAttribute),l=t?.manufacturer||"ì •ë³´ ì—†ìŒ",c=t?.asInfo||"ì •ë³´ ì—†ìŒ",u="ìˆ˜ì…ëŒ€ìƒì•„ë‹˜"===t?.importStatus?"í•œêµ­":"ì¤‘êµ­";return`\n    You are a regulatory compliance specialist for e-commerce product listings. Your task is to provide accurate legal notices for a product.\n\n    # CRITICAL INSTRUCTIONS:\n    1. You MUST generate ALL the following notice items: ${i.map((e=>e.name)).join(", ")}\n    2. ALWAYS use the provided default values for specific fields (listed below)\n    3. For dropdown fields, you MUST select a value ONLY from the dropdown options\n    4. NEVER leave any field empty - use "ìƒì„¸ì„¤ëª… ì°¸ì¡°" if necessary\n    5. All responses must be in Korean, and all Chinese units must be converted to English units (æ–¤ -> kg, ç  -> size).\n\n    # PRODUCT INFORMATION:\n    - Product Name: ${n.seo.productName||n.productNameTrans||n.productName||""}\n    - Brand: ${n.brand||""}\n    - Category: ${n.categoryPath||""}\n\n    # PRODUCT ATTRIBUTES:\n    ${r}\n    ${a}\n    # GENERAL OPTION INFORMATION:\n    - Option Name: ${s.korName||""}\n\n    # DEFAULT VALUES (MUST USE EXACTLY AS PROVIDED):\n    - ì œì¡°ì(ìˆ˜ì…ì): ${l}\n    - A/S ì±…ì„ìì™€ ì „í™”ë²ˆí˜¸: ${c}\n    - ì œì¡°êµ­: ${u}\n    - í’ˆì§ˆë³´ì¦ê¸°ì¤€: "ì œí’ˆ ì´ìƒ ì‹œ ê³µì •ê±°ë˜ìœ„ì›íšŒ ê³ ì‹œ ì†Œë¹„ìë¶„ìŸí•´ê²°ê¸°ì¤€ì— ì˜ê±° ë³´ìƒí•©ë‹ˆë‹¤."\n\n    # REQUIRED NOTICES WITH CONSTRAINTS:\n    ${i.map((e=>`## ${e.name}\n        - Guide: ${e.guide||"No guide available"}\n        - Example: ${e.example||"No example available"}\n        ${e.dropdown?`- MUST choose from: [${e.dropdown.join(", ")}]`:"- No dropdown constraint"}\n        ${function(e,n,t,o){switch(e){case"ì œì¡°ì(ìˆ˜ì…ì)":return`- MUST use: "${n}"`;case"A/S ì±…ì„ìì™€ ì „í™”ë²ˆí˜¸":return`- MUST use: "${t}"`;case"ì œì¡°êµ­":return`- MUST use: "${o}"`;case"í’ˆì§ˆë³´ì¦ê¸°ì¤€":return'- MUST use: "ì œí’ˆ ì´ìƒ ì‹œ ê³µì •ê±°ë˜ìœ„ì›íšŒ ê³ ì‹œ ì†Œë¹„ìë¶„ìŸí•´ê²°ê¸°ì¤€ì— ì˜ê±° ë³´ìƒí•©ë‹ˆë‹¤."';default:return""}}(e.name,l,c,u)}`)).join("\n\n")}\n\n    # HOW TO HANDLE DROPDOWNS:\n    - For notices with dropdowns: You MUST select a value from the provided dropdown options\n    - If the exact value doesn't exist in the dropdown, find the closest match\n    - If no reasonable match exists, use the most general option from the dropdown\n\n    # SPECIAL HANDLING FOR COLOR-RELATED NOTICES:\n    - For any notice item related to color (may be named "ìƒ‰ìƒ", "ì»¬ëŸ¬", "ì¹¼ë¼", etc.):\n    - FIRST check the TARGET OPTION INFORMATION if available\n    - Look for color information in the SEO Korean Name or option values\n    - For color, look for terms like "ë ˆë“œ", "ë¸”ë£¨", "í™”ì´íŠ¸", "ë¸”ë™" etc.\n    - If the target option contains color information, use that EXACT information\n    - Only if no specific information exists in the target option, fall back to general product information\n    - Do NOT list all possible color options from the product\n\n    # MATERIAL & CONTENT GUIDANCE:\n    - For material attributes, carefully examine product attributes and description\n    - For "ì œí’ˆ ì†Œì¬", include both outer material and filling if applicable\n    - For "êµ¬ì„±í’ˆ", list all components that come with the product\n    - For missing information, use "ìƒì„¸ì„¤ëª… ì°¸ì¡°" rather than leaving blank\n\n    # RESPONSE FORMAT:\n    Return ONLY a valid JSON array containing ALL the required notice items.\n    Do not include any explanation or text outside the JSON.\n\n    \`\`\`json\n    [\n      {"noticeItemName": "ì œí’ˆ ì†Œì¬", "noticeItemValue": "ê²‰ê°: ë©´, ì¶©ì „ì¬: ë©”ëª¨ë¦¬í¼"},\n      {"noticeItemName": "ì œì¡°ì(ìˆ˜ì…ì)", "noticeItemValue": "ì˜¤ëŠë¦¬"},\n      {"noticeItemName": "ì œì¡°êµ­", "noticeItemValue": "ì¤‘êµ­"},\n      {"noticeItemName": "í’ˆì§ˆë³´ì¦ê¸°ì¤€", "noticeItemValue": "ì œí’ˆ ì´ìƒ ì‹œ ê³µì •ê±°ë˜ìœ„ì›íšŒ ê³ ì‹œ ì†Œë¹„ìë¶„ìŸí•´ê²°ê¸°ì¤€ì— ì˜ê±° ë³´ìƒí•©ë‹ˆë‹¤."}\n    ]\n    \`\`\`\n    `}(d,o,a,m);let O=null;for(let e=1;e<=3;e++)try{const n=await p.generateContent(T),t=await n.response.text();if(O=re(t),O){console.log(`ê³ ì‹œ ì •ë³´ ìƒì„± ì„±ê³µ (ì‹œë„ ${e})`);break}console.warn(`ê³ ì‹œ ì •ë³´ íŒŒì‹± ì‹¤íŒ¨ (ì‹œë„ ${e})`),e<3&&await ce(5e3)}catch(n){console.error(`ê³ ì‹œ ì •ë³´ ìƒì„± ì˜¤ë¥˜ (ì‹œë„ ${e}):`,n),n.message&&n.message.includes("429")?(console.log("Rate Limiting ê°ì§€, 20ì´ˆ ëŒ€ê¸° ì¤‘..."),e<3&&await ce(2e4)):e<3&&await ce(5e3)}return{exposedAttributes:h||[],unexposedAttributes:f||[],skuUnitBoxDimension:w?.skuUnitBoxDimension||"300*200*100",skuUnitBoxWeight:w?.skuUnitBoxWeight||"500",notices:O||[]}}catch(e){return console.error("Error in generateCoupangAttributes:",e),{exposedAttributes:[],unexposedAttributes:[],skuUnitBoxDimension:"300*200*100",skuUnitBoxWeight:"500",notices:[]}}}async function J(e,n){try{const{prompt:t,apiKey:o,geminiModel:i="gemini-2.0-flash",id:s,productId:a,workType:r}=e;if(K(n.id,`${r} ì²˜ë¦¬ ì‹œì‘...`),!o)throw new Error("Gemini API Keyê°€ ì—†ìŠµë‹ˆë‹¤");const l=new G(o).getGenerativeModel({model:i,generation_config:{responseMimeType:"application/json",temperature:.3}}),c=e.requestArr||[{prompt:e.prompt,images:e.images}],u=[];for(let e=0;e<c.length;e++){const t=c[e];if(K(n.id,`ìš”ì²­ ${e+1}/${c.length} ì²˜ë¦¬ ì¤‘...`),t.images&&t.images.length>0){const e=await Promise.all(t.images.map((e=>le(e)))),n=await l.generateContent([t.prompt,...e]),o=await n.response,i=await o.text();console.log(i),u.push({originalImage:t.images[0],processedImage:t.images[0],result:ae(i)})}else{const e=await l.generateContent(t.prompt),n=await e.response,o=await n.text();console.log(o),u.push({processedText:o,result:ae(o)})}}return{id:s,productId:a,workType:r,task:e.task,result:e.requestArr?{batchResults:u,count:c.length}:u[0],status:"completed",timestamp:Date.now()}}catch(e){throw console.error("AI ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:",e),e}}function K(e,n){chrome.tabs.sendMessage(e,{response:!0,data:{type:"AiRocketRegProgress",text:n}})}function Y(e){if(!e||"object"!=typeof e)throw new Error("ì‘ë‹µì´ ê°ì²´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤");if(!e.chinese||!e.korean)throw new Error("ì‘ë‹µì— ì¤‘êµ­ì–´ ë˜ëŠ” í•œêµ­ì–´ í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤");if("string"!=typeof e.chinese||"string"!=typeof e.korean)throw new Error("ì‘ë‹µ í…ìŠ¤íŠ¸ê°€ ë¬¸ìì—´ì´ ì•„ë‹™ë‹ˆë‹¤");return!0}async function q(e,n,t,o="gemini-2.0-flash"){const i=new G(t).getGenerativeModel({model:o}),s=`\ní˜„ì¬ í˜‘ìƒ ì»¨í…ìŠ¤íŠ¸: ${JSON.stringify(n,null,2)}\n\në‹¤ìŒ ë©”ì‹œì§€ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê³ ë ¤í•˜ì—¬ ë²ˆì—­í•˜ê³ , ì ì ˆí•œ í›„ì† ì‘ë‹µì„ ì œì•ˆí•´ì£¼ì„¸ìš”:\n"${e}"\n\nì‘ë‹µ í˜•ì‹:\n{\n    "translation": {\n        "chinese": "ì›ë¬¸ì´ ì¤‘êµ­ì–´ì¸ ê²½ìš° ê·¸ëŒ€ë¡œ, í•œêµ­ì–´ì¸ ê²½ìš° ë²ˆì—­",\n        "korean": "ì›ë¬¸ì´ í•œêµ­ì–´ì¸ ê²½ìš° ê·¸ëŒ€ë¡œ, ì¤‘êµ­ì–´ì¸ ê²½ìš° ë²ˆì—­"\n    },\n    "analysis": {\n        "sentiment": "ê¸ì •/ë¶€ì •/ì¤‘ë¦½",\n        "key_points": ["ì£¼ìš” ë‚´ìš© í¬ì¸íŠ¸ë“¤"],\n        "suggested_response": {\n            "chinese": "ì œì•ˆí•˜ëŠ” ë‹µë³€ (ì¤‘êµ­ì–´)",\n            "korean": "ì œì•ˆí•˜ëŠ” ë‹µë³€ (í•œêµ­ì–´)"\n        }\n    }\n}`,a=await i.generateContent(s);return JSON.parse(await a.response.text())}async function z(e,n){try{const n=e.geminiApiKey,t=e.geminiModel||"gemini-2.0-flash";if(!n)throw new Error("Gemini API Keyê°€ ì—†ìŠµë‹ˆë‹¤");const o=new G(n).getGenerativeModel({model:t,generation_config:{responseMimeType:"application/json",temperature:.7,topP:.8,topK:40}}),i=`\n            System:\n            ${function(e,n=[]){const t=e.existingConversation||[];console.log("í”„ë¡¬í”„íŠ¸ ìƒì„± - ê¸°ì¡´ ëŒ€í™” ë‚´ì—­:",t);const o=t.length>0&&(()=>{const e=new Date(t[t.length-1].timestamp);return(new Date-e)/6e4<=60})(),i=t.length>0?`\nê¸°ì¡´ ëŒ€í™” ë‚´ì—­:\n${t.map((e=>`${"seller"===e.role?"íŒë§¤ì":"êµ¬ë§¤ì"}: ${e.content}`)).join("\n")}\n\nì£¼ì˜: ${o?"ìµœê·¼ 60ë¶„ ì´ë‚´ì˜ ëŒ€í™”ê°€ ì§„í–‰ ì¤‘ì´ë¯€ë¡œ, ì¸ì‚¬ë§ ì—†ì´ ë°”ë¡œ ë³¸ë¡ ìœ¼ë¡œ ë“¤ì–´ê°€ì£¼ì„¸ìš”.":"60ë¶„ ì´ìƒ ì‹œê°„ì´ ê²½ê³¼í•˜ì—¬ ê°„ë‹¨í•œ ì¸ì‚¬ë¡œ ëŒ€í™”ë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”."}`:"\nì•„ì§ ëŒ€í™”ê°€ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì²« ì¸ì‚¬ë¶€í„° ì‹œì‘í•´ì£¼ì„¸ìš”.";return`\në‹¹ì‹ ì€ í•œêµ­ ì´ì»¤ë¨¸ìŠ¤ ì‚¬ì—…ìë¥¼ ëŒ€ì‹ í•˜ì—¬ 1688 íŒë§¤ìì™€ í˜‘ìƒí•˜ëŠ” AIì…ë‹ˆë‹¤.\nì²´í¬ëœ ë¬¸ì˜ì‚¬í•­: ${JSON.stringify(e.checkItems,null,2)}\nì¶”ê°€ ìš”ì²­ì‚¬í•­: ${e.additionalRequests||"ì—†ìŒ"}\n${i}\n\ní˜„ì¬ê¹Œì§€ì˜ ëŒ€í™”:\n${n.map((e=>`${e.role}: ${e.content}`)).join("\n")}\n\nëª¨ë“  ì‘ë‹µì€ ë°˜ë“œì‹œ ë‹¤ìŒê³¼ ê°™ì€ JSON í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”:\n{\n    "chinese": "ì¤‘êµ­ì–´ ë©”ì‹œì§€",\n    "korean": "í•œêµ­ì–´ ë²ˆì—­",\n    "context": {\n        "current_topic": "${o?"continue_conversation":"greeting"}",\n        "next_topic": "ë‹¤ìŒìœ¼ë¡œ ë¬¼ì–´ë³¼ ì£¼ì œ ì œì•ˆ",\n        "negotiation_status": "${o?"in_progress":"starting"}"\n    }\n}\n\nì£¼ìš” ê³ ë ¤ì‚¬í•­:\n1. ${o?"ì¸ì‚¬ë§ì„ ìƒëµí•˜ê³  ë°”ë¡œ ë³¸ë¡ ìœ¼ë¡œ ë“¤ì–´ê°€ì„¸ìš”":"ê°„ë‹¨í•œ ì¸ì‚¬ í›„ ë³¸ë¡ ìœ¼ë¡œ ë“¤ì–´ê°€ì„¸ìš”"}\n2. í•œë²ˆì— í•˜ë‚˜ì˜ ì£¼ì œë§Œ ë‹¤ë£¨ì„¸ìš”\n3. íŒë§¤ìì˜ ë‹µë³€ì— ë”°ë¼ ì ì ˆí•œ í›„ì† ì§ˆë¬¸ì´ë‚˜ í˜‘ìƒì„ ì§„í–‰í•˜ì„¸ìš”\n4. í˜‘ìƒ ìš°ì„ ìˆœìœ„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: ${e.negotiationStyle.priority}\n5. í˜‘ìƒ ìŠ¤íƒ€ì¼ì€ ${e.negotiationStyle.tone}ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.\n`}(e)}\n\n            User:\n            ${Q(e)}\n\n            ì‘ë‹µì€ ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”:\n            {\n                "chinese": "ì¤‘êµ­ì–´ ë©”ì‹œì§€",\n                "korean": "í•œêµ­ì–´ ë²ˆì—­",\n                "context": {\n                    "current_topic": "í˜„ì¬ ë…¼ì˜ ì¤‘ì¸ ì£¼ì œ",\n                    "next_topic": "ë‹¤ìŒìœ¼ë¡œ ë¬¼ì–´ë³¼ ì£¼ì œ ì œì•ˆ",\n                    "negotiation_status": "í˜‘ìƒ ì§„í–‰ ìƒíƒœ"\n                }\n            }\n        `,s=await o.generateContent(i);console.log("AI Response:",s);const a=await s.response,r=await a.text();console.log("Response Text:",r);const l=ae(r);if(!l)throw new Error("AI ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤");Y(l);const c=X(l.chinese,l.korean);return{aiReply:c,conversationHistory:[{text:i},{text:c}],context:l.context}}catch(e){throw console.error("í˜‘ìƒ ì‹œì‘ ì—ëŸ¬:",e),e}}async function V(e,n,t,o="gemini-2.0-flash",i){try{if(!t)throw new Error("Gemini API Keyê°€ ì—†ìŠµë‹ˆë‹¤");if(!e||!Array.isArray(e))throw new Error("ëŒ€í™” ê¸°ë¡ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤");const i=new G(t).getGenerativeModel({model:o,generation_config:{responseMimeType:"application/json",temperature:.7,topP:.8,topK:40}}),s=`\n            System:\n            ë‹¹ì‹ ì€ í•œêµ­ ì´ì»¤ë¨¸ìŠ¤ ì‚¬ì—…ìë¥¼ ëŒ€ì‹ í•˜ì—¬ 1688 íŒë§¤ìì™€ í˜‘ìƒí•˜ëŠ” AIì…ë‹ˆë‹¤.\n            ì´ì „ ëŒ€í™” ë‚´ìš©ê³¼ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê³ ë ¤í•˜ì—¬ ì ì ˆí•œ ì‘ë‹µì„ ìƒì„±í•´ì£¼ì„¸ìš”.\n\n            ì´ì „ ëŒ€í™”:\n            ${e.map((e=>e.text)).join("\n")}\n\n            ìƒˆë¡œìš´ ë©”ì‹œì§€:\n            ${n}\n\n            ì‘ë‹µì€ ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”:\n            {\n                "chinese": "ì¤‘êµ­ì–´ ë©”ì‹œì§€",\n                "korean": "í•œêµ­ì–´ ë²ˆì—­",\n                "context": {\n                    "current_topic": "í˜„ì¬ ë…¼ì˜ ì¤‘ì¸ ì£¼ì œ",\n                    "next_topic": "ë‹¤ìŒìœ¼ë¡œ ë¬¼ì–´ë³¼ ì£¼ì œ ì œì•ˆ",\n                    "negotiation_status": "í˜‘ìƒ ì§„í–‰ ìƒíƒœ"\n                }\n            }\n        `,a=await i.generateContent(s);console.log("AI Response:",a);const r=await a.response,l=await r.text();console.log("Response Text:",l);const c=ae(l);if(!c)throw new Error("AI ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤");Y(c);const u=X(c.chinese,c.korean);return{aiReply:u,conversationHistory:[...e,{text:n},{text:u}],context:c.context}}catch(e){throw console.error("í˜‘ìƒ ê³„ì† ì—ëŸ¬:",e),e}}async function W(e,n,t="gemini-2.0-flash",o="zh-to-kr"){try{if(!n)throw new Error("Gemini API Keyê°€ ì—†ìŠµë‹ˆë‹¤");const i=new G(n).getGenerativeModel({model:t,generation_config:{responseMimeType:"application/json",temperature:.3,topP:.8,topK:40}}),s=`\n            System:\n            ${"zh-to-kr"===o?"ì¤‘êµ­ì–´ë¥¼ í•œêµ­ì–´ë¡œ ë²ˆì—­í•´ì£¼ì„¸ìš”.":"í•œêµ­ì–´ë¥¼ ì¤‘êµ­ì–´ë¡œ ë²ˆì—­í•´ì£¼ì„¸ìš”."}\n            ë²ˆì—­ì€ ìì—°ìŠ¤ëŸ¬ì›Œì•¼ í•˜ë©°, ë¹„ì¦ˆë‹ˆìŠ¤ ë¬¸ë§¥ì— ë§ê²Œ ë³€í™˜í•´ì£¼ì„¸ìš”.\n\n            Message:\n            ${e}\n\n            ì‘ë‹µì€ ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”:\n            {\n                "chinese": "${"zh-to-kr"===o?"ì›ë³¸ ì¤‘êµ­ì–´":"ë²ˆì—­ëœ ì¤‘êµ­ì–´"}",\n                "korean": "${"zh-to-kr"===o?"ë²ˆì—­ëœ í•œêµ­ì–´":"ì›ë³¸ í•œêµ­ì–´"}"\n            }\n        `,a=await i.generateContent(s);console.log("Translation Response:",a);const r=await a.response,l=await r.text();console.log("Translation Text:",l);const c=ae(l);if(!c)throw new Error("ë²ˆì—­ ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤");return Y(c),X(c.chinese.trim(),c.korean.trim())}catch(e){throw console.error("ë²ˆì—­ ì—ëŸ¬:",e),e}}function X(e,n){return`${e.trim()}\n\n${n.trim()}`}function Q(e){const{checkItems:n,additionalRequests:t,existingConversation:o}=e,i=[];if(n.inStock.checked&&i.push("ì¬ê³  í™•ì¸ ë° ì¦‰ì‹œ ë°œì†¡ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ë¬¸ì˜í•´ì£¼ì„¸ìš”."),n.moq.checked&&n.moq.quantity&&i.push(`${n.moq.quantity}ê°œ êµ¬ë§¤ ì‹œ ê°€ê²© í• ì¸ì´ ê°€ëŠ¥í•œì§€ ë¬¸ì˜í•´ì£¼ì„¸ìš”.`),n.dailyProduction.checked&&i.push("ì¼ì¼ ìµœëŒ€ ìƒì‚° ê°€ëŠ¥ ìˆ˜ëŸ‰ì„ ë¬¸ì˜í•´ì£¼ì„¸ìš”."),n.shipping.checked&&n.shipping.destination&&i.push(`${n.shipping.destination}ê¹Œì§€ì˜ ë°°ì†¡ë¹„ì™€ ì˜ˆìƒ ë°°ì†¡ ê¸°ê°„ì„ ë¬¸ì˜í•´ì£¼ì„¸ìš”.`),n.packaging.checked){let e="í¬ì¥ ë°©ì‹ê³¼ ë°•ìŠ¤ í¬ê¸°ë¥¼ ë¬¸ì˜í•´ì£¼ì„¸ìš”.";n.packaging.photoRequired&&(e+=" ê°€ëŠ¥í•˜ë‹¤ë©´ í¬ì¥ ì‚¬ì§„ë„ ìš”ì²­í•´ì£¼ì„¸ìš”."),i.push(e)}n.material.checked&&i.push("ì œí’ˆì˜ ì¬ì§ˆ, ì¤‘ëŸ‰, ê´€ë ¨ ì¸ì¦ ì •ë³´ë¥¼ ë¬¸ì˜í•´ì£¼ì„¸ìš”."),t&&t.trim()&&i.push(`ì¶”ê°€ë¡œ ${t.trim()}ì— ëŒ€í•´ì„œë„ ë¬¸ì˜í•´ì£¼ì„¸ìš”.`);const s=o&&o.length>0&&(()=>{const e=new Date(o[o.length-1].timestamp);return(new Date-e)/6e4<=60})();let a="";return a=s?`\nì£¼ì˜: ì ˆëŒ€ë¡œ ì¸ì‚¬ë§(ì•ˆë…•í•˜ì„¸ìš”, æ‚¨å¥½, ä½ å¥½ ë“±)ì„ í•˜ì§€ ë§ê³ , ë°”ë¡œ ë³¸ë¡ ìœ¼ë¡œ ë“¤ì–´ê°€ì£¼ì„¸ìš”.\ní˜„ì¬ ì§„í–‰ì¤‘ì¸ ëŒ€í™”ì´ë¯€ë¡œ ì¸ì‚¬ëŠ” ë¶ˆí•„ìš”í•©ë‹ˆë‹¤.\n\në¬¸ì˜í•´ì•¼ í•  í•­ëª© ì¤‘ í•˜ë‚˜ë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì§ˆë¬¸í•´ì£¼ì„¸ìš”:\n${i.map(((e,n)=>`${n+1}. ${e}`)).join("\n")}`:'\nì²« ë©”ì‹œì§€ëŠ” "è€æ¿ä½ å¥½", "æ‚¨å¥½"ì™€ ê°™ì€ ì¸ì‚¬ í•˜ë‚˜ë§Œ ë³´ë‚´ì£¼ì„¸ìš”.\nì‹ ë¶„ì´ë‚˜ ì†Œì†ì€ ë°íˆì§€ ë§ˆì„¸ìš”.',a+=`\n\nì‘ë‹µ í˜•ì‹:\n{\n    "chinese": "ì¤‘êµ­ì–´ ë©”ì‹œì§€",\n    "korean": "í•œêµ­ì–´ ë²ˆì—­",\n    "context": {\n        "current_topic": "${s?"continue_conversation":"greeting"}",\n        "next_topic": "ë‹¤ìŒìœ¼ë¡œ ë¬¼ì–´ë³¼ ì£¼ì œ ì œì•ˆ",\n        "negotiation_status": "${s?"in_progress":"starting"}"\n    }\n}\n\n${s?"ì¤‘ìš”: ì‘ë‹µì— ì¸ì‚¬ë§ì„ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”. ë°”ë¡œ ì§ˆë¬¸ì„ ì‹œì‘í•˜ì„¸ìš”.":""}`,a}async function Z(e,n,t,o,i="gemini-2.0-flash",s,a){chrome.tabs.sendMessage(a.id,{response:"ANALYZE_LAYOUT_PROGRESS",payload:"AI ìƒì„¸í˜ì´ì§€ ì¹´í”¼ ë° ë ˆì´ì•„ì›ƒ ìƒì„± ì¤‘..."});var r=await async function(e,n,t,o,i="gemini-2.0-flash",s){try{const r=new G(o).getGenerativeModel({model:i,generation_config:{responseMimeType:"application/json"}});var a=function(e){const n=[];for(const t of e)for(const e of t.skuAttributes)e.skuImageUrl&&n.push({imageUrl:e.skuImageUrl,attributeName:e.attributeName,attributeNameTrans:e.attributeNameTrans,value:e.value,valueTrans:e.valueTrans});return n}(t.data.productSkuInfos);const l=`\n            System:\n            You are an e-commerce marketing and layout expert AI, assisting the user in creating a product detail page (â€œìƒì„¸í˜ì´ì§€â€) for a 1688 product based on a specific marketing strategy. Follow these guidelines:\n\n            [Layout Elements Overview]\n            - The detail page is composed of multiple â€œsections.â€\n            - Each section may contain various â€œblocks,â€ which represent different layout elements.\n            - We define the following 10 block elements:\n\n            1) heading\n            2) copy\n            3) imageLayout (e.g., full-width, 2-column, 2x2)\n            4) imageUrls (array of image URLs)\n            5) bulletList (array for bulleted or numbered lists)\n            6) tableHTML (HTML table markup: '<table>', '<tr>', '<th>', '<td>')\n            7) highlightBox (for important notices, promotions, USP emphasis)\n            8) iconText (an icon URL plus a short text)\n            9) emphasisText (highlighted statements, quotes, etc.)\n            10) optionImageLayout (HTML layout for option images in columns/grids)\n\n            Additionally,\n            - You may include a â€œdividerâ€ key (for '<hr>' or spacing) if needed.\n            - Any unused fields in a block should be '""' or '[]'.\n\n            [Output Requirements]\n            1. The final answer should be **in Korean only** and in **JSON** format with '"sections"' as the root key.\n            2. Each section object must follow this structure:\n            { "id": 1, "title": "Section Title (Korean)", "reason": "Marketing rationale for this section", "blocks": [ { "blockId": 1, "heading": "...", "copy": "...", "imageLayout": "...", "imageUrls": [...], "bulletList": [...], "tableHTML": "...", "highlightBox": "...", "iconText": "...", "emphasisText": "...", "optionImageLayout": "...", "divider": "...", "notes": "...", "fullHTML": "" } ] }\n\n            3. Be sure to include all 10 block keys in each block. If a key is not used, leave it as an empty string or empty array.\n            4. Keep '"fullHTML"' as an empty string for now (later, we will apply CSS).\n            5. Avoid reusing the same image unless necessary; if additional images are needed, use '"imageUrls": []"' and note â€œì´ë¯¸ì§€ ì¶”ê°€ í•„ìš”â€ in '"notes"'.\n            6. If showing option images, put them in '"optionImageLayout"' with '<img src="...">'.\n            7. Output **only** the JSON, no extra commentary or Markdown formatting.\n\n            [References]\n            - **Product Information** (e.g., '${t}')\n            - **Selected Marketing Strategy** (e.g., '${e}')\n            - **Additional Feedback** (e.g., '${n}')\n            - **ìƒí’ˆì´ë¯¸ì§€ ë°ì´í„°** (e.g., '${JSON.stringify(s,null,2)}')\n            - **Option Images Information** (e.g., '${a}')\n            - **Option Images Urls** (e.g., '${a.map((e=>e.imageUrl))}')\n\n            [Goal]\n            - Generate a â€œsectionsâ€ JSON covering ~80% of the final layout.\n            - For each section, specify '"reason"' for the marketing purpose. In each block, fill or leave empty ('""') all 10 layout keys.\n            - Keep '"fullHTML"' empty.\n\n            Below is an **example JSON** for reference; you donâ€™t have to copy it exactly:\n\n            { "sections": [ { "id": 1, "title": "ì œí’ˆ ì†Œê°œ ì„¹ì…˜", "reason": "Why this section is needed", "blocks": [ { "blockId": 1, "heading": "ê°€ë²¼ìš´ ë¬´ê²Œë¡œ<br>í¸ì•ˆí•¨ ì œê³µ", "copy": "ì´ ì œí’ˆì€ íœ´ëŒ€ê°€ ê°„í¸í•˜ê³ ...", "imageLayout": "full-width", "imageUrls": ["https://example.com/images/product_main.jpg"], "bulletList": "", "tableHTML": "", "highlightBox": "", "iconText": "", "emphasisText": "", "optionImageLayout": "", "divider": "", "notes": "Example notes", "fullHTML": "" } ] } ] }\n\n            Please output only the JSON under â€œsections.â€\n            {\n                "sections": [\n                    {\n                    "id": 1,\n                    "title": "ì œí’ˆ ì†Œê°œ ì„¹ì…˜",\n                    "reason": "ì²˜ìŒ ë°©ë¬¸í•˜ëŠ” ê³ ê°ì—ê²Œ ì œí’ˆì˜ í•µì‹¬ ì¥ì ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•´ í•„ìš”",\n                    "blocks": [\n                        {\n                        "blockId": 1,\n                        "heading": "ê°€ë²¼ìš´ ë¬´ê²Œë¡œ<br>í¸ì•ˆí•¨ ì œê³µ",\n                        "copy": "ì´ ì œí’ˆì€ íœ´ëŒ€ê°€ ê°„í¸í•˜ê³ <br>ì˜¤ë«ë™ì•ˆ ì‚¬ìš©í•´ë„<br>í”¼ë¡œë„ê°€ ì ìŠµë‹ˆë‹¤.",\n                        "imageLayout": "full-width",\n                        "imageUrls": [\n                            "https://example.com/images/product_main.jpg"\n                        ],\n                        "bulletList": "",\n                        "tableHTML": "",\n                        "highlightBox": "",\n                        "iconText": "",\n                        "emphasisText": "",\n                        "optionImageLayout": "",\n                        "divider": "",\n                        "notes": "",\n                        "fullHTML": ""\n                        },\n                        {\n                        "blockId": 2,\n                        "heading": "",\n                        "copy": "",\n                        "imageLayout": "",\n                        "imageUrls": [],\n                        "bulletList": [\n                            "ë¯¸ë„ëŸ¼ ë°©ì§€ ì†Œì¬",\n                            "ìƒí™œ ë°©ìˆ˜ ê¸°ëŠ¥",\n                            "ì–´ë–¤ ì˜·ì°¨ë¦¼ì—ë„ ì˜ ì–´ìš¸ë¦¼"\n                        ],\n                        "tableHTML": "",\n                        "highlightBox": "",\n                        "iconText": "",\n                        "emphasisText": "",\n                        "optionImageLayout": "",\n                        "divider": "",\n                        "notes": "ì£¼ìš” ì¥ì ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ì •ë¦¬",\n                        "fullHTML": ""\n                        },\n                        {\n                        "blockId": 3,\n                        "heading": "",\n                        "copy": "",\n                        "imageLayout": "",\n                        "imageUrls": [],\n                        "bulletList": "",\n                        "tableHTML": "",\n                        "highlightBox": "ì§€ê¸ˆ êµ¬ë§¤ ì‹œ<br>ë¬´ë£Œ ë°°ì†¡ í˜œíƒ!",\n                        "iconText": "",\n                        "emphasisText": "",\n                        "optionImageLayout": "",\n                        "divider": "",\n                        "notes": "ë¬´ë£Œë°°ì†¡ ì´ë²¤íŠ¸ ì•Œë¦¼ ê°•ì¡°",\n                        "fullHTML": ""\n                        }\n                    ]\n                    },\n                    {\n                    "id": 2,\n                    "title": "ì œí’ˆ ì •ë³´ ì„¹ì…˜",\n                    "reason": "ì†Œì¬, ì‚¬ì´ì¦ˆ, ì œì¡° ì •ë³´ ë“±<br>êµ¬ì²´ì ì¸ ì œí’ˆ ìŠ¤í™ì„ ì•ˆë‚´í•˜ê¸° ìœ„í•´ í•„ìš”",\n                    "blocks": [\n                        {\n                        "blockId": 1,\n                        "heading": "ìŠ¤í™ ì •ë³´",\n                        "copy": "ì •í™•í•œ í¬ê¸°ì™€ ì¬ì§ˆ ì •ë³´ë¥¼<br>í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",\n                        "imageLayout": "",\n                        "imageUrls": [],\n                        "bulletList": "",\n                        "tableHTML": "<table><tr><th>í•­ëª©</th><th>ë‚´ìš©</th></tr><tr><td>ì†Œì¬</td><td>í´ë¦¬ì—ìŠ¤í„° 100%</td></tr><tr><td>ì‚¬ì´ì¦ˆ</td><td>ê°€ë¡œ 30cm, ì„¸ë¡œ 40cm</td></tr></table>",\n                        "highlightBox": "",\n                        "iconText": "",\n                        "emphasisText": "",\n                        "optionImageLayout": "",\n                        "divider": "",\n                        "notes": "í‘œ í˜•ì‹ìœ¼ë¡œ ìŠ¤í™ ì œê³µ",\n                        "fullHTML": ""\n                        },\n                        {\n                        "blockId": 2,\n                        "heading": "",\n                        "copy": "",\n                        "imageLayout": "",\n                        "imageUrls": [],\n                        "bulletList": "",\n                        "tableHTML": "",\n                        "highlightBox": "",\n                        "iconText": "",\n                        "emphasisText": "ê³ ê° ë§Œì¡±ë„<br>95% ì´ìƒ ë‹¬ì„±!",\n                        "optionImageLayout": "",\n                        "divider": "",\n                        "notes": "ë¦¬ë·° ìš”ì•½ ê°•ì¡° ë¬¸êµ¬",\n                        "fullHTML": ""\n                        },\n                        {\n                        "blockId": 3,\n                        "heading": "",\n                        "copy": "",\n                        "imageLayout": "",\n                        "imageUrls": [],\n                        "bulletList": "",\n                        "tableHTML": "",\n                        "highlightBox": "",\n                        "iconText": "https://example.com/icons/durable.png|íŠ¼íŠ¼í•œ ë‚´êµ¬ì„±",\n                        "emphasisText": "",\n                        "optionImageLayout": "",\n                        "divider": "",\n                        "notes": "ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì¡°í•©í•œ ê°„ë‹¨í•œ ì•ˆë‚´",\n                        "fullHTML": ""\n                        }\n                    ]\n                    },\n                    {\n                    "id": 3,\n                    "title": "ì˜µì…˜ ì•ˆë‚´ ì„¹ì…˜",\n                    "reason": "ìƒ‰ìƒ/ì‚¬ì´ì¦ˆ ë“± ë‹¤ì–‘í•œ ì˜µì…˜ ì •ë³´ë¥¼<br>í•œëˆˆì— ë³´ì—¬ì£¼ê¸° ìœ„í•´ í•„ìš”",\n                    "blocks": [\n                        {\n                        "blockId": 1,\n                        "heading": "ì˜µì…˜ ë¯¸ë¦¬ë³´ê¸°",\n                        "copy": "ì›í•˜ëŠ” ì»¬ëŸ¬ì™€ ì‚¬ì´ì¦ˆë¥¼<br>í™•ì¸í•´ ë³´ì„¸ìš”.",\n                        "imageLayout": "",\n                        "imageUrls": [],\n                        "bulletList": "",\n                        "tableHTML": "",\n                        "highlightBox": "",\n                        "iconText": "",\n                        "emphasisText": "",\n                        "optionImageLayout": "<div style='display: flex; flex-wrap: wrap;'>\n  <div style='width: 50%; text-align: center;'>\n    <img src='https://example.com/options/blue.jpg' alt='ë¸”ë£¨'><br>ë¸”ë£¨\n  </div>\n  <div style='width: 50%; text-align: center;'>\n    <img src='https://example.com/options/red.jpg' alt='ë ˆë“œ'><br>ë ˆë“œ\n  </div>\n</div>",\n                        "divider": "",\n                        "notes": "ì˜µì…˜ ì´ë¯¸ì§€ë¥¼ 2-ì»¬ëŸ¼ìœ¼ë¡œ ë°°ì¹˜",\n                        "fullHTML": ""\n                        },\n                        {\n                        "blockId": 2,\n                        "heading": "",\n                        "copy": "",\n                        "imageLayout": "",\n                        "imageUrls": [],\n                        "bulletList": "",\n                        "tableHTML": "",\n                        "highlightBox": "",\n                        "iconText": "",\n                        "emphasisText": "",\n                        "optionImageLayout": "",\n                        "divider": "<hr>",\n                        "notes": "ì„¹ì…˜ì„ êµ¬ë¶„í•˜ëŠ” êµ¬ë¶„ì„ ",\n                        "fullHTML": ""\n                        }\n                    ]\n                    }\n                ]\n            }\n        `,c=await r.generateContent(l);console.log(c);const u=await c.response,d=await u.text();return console.log(d),ae(d)}catch(e){return console.log(e),"êµ¬ê¸€ì •ì±…ìƒ ë¶€ì ì ˆí•œ ë¦¬ë·°ê°€ í¬í•¨ë˜ì–´ ë¶„ì„ë¶ˆê°€"}}(e,n,t,o,i,s);console.log(r),chrome.tabs.sendMessage(a.id,{response:"ANALYZE_LAYOUT_PROGRESS",payload:"AI ìƒì„¸í˜ì´ì§€ ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ë§ ì¤‘..."});var l=await async function(e,n,t="gemini-2.0-flash"){if(!e.sections)return"êµ¬ê¸€ì •ì±…ìƒ ë¶€ì ì ˆí•œ ë¦¬ë·°ê°€ í¬í•¨ë˜ì–´ ë¶„ì„ë¶ˆê°€";var o=JSON.stringify(e);try{const e=new G(n).getGenerativeModel({model:t,generation_config:{responseMimeType:"application/json"}}),i=`\n            System:\n            Hello!\n            Below is the previously generated JSON data for the product detail page:\n\n            ${o}\n\n            Based on this JSON (â€œsectionsâ€), please apply the following [CSS Style Requirements].\n            If each section needs any global styling, add a '"sectionCss"' field to that section.\n            Within each block, use '"fullHTML"' to insert inline styles for font sizes, line spacing, line breaks, emphasis, etc.\n\n            Additional Requirement:\n            - If a block has 'imageUrls', please include the images in '"fullHTML"' using '<img src="...">'.\n            - Consider 'imageLayout' (Option images: up to 2-column layout; non-option images: full-width) and arrange the images accordingly in the HTML.\n\n            [CSS Style Requirements]\n\n            1) Font & Line-height\n            - Body (copy): font-size ~25px (Â±5px)\n            - Heading: font-size ~40px (Â±5px)\n            - Line-height: at least 120% of font size\n            - Multi-line headings: ~120% line-height\n            - Element margin/padding: ~20â€“30px\n            - Copy bottom margin: ~30px, top margin: ~8px\n\n            2) Line Breaking\n            - Heading: if exceeding ~8â€“15 chars, insert <br> or <div>\n            - Body: if exceeding ~15â€“25 chars, insert <br> at natural breaks\n            - If text width exceeds 2/3 of ~1000px, force a line break\n\n            3) Page Layout\n            - Width ~1000px, height ~15,000â€“30,000px\n            - Images should be full-width if possible\n            - Text should not exceed 2/3 of the full width\n\n            4) Emphasis Styles\n            - Bold, underline, background color, color inversion, etc.\n            - Important words may be bold, enlarged, background-highlighted, etc.\n\n            5) Marketing Copy Section\n            - Possibly larger/bolder fonts, partial highlights, background overlays\n            - Maintain brand color consistency\n\n            6) Keep Existing JSON Structure\n            - Root '"sections"' with 'id', 'title', 'reason', '"blocks"'\n            - Now you can add '"sectionCss"' for global styling\n            - Each block has '"heading"', '"copy"', '"imageLayout"', '"imageUrls"', '"bulletList"', '"tableHTML"', '"highlightBox"', '"iconText"', '"emphasisText"', '"optionImageLayout"', '"divider"', '"notes"', '"fullHTML"'\n            - **Include '<img src="...">'** in 'fullHTML' if there are 'imageUrls', using inline styles to position them.\n            - Return **only** JSON with '"sections"' as the root\n\n            [Goal]\n            - Take the JSON from '${o}', apply these CSS rules and image insertion to produce a final JSON.\n            - Update '"fullHTML"' with font sizes, margins, line breaks, and emphasis as needed, add '"sectionCss"' if you want global styling.\n            - **If a block has images**, ensure you show them in 'fullHTML' with '<img src="...">'.\n            - **Option images**: up to 2-column layout; **non-option images**: full-width.\n            - Output JSON only, no extra commentary or Markdown.\n\n        `,s=await e.generateContent(i);console.log(s);const a=await s.response,r=await a.text();return console.log(r),ae(r)}catch(e){return console.log(e),"êµ¬ê¸€ì •ì±…ìƒ ë¶€ì ì ˆí•œ ë¦¬ë·°ê°€ í¬í•¨ë˜ì–´ ë¶„ì„ë¶ˆê°€"}}(r,o,i);return console.log(l),l}async function ee(e,n,t="gemini-2.0-flash"){let o=0;for(;o<5;)try{return await se(e,n,t)}catch(n){if(console.error(`Attempt ${o+1} failed to label image: ${e}`,n),!n.message.includes("overloaded")&&!n.message.includes("503"))throw n;console.log("Model overloaded. Retrying after 5 seconds..."),await ce(5e3),o++}throw new Error(`Failed to label image: ${e} after 5 attempts due to overload or other errors.`)}async function ne(e,n){try{const{productId:t,images:o,productInfo:i,apiKey:s}=e;if(console.log("ìš”ì²­ë°ì´í„°:",e),!o||0===o.length)return console.error("ì´ë¯¸ì§€ê°€ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."),{hasSizeChart:!1,error:"ì´ë¯¸ì§€ê°€ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."};if(!s)return console.error("API í‚¤ê°€ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."),{hasSizeChart:!1,error:"API í‚¤ê°€ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."};K(n.id,"ì‚¬ì´ì¦ˆí‘œ ë¶„ì„ ì‹œì‘...");const a=e.geminiModel||"gemini-2.0-flash",r=new G(s).getGenerativeModel({model:a,generation_config:{responseMimeType:"application/json",temperature:.2}}),l=function(e){return`\n      ì‹œìŠ¤í…œ: ë‹¹ì‹ ì€ ì´ì»¤ë¨¸ìŠ¤ ìƒí’ˆ í˜ì´ì§€ì˜ ì‚¬ì´ì¦ˆí‘œë¥¼ ì‹ë³„í•˜ê³  ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ëŠ” AI ë„ìš°ë¯¸ì…ë‹ˆë‹¤.\n\n      ì‘ì—…: ì œê³µëœ ì´ë¯¸ì§€ì—ì„œ ìƒí’ˆì˜ ì‚¬ì´ì¦ˆí‘œ(ì¹˜ìˆ˜í‘œ)ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ìˆë‹¤ë©´ ê·¸ ë‚´ìš©ì„ êµ¬ì¡°í™”ëœ JSON í˜•ì‹ìœ¼ë¡œ\n      ì¶”ì¶œí•˜ì„¸ìš”. ì´ë¯¸ì§€ì— ì‚¬ì´ì¦ˆí‘œê°€ ì—†ìœ¼ë©´ ëª…í™•íˆ í‘œì‹œí•´ ì£¼ì„¸ìš”.\n\n      ìƒí’ˆ ì •ë³´:\n      - ìƒí’ˆëª…: ${e.productNameTrans||e.productName||""}\n\n      ì§€ì¹¨:\n      1. ì£¼ì–´ì§„ ì´ë¯¸ì§€ì—ì„œ ì‚¬ì´ì¦ˆí‘œ(ì¹˜ìˆ˜í‘œ, ê·œê²©í‘œ, ìŠ¤í™í‘œ)ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.\n      2. ì‚¬ì´ì¦ˆí‘œê°€ ìˆë‹¤ë©´:\n         - í‘œ í—¤ë”(ì‚¬ì´ì¦ˆ ì¢…ë¥˜): S, M, L, XL ë˜ëŠ” 90, 95, 100 ë“±\n         - ì¸¡ì • í•­ëª©: ì´ì¥, ì–´ê¹¨ë„ˆë¹„, ê°€ìŠ´ë‹¨ë©´, ì†Œë§¤ê¸¸ì´ ë“±\n         - ê° í•­ëª©ë³„ ìˆ˜ì¹˜\n         - ê° í•­ëª©ì˜ ë‹¨ìœ„(cm, mm, inch ë“±)ë¥¼ ì •í™•íˆ ì¶”ì¶œí•˜ì„¸ìš”.\n      3. ì¤‘êµ­ì–´ë‚˜ ì˜ì–´ë¡œ ëœ ì‚¬ì´ì¦ˆí‘œë¼ë©´ í•œêµ­ì–´ë¡œ ì ì ˆíˆ ë²ˆì—­í•˜ì„¸ìš”.\n      4. ì •í™•í•œ ìˆ«ì ê°’ì„ ìœ ì§€í•˜ì„¸ìš”.\n      5. ì‹ ë°œì‚¬ì´ì¦ˆëŠ” í•œêµ­ì—ì„œ ì‚¬ìš©í•˜ëŠ” mmë¡œ ë³€í™˜í•˜ê³ , æ–¤ìœ¼ë¡œëœ ë¬´ê²ŒëŠ” kgìœ¼ë¡œ ë³€í™˜í•´ì£¼ì„¸ìš”.\n\n      ì¶œë ¥ í˜•ì‹:\n      JSON í˜•ì‹ìœ¼ë¡œ ë‹¤ìŒ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”:\n      {\n        "hasSizeChart": true ë˜ëŠ” false,\n        "sizeChart": {\n          "sizeType": "ì˜ë¥˜ ì‚¬ì´ì¦ˆ" ë˜ëŠ” "ì‹ ë°œ ì‚¬ì´ì¦ˆ" ë“± (ìƒí’ˆ ìœ í˜•ì— ë§ê²Œ),\n          "sizes": ["S", "M", "L", "XL"] ë˜ëŠ” í•´ë‹¹í•˜ëŠ” ì‚¬ì´ì¦ˆ ë°°ì—´,\n          "measurements": [\n            {\n              "name": "ì´ì¥",\n              "unit": "cm",\n              "values": ["60", "65", "70", "75"]\n            },\n            {\n              "name": "ì–´ê¹¨ë„ˆë¹„",\n              "unit": "cm",\n              "values": ["40", "42", "44", "46"]\n            },\n            {\n              "name": "ë¬´ê²Œ",\n              "unit": "kg",\n              "values": ["0.5", "0.6", "0.7", "0.8"]\n            }\n            // ê¸°íƒ€ ì¸¡ì • í•­ëª©ë“¤...\n          ]\n        }\n      }\n\n      ì´ë¯¸ì§€ì— ì‚¬ì´ì¦ˆí‘œê°€ ì—†ëŠ” ê²½ìš°:\n      {\n        "hasSizeChart": false\n      }\n    `}(i),c=await Promise.all(o.map((e=>le(e))));K(n.id,"ì´ë¯¸ì§€ ë¶„ì„ ì¤‘..."),console.log("gemini ì‚¬ì´ì¦ˆí‘œ ìš”ì²­");const u=await r.generateContent([l,...c]),d=await u.response,p=await d.text();console.log("ì‚¬ì´ì¦ˆí‘œ ìš”ì²­ê²°ê³¼ : ",p);const m=function(e){try{const n=e.replace(/```json\n?/g,"").replace(/```/g,"").trim(),t=JSON.parse(n);if("boolean"!=typeof t.hasSizeChart)return console.warn("ì‘ë‹µì— hasSizeChart í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤:",t),{hasSizeChart:!1};if(!t.hasSizeChart)return{hasSizeChart:!1};if(!t.sizeChart)return console.warn("ì‘ë‹µì— sizeChart ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤:",t),{hasSizeChart:!1};const{sizeType:o,sizeUnits:i,sizes:s,measurements:a}=t.sizeChart;if(!o||!Array.isArray(s)||!Array.isArray(a))return console.warn("ì‚¬ì´ì¦ˆí‘œ ë°ì´í„° í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤:",t.sizeChart),{hasSizeChart:!1};const r=a.filter((e=>e.name&&Array.isArray(e.values)&&e.values.length>0));return 0===s.length||0===r.length?(console.warn("ì‚¬ì´ì¦ˆí‘œ ë°ì´í„°ê°€ ë¶ˆì¶©ë¶„í•©ë‹ˆë‹¤:",t.sizeChart),{hasSizeChart:!1}):{hasSizeChart:!0,sizeChart:{sizeType:o,sizeUnits:i,sizes:s,measurements:r}}}catch(e){return console.error("ì‚¬ì´ì¦ˆí‘œ ì‘ë‹µ íŒŒì‹± ì¤‘ ì˜¤ë¥˜:",e),{hasSizeChart:!1}}}(p);return console.log("ì‚¬ì´ì¦ˆí‘œ ì¶”ì¶œ ê²°ê³¼:",m),m.hasSizeChart?K(n.id,"ì‚¬ì´ì¦ˆí‘œ ì¶”ì¶œ ì™„ë£Œ"):K(n.id,"ì‚¬ì´ì¦ˆí‘œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤"),m}catch(e){return console.error("ì‚¬ì´ì¦ˆí‘œ ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜:",e),K(n.id,"ì‚¬ì´ì¦ˆí‘œ ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ"),{hasSizeChart:!1,error:e.message||"ì‚¬ì´ì¦ˆí‘œ ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"}}}async function te(e,n,t,o="gemini-2.0-flash",i){let s={};try{console.log("Review Content:",n),console.log("Product Info:",e),s={};var a=0;for(const n of e.detailImages){chrome.tabs.sendMessage(i.id,{response:"ANALYZE_PROGRESS",payload:"AI ìƒí’ˆ ìƒì„¸í˜ì´ì§€ ë¶„ì„ ì¤‘...("+parseInt(a/e.detailImages.length*100)+"%)"}),a++;const o=n.img;try{const e=await ee(o,t);e?s[o]=e:(console.warn(`Failed to label image: ${o}`),s[o]={imageType:"Unknown",mainContent:"ì´ë¯¸ì§€ ë¼ë²¨ë§ ì‹¤íŒ¨",marketingAngle:"Unknown",details:"ì´ë¯¸ì§€ ë¼ë²¨ë§ ì‹¤íŒ¨"})}catch(e){console.error(`Failed to label image after multiple attempts: ${o}`,e),s[o]={imageType:"Error",mainContent:"ì´ë¯¸ì§€ ë¼ë²¨ë§ ì‹¤íŒ¨ (ê³¼ë¶€í•˜)",marketingAngle:"Error",details:"API ê³¼ë¶€í•˜ë¡œ ì¸í•œ ë¼ë²¨ë§ ì‹¤íŒ¨"}}await ce(3e3)}console.log("Labeled Images:",s);const r=`\n            System:\n            You are a marketing and e-commerce expert AI. The user wants to create a product detail page (ìƒì„¸í˜ì´ì§€) for a given 1688 product, focusing on effective â€œì†Œêµ¬ì â€ (key marketing angles).\n\n            Please note:\n\n            - The user already has a set of **ìƒí’ˆì´ë¯¸ì§€**(1688ìƒí’ˆì˜ ìƒì„¸í˜ì´ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì´ë¯¸ì§€ë§ˆë‹¤ ìƒì„¸ ì„¤ëª…ì„ í•œêµ­ì–´ë¡œ ê¸°ì¬í•œ ìë£Œ) which serve as the core structure of the new detail page. You must create a marketing strategy that **primarily follows the sequence and content of these ìƒí’ˆì´ë¯¸ì§€** and then suggests additional text, images, or enhancements where appropriate.\n\n            - Any new sections or emphasis should naturally fit around these ìƒí’ˆì´ë¯¸ì§€. **Do not omit** them.\n\n            User:\n            Hello AI! I have product, review information, and **ìƒí’ˆì´ë¯¸ì§€** as follows:\n\n            [Product Information] ${JSON.stringify(e)}\n\n            [ìƒí’ˆì´ë¯¸ì§€] ${JSON.stringify(s,null,2)}\n\n            [Review Data] ${n}\n            (This is a collection of competitor product reviews from similar products or relevant reviews.)\n\n            We have 6 possible ì†Œêµ¬ì  (marketing angles):\n            1) ê¸°ëŠ¥ì  ì†Œêµ¬ì  (Functional appeal)\n            2) ë””ìì¸ ì†Œêµ¬ì  (Design appeal)\n            3) ê°ì„±Â·ìŠ¤í† ë¦¬í…”ë§ ì†Œêµ¬ì  (Emotional/Storytelling appeal)\n            4) ì‹ ë¢°ë„ ì†Œêµ¬ì  (Credibility/Trust)\n            5) ê°€ì„±ë¹„Â·í”„ë¡œëª¨ì…˜ ì†Œêµ¬ì  (Value/Promotions)\n            6) í¸ì˜ì„±Â·ë¶€ê°€ ì•ˆë‚´ ì†Œêµ¬ì  (Convenience/Support info)\n\n            Below is a reference describing each of these ì†Œêµ¬ì  in detail.\n            (Reference starts)\n            ---------------------------------------------------------\n            1. ê¸°ëŠ¥ì  ì†Œêµ¬ì \n            (ê°ê´€ì  ë°ì´í„°, ì‹œì—° ì˜ìƒ, ê²½ìŸ ì œí’ˆ ë¹„êµë¥¼ í†µí•œ ìš°ìˆ˜ì„± ê°•ì¡°)\n\n            ìœ ì‚¬ ë˜ëŠ” ê¸°ì¡´ ì œí’ˆ ëŒ€ë¹„ ê°•ì  ì†Œêµ¬ì  ì–´í•„(#13)\n            - ê¸°ì¡´ ìƒí’ˆ ëŒ€ë¹„ í–¥ìƒëœ ìŠ¤í™, ì„±ëŠ¥, í¸ì˜ì„± ë“±ì„ ë¹„êµ í‘œë‚˜ ê·¸ë˜í”„ë¡œ ì œì‹œ\n\n            ì œí’ˆ ìŠ¤í™/ì¬ì§ˆ/êµ¬ì„±í’ˆ ë“±ì„ í•˜ë‚˜í•˜ë‚˜ ë‚˜ì—´í•˜ë©° íŠ¹ì¥ì ì„ ì–´í•„í•˜ëŠ” ë¶€ë¶„(#8)\n            - í•µì‹¬ ìŠ¤í™(ì„±ëŠ¥Â·ì‚¬ì´ì¦ˆÂ·ì¬ì§ˆ ë“±)ì„ ì¤‘ì‹¬ìœ¼ë¡œ, ì™œ ìœ ìš©í•˜ê³  ìš°ìˆ˜í•œì§€ ê°ê´€ì  ê·¼ê±° ì œì‹œ\n\n            ì œí’ˆì˜ ìŠ¤í™/ì¬ì§ˆ ë“±ì„ ìƒì„¸ í‘œ ë“±ìœ¼ë¡œ ë³„ë„ë¡œ ë³´ì—¬ì§€ëŠ” ë¶€ë¶„(#12)\n            - ìƒì„¸ ìŠ¤í™ í‘œ(ì˜ˆ: CPU, ë©”ëª¨ë¦¬, ì†Œì¬ ì¸ì¦ ë“±)ë‚˜ ì¸í¬ê·¸ë˜í”½ì„ í™œìš©í•˜ì—¬ í•œëˆˆì— í™•ì¸ ê°€ëŠ¥\n\n            ë‹¤ì–‘í•œ í™œìš© ë°©ë²• ì œì•ˆ(How-to ê°€ì´ë“œ)(#17)\n            - ì‹œì—° ì˜ìƒ, ì‚¬ìš© ì˜ˆì‹œ GIF, ê°„ë‹¨í•œ ë‹¨ê³„ë³„ ì„¤ì¹˜/ì‚¬ìš© ì•ˆë‚´ ë“±ìœ¼ë¡œ ê³ ê° ì´í•´ë„ì™€ ì‹ ë¢°ë„ ìƒìŠ¹\n\n            ê¸°ëŠ¥ì  íŠ¹ì¥ì  ì–´í•„(#20)\n            - â€˜ë°°í„°ë¦¬ 2ë°° ì§€ì†â€™, â€˜íŠ¹í—ˆë°›ì€ ì½”íŒ… ê¸°ìˆ â€™ ë“± ê°ê´€ì Â·ê¸°ìˆ ì  ì¥ì ì„ ê°„ë‹¨ ë¬¸êµ¬ë‚˜ ì¸í¬ê·¸ë˜í”½ìœ¼ë¡œ ê°•ì¡°\n\n            2. ë””ìì¸ ì†Œêµ¬ì \n            (ê³ í€„ë¦¬í‹° ì´ë¯¸ì§€, ë””í…Œì¼ ì»·, ì»¬ëŸ¬Â·ê³µê°„ ì—°ì¶œ, ë¸Œëœë“œ ì´ë¯¸ì§€ ê°•í™”)\n\n            ëŒ€í‘œ ë¹„ì£¼ì–¼ì„¹ì…˜ (ì´ë¯¸ì§€/ë°°ë„ˆ)(#1)\n            - ë©”ì¸ ë°°ë„ˆ, ì¸ë„¤ì¼, ì¸íŠ¸ë¡œ ì´ë¯¸ì§€ ë“±ìœ¼ë¡œ ìƒí’ˆì˜ ì²«ì¸ìƒì„ ì„íŒ©íŠ¸ ìˆê²Œ ì „ë‹¬\n\n            ìƒí’ˆ ëŒ€í‘œ ì¹´í”¼ë¼ì´íŒ… ì„¹ì…˜(#4)\n            - ìƒí’ˆ ë¶„ìœ„ê¸°Â·ë””ìì¸ ì½˜ì…‰íŠ¸ì— ì–´ìš¸ë¦¬ëŠ” ê°•ë ¬í•˜ê³  ë§¤ë ¥ì ì¸ ì¹´í”¼ë¡œ ì‹œê°ì  ê´€ì‹¬ ìœ ë„\n\n            ì‚¬ìš©ì˜ˆì‹œ(í™œìš©ìƒ·/ì°©ìš©ìƒ·)(#5)\n            - ì‹¤ì œ ê³µê°„Â·ìƒí™©ì— ë°°ì¹˜í•œ ì´ë¯¸ì§€, ì°©ìš©ì»· ë“±ì„ í†µí•´ ë””ìì¸ ë§¤ë ¥ì„ ì§ê´€ì ìœ¼ë¡œ ë³´ì—¬ì¤Œ\n\n            ë””í…Œì¼ì»·(#6)\n            - ì†Œì¬, ë§ˆê°, ë²„íŠ¼Â·ì§€í¼ ë“± ì„¸ë¶€ ë¶€ë¶„ì„ í´ë¡œì¦ˆì—…í•´ ì œí’ˆì˜ ì™„ì„±ë„ì™€ ê³ ê¸‰ìŠ¤ëŸ¬ì›€ ê°•ì¡°\n\n            ì˜µì…˜ ì•ˆë‚´(ìƒ‰ìƒ/ì‚¬ì´ì¦ˆ ë“±)(#7)\n            - ë””ìì¸Â·ì»¬ëŸ¬ë³„ ë¹„êµ ì´ë¯¸ì§€, ì‚¬ì´ì¦ˆë³„ ì°©ìš©ê°(ì˜ë¥˜) ë“±ì„ ì‹œê°ì ìœ¼ë¡œ ì •ë¦¬\n\n            ì„ ë¬¼/íŒ¨í‚¤ì§€ ê´€ë ¨ ì•ˆë‚´(#16)\n            - ìƒí’ˆ íŒ¨í‚¤ì§€ ë””ìì¸, ì„ ë¬¼ ë°•ìŠ¤, êµ¬ì„±í’ˆ íŒ¨í‚¤ì§• ì‚¬ì§„ ë“±ì„ ë³´ì—¬ì£¼ì–´ ë””ìì¸ ê°€ì¹˜ ìƒìŠ¹\n\n            ë””ìì¸ì  íŠ¹ì¥ì  ì–´í•„(#21)\n            - â€˜ë¯¸ë‹ˆë©€ ìŠ¤íƒ€ì¼â€™, â€˜ê³¡ì„  í˜•íƒœë¡œ ì¸ì²´ê³µí•™ì  ë””ìì¸â€™ ë“± ë””ìì¸ í¬ì¸íŠ¸ë¥¼ í•œëˆˆì— ì„¤ëª…\n\n            3. ê°ì„±Â·ìŠ¤í† ë¦¬í…”ë§ ì†Œêµ¬ì \n            (ë¸Œëœë“œ ì² í•™, ê³ ê° ê³µê°, ê°œë°œÂ·ì œì‘ ë°°ê²½ ê°•ì¡°)\n\n            ìƒí’ˆ ì£¼ìš” íŠ¹ì§• ë° ìŠ¤í† ë¦¬(#3)\n            - ì œí’ˆì„ ë§Œë“¤ê²Œ ëœ ê³„ê¸°, ê³ ê°ì˜ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì•„ì´ë””ì–´ ë“± ì§§ì€ ì„œì‚¬ë¡œ ê³µê°ëŒ€ í˜•ì„±\n\n            ê°œë°œ/ì œì‘ ìŠ¤í† ë¦¬(#15)\n            - ì–´ë–¤ ê³ ë¯¼ê³¼ ê³¼ì •ì„ ê±°ì³ ì™„ì„±í–ˆëŠ”ì§€, ì‹œì œí’ˆ í…ŒìŠ¤íŠ¸ë‚˜ ì‹œí–‰ì°©ì˜¤ ë“±ì„ ì—í”¼ì†Œë“œ í˜•ì‹ìœ¼ë¡œ ì†Œê°œ\n\n            ë¸Œëœë“œ/ì œì¡°ì‚¬ì˜ íˆìŠ¤í† ë¦¬ ê°€ì¹˜ê´€ì„ ì†Œê°œí•˜ëŠ” ë¶€ë¶„(#10)\n            - ë¸Œëœë“œ ë¯¸ì…˜, ì¹œí™˜ê²½Â·ê³µì • ë¬´ì—­ ë“± ê°€ì¹˜ë¥¼ ì‹¤í˜„í•˜ëŠ” ëª¨ìŠµìœ¼ë¡œ ë¸Œëœë“œ ì´ë¯¸ì§€ë¥¼ ê°ì„±ì ìœ¼ë¡œ ì „ë‹¬\n\n            ê°ì„±Â·ìŠ¤í† ë¦¬í…”ë§ ê¸°ë°˜ ì–´í•„(#22)\n            - â€˜ì†Œë¹„ìì˜ ì‚¶ì„ ì–´ë–»ê²Œ ë³€í™”ì‹œí‚¬ ìˆ˜ ìˆëŠ”ê°€â€™, â€˜í•¨ê»˜ ë§Œë“œëŠ” ê°€ì¹˜â€™ ë“± ê°ì„±ì— í˜¸ì†Œí•˜ëŠ” ì„œì‚¬ ê°•í™”\n\n            4. ì‹ ë¢°ë„ ì†Œêµ¬ì \n            (í›„ê¸°Â·ì „ë¬¸ê°€ ë¦¬ë·°, ì¸ì¦, ìˆ˜ìƒ ì´ë ¥, ì†Œì…œë¯¸ë””ì–´ ì°¸ì—¬ ë“± ì‚¬íšŒì  ì¦ëª… ê°•ì¡°)\n\n            ë¦¬ë·° í•˜ì´ë¼ì´íŠ¸/í›„ê¸° ë° Q&A ë°œì·Œ í• ë§Œí•œ ë¶€ë¶„(#9)\n            - ê¸ì •ì ì¸ í›„ê¸°, ë³„ì  ìš”ì•½, ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ê³¼ ë‹µë³€ ë“±ì„ ê°„ë‹¨íˆ ì •ë¦¬í•´ ì‹ ë¢°ê° í˜•ì„±\n\n            ì¸ì¦/ìˆ˜ìƒ/ë³´ì¦ ì •ë³´(#18)\n            - KC, FDA, ISO ë“± ê³µì‹ ë ¥ ìˆëŠ” ì¸ì¦ ë§ˆí¬, ìˆ˜ìƒ ê²½ë ¥, íŠ¹í—ˆ ë³´ìœ  ë“±ì„ ì‹œê°ì ìœ¼ë¡œ ë°°ì¹˜\n\n            ê³ ê° ì°¸ì—¬(ì†Œì…œë¯¸ë””ì–´ ì¸ì¦ìƒ·, í•´ì‹œíƒœê·¸ ë“±)(#14)\n            - ì‹¤ì œ ì‚¬ìš©ìë“¤ì´ ì˜¬ë¦° SNS í›„ê¸°, í•´ì‹œíƒœê·¸ ëª¨ìŒ, ì´ë²¤íŠ¸ ì°¸ì—¬ ì‚¬ì§„ ë“±ì„ íë ˆì´ì…˜í•´ â€˜ì‹¤ì œ ì‚¬ìš© í›„ê¸°â€™ë¥¼ ê°•ì¡°\n\n            ì‚¬íšŒì  ì¦ëª…Â·ì‹ ë¢°ë„ ì–´í•„(#23)\n            - ì „ë¬¸ê°€Â·ì¸í”Œë£¨ì–¸ì„œ ë¦¬ë·°, ì–¸ë¡  ë³´ë„, í˜‘ë ¥ì‚¬(íŒŒíŠ¸ë„ˆì‚¬) ì†Œê°œ ë“±ì„ í†µí•´ ê°ê´€ì  ì‹ ë¢° í™•ë³´\n\n            5. ê°€ì„±ë¹„Â·í”„ë¡œëª¨ì…˜ ì†Œêµ¬ì \n            (í• ì¸ì´ë²¤íŠ¸, ì„¸íŠ¸ êµ¬ì„±, í•œì • ìˆ˜ëŸ‰/ê¸°ê°„ìœ¼ë¡œ êµ¬ë§¤ ìœ ë„)\n\n            í”„ë¡œëª¨ì…˜/ì´ë²¤íŠ¸ ì†Œê°œ(#2)\n            - í• ì¸ìœ¨, ì‚¬ì€í’ˆ ì¦ì •, í¬ì¸íŠ¸ ì ë¦½ ë“± í˜œíƒì„ ì‹œê°ì  ë°°ë„ˆë‚˜ ê°•ì¡° ë¬¸êµ¬ë¡œ ì•ˆë‚´\n\n            ê°€ê²©Â·í”„ë¡œëª¨ì…˜ì  ê°€ì¹˜ ì–´í•„(#24)\n            - ê°€ê²© ëŒ€ë¹„ ì„±ëŠ¥, í•œì • ê¸°ê°„ íŠ¹ê°€, ì„¸íŠ¸ êµ¬ë§¤ ì‹œ ì¶”ê°€ í• ì¸ ë“± ê°€ì„±ë¹„ë¥¼ ê°•ì¡°í•´ êµ¬ë§¤ ê²°ì • ìœ ë„\n\n            6. í¸ì˜ì„±Â·ë¶€ê°€ ì•ˆë‚´ ì†Œêµ¬ì \n            (ì‚¬ìš© ê°€ì´ë“œ, êµí™˜Â·ë°˜í’ˆ ì •ì±…, FAQ ë“± êµ¬ë§¤ ì „í›„ í¸ì˜ ì •ë³´ ì œê³µ)\n\n            ì¶”ê°€ ì•ˆë‚´(ì°¸ê³ ì‚¬í•­, ì£¼ì˜ì‚¬í•­, ASì •ë³´ ë“±)(#11)\n            - ì œí’ˆ ì‚¬ìš© ì‹œ ì£¼ì˜í•  ì , ë³´ì¦ ê¸°ê°„, A/S ì ˆì°¨, êµí™˜Â·í™˜ë¶ˆ ê·œì • ë“±ì„ ê°„ë‹¨íˆ ì •ë¦¬\n\n            FAQ/ìì£¼ ë¬»ëŠ” ì§ˆë¬¸(#19)\n            - ê³ ê°ë“¤ì´ ë°˜ë³µì ìœ¼ë¡œ ê¶ê¸ˆí•´í•˜ëŠ” ë¶€ë¶„ì„ ë³„ë„ ì„¹ì…˜ìœ¼ë¡œ ì •ë¦¬í•´ ë¬¸ì˜ ë¶€ë‹´ ê°ì†Œ\n\n            ì‚¬ìš© í¸ì˜Â·ë¶€ê°€ ì•ˆë‚´ ì–´í•„(#25)\n            - â€˜3ë¶„ ë§Œì— ì„¤ì¹˜â€™, â€˜ì¹´í†¡ìœ¼ë¡œ A/S ì‹ ì²­ ê°€ëŠ¥â€™ ë“± ì‚¬ìš©ì´ ê°„í¸í•˜ê³  ì§€ì›ì´ ì˜ ëœë‹¤ëŠ” ì ì„ ì ê·¹ í™ë³´\n            (Reference ends)\n            ---------------------------------------------------------\n\n            We want to build a product detail page using the existing **ìƒí’ˆì´ë¯¸ì§€** as the core layout. Please analyze the [Product Information], [ìƒí’ˆì´ë¯¸ì§€], and [Review Data], then propose multiple scenarios/options (Option A/B/C) that combine the most relevant ì†Œêµ¬ì  for this product. Each scenario must revolve around the ìƒí’ˆì´ë¯¸ì§€ì˜ ë‚´ìš©Â·ìˆœì„œ but can include short textual or design improvements in-between if it strengthens the appeal.\n\n            ### Key Requirements for the Proposals:\n\n            1. **Short, scannable format**:\n            - Use **1~2 sentence summary** for each optionâ€™s main idea, and **concise bullet points** for expected benefits.\n            - Do **not** produce long, generic paragraphs.\n\n            2. **Specific product-based details**:\n            - If a particular part of the product is frequently damaged, mention exactly how itâ€™s reinforced or improved.\n            - If thereâ€™s a certain fabric or material, describe it concretely (e.g., â€œì´ìŒìƒˆ ë¶€ë¶„ì— 2ì¤‘ ë°•ìŒì§ˆë¡œ ê°•ë„ í–¥ìƒâ€).\n            - If the product packaging caused issues, specify how the packaging is enhanced.\n\n            3. **Reason and evidence**:\n            - For each strategic angle, briefly **explain why** you recommend it, referencing the actual feedback (e.g., â€œReview Data shows many complaints about X, and the [ìƒí’ˆì´ë¯¸ì§€] shows our product addresses this with Y improvement.â€).\n            - This helps ensure itâ€™s **not** generic but tied to the productâ€™s real data. Use both Review Data and ìƒí’ˆì´ë¯¸ì§€.\n\n            4. **No generic statements** like â€œí’ˆì§ˆ ê°œì„ â€ or â€œë””ìì¸ì´ ì¢‹ë‹¤.â€ Instead, say **â€œì–´ë–¤ ë¶€ë¶„ì´, ì™œ, ì–´ë–»ê²Œ ê°œì„ ë˜ì—ˆëŠ”ì§€â€** with examples.\n\n            5. **Output**:\n            - **Answer in Korean**.\n            - **Use JSON format** with "proposals" array, no extra text outside JSON.\n            - Each item has:\n                - "optionId" ("Option A", "Option B", etc.)\n                - "title" (short and simple language)\n                - "summary" (1~2 sentences, referencing **specific** improvements or reasons using **information from ìƒí’ˆì´ë¯¸ì§€ and Review Data**)\n                - "expectedBenefits" (bullet points, referencing the real product data)\n                - "additionalNotes" (if needed)\n                - The most recommended option should be "Option A".\n\n            #### Example JSON (in Korean, no extra text outside JSON):\n\n            \`\`\`json\n            {\n            "proposals": [\n                {\n                "optionId": "Option A",\n                "title": "ê°•í™”ëœ ë‚´ë¶€ í”„ë ˆì„ê³¼ ì‰¬ìš´ ë¶„ë¦¬ êµ¬ì¡°",\n                "summary": "ë¦¬ë·°ì—ì„œ íŒŒì†Â·ë¶„ë¦¬ ì–´ë ¤ì›€ì´ ì§€ì ëœ ë§Œí¼, and the ìƒì„¸ì»· from ìƒí’ˆì´ë¯¸ì§€ shows ë‚´ë¶€ ì§€ì§€ëŒ€ ë³´ê°•ê³¼ ì†ì¡ì´ êµ¬ì¡° ê°œì„ ì„ í†µí•´...",\n                "expectedBenefits": [\n                    "ë‚´êµ¬ì„± í–¥ìƒìœ¼ë¡œ íŒŒì† ìµœì†Œí™”",\n                    "ë°•ìŠ¤ ë¶„ë¦¬ ì‘ì—… ê°„í¸í™”",\n                    "ë¶€ì • ë¦¬ë·° ë¶ˆì•ˆ í•´ì†Œë¡œ ì‹ ë¢°ë„ ìƒìŠ¹"\n                ],\n                "additionalNotes": "ì˜ˆ: ë°•ìŒì§ˆ ë¼ì¸ ë³´ê°•, ì½”ë„ˆ ë³´í˜¸ëŒ€ ì¶”ê°€"\n                }\n            ]\n            }\n            \`\`\`\n\n            **Important**:\n            - No extra text outside JSON.\n            - Make sure the **ìƒí’ˆì´ë¯¸ì§€** sequence is respected and included as is, while proposing how to enhance or highlight them with text/copy.\n            - Provide **concrete improvements** or changes (e.g., â€œì†ì¡ì´ êµ¬ì¡° ê°œì„ â€, â€œëª¨ì„œë¦¬ ì™„ì¶©ì¬ ì¶”ê°€â€) rather than generic statements.\n            - Keep it concise.\n\n            Thank you!\n\n        `,l=new G(t).getGenerativeModel({model:o,generation_config:{responseMimeType:"application/json"}}),c=await l.generateContent(r);console.log(c);const u=await c.response,d=await u.text();console.log("Final AI Response:",d);let p=null;try{p=ae(d)}catch(i){return console.error("JSON íŒŒì‹± ì‹¤íŒ¨, ì¬ì‹œë„:",i),await ce(5e3),await async function(e,n,t,o,i,s){try{console.log("Retrying getReviewAnalysis...");const i=`\n            System:\n            You are a marketing and e-commerce expert AI. The user wants to create a product detail page (ìƒì„¸í˜ì´ì§€) for a given 1688 product, focusing on effective â€œì†Œêµ¬ì â€ (key marketing angles).\n\n            Please note:\n\n            - The user already has a set of **ìƒí’ˆì´ë¯¸ì§€**(1688ìƒí’ˆì˜ ìƒì„¸í˜ì´ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì´ë¯¸ì§€ë§ˆë‹¤ ìƒì„¸ ì„¤ëª…ì„ í•œêµ­ì–´ë¡œ ê¸°ì¬í•œ ìë£Œ) which serve as the core structure of the new detail page. You must create a marketing strategy that **primarily follows the sequence and content of these ìƒí’ˆì´ë¯¸ì§€** and then suggests additional text, images, or enhancements where appropriate.\n\n            - Any new sections or emphasis should naturally fit around these ìƒí’ˆì´ë¯¸ì§€. **Do not omit** them.\n\n            User:\n            Hello AI! I have product, review information, and **ìƒí’ˆì´ë¯¸ì§€** as follows:\n\n            [Product Information] ${JSON.stringify(e)}\n\n            [ìƒí’ˆì´ë¯¸ì§€] ${JSON.stringify(s,null,2)}\n\n            [Review Data] ${n}\n            (This is a collection of competitor product reviews from similar products or relevant reviews.)\n\n            We have 6 possible ì†Œêµ¬ì  (marketing angles):\n            1) ê¸°ëŠ¥ì  ì†Œêµ¬ì  (Functional appeal)\n            2) ë””ìì¸ ì†Œêµ¬ì  (Design appeal)\n            3) ê°ì„±Â·ìŠ¤í† ë¦¬í…”ë§ ì†Œêµ¬ì  (Emotional/Storytelling appeal)\n            4) ì‹ ë¢°ë„ ì†Œêµ¬ì  (Credibility/Trust)\n            5) ê°€ì„±ë¹„Â·í”„ë¡œëª¨ì…˜ ì†Œêµ¬ì  (Value/Promotions)\n            6) í¸ì˜ì„±Â·ë¶€ê°€ ì•ˆë‚´ ì†Œêµ¬ì  (Convenience/Support info)\n\n            Below is a reference describing each of these ì†Œêµ¬ì  in detail.\n            (Reference starts)\n            ---------------------------------------------------------\n            1. ê¸°ëŠ¥ì  ì†Œêµ¬ì \n            (ê°ê´€ì  ë°ì´í„°, ì‹œì—° ì˜ìƒ, ê²½ìŸ ì œí’ˆ ë¹„êµë¥¼ í†µí•œ ìš°ìˆ˜ì„± ê°•ì¡°)\n\n            ìœ ì‚¬ ë˜ëŠ” ê¸°ì¡´ ì œí’ˆ ëŒ€ë¹„ ê°•ì  ì†Œêµ¬ì  ì–´í•„(#13)\n            - ê¸°ì¡´ ìƒí’ˆ ëŒ€ë¹„ í–¥ìƒëœ ìŠ¤í™, ì„±ëŠ¥, í¸ì˜ì„± ë“±ì„ ë¹„êµ í‘œë‚˜ ê·¸ë˜í”„ë¡œ ì œì‹œ\n\n            ì œí’ˆ ìŠ¤í™/ì¬ì§ˆ/êµ¬ì„±í’ˆ ë“±ì„ í•˜ë‚˜í•˜ë‚˜ ë‚˜ì—´í•˜ë©° íŠ¹ì¥ì ì„ ì–´í•„í•˜ëŠ” ë¶€ë¶„(#8)\n            - í•µì‹¬ ìŠ¤í™(ì„±ëŠ¥Â·ì‚¬ì´ì¦ˆÂ·ì¬ì§ˆ ë“±)ì„ ì¤‘ì‹¬ìœ¼ë¡œ, ì™œ ìœ ìš©í•˜ê³  ìš°ìˆ˜í•œì§€ ê°ê´€ì  ê·¼ê±° ì œì‹œ\n\n            ì œí’ˆì˜ ìŠ¤í™/ì¬ì§ˆ ë“±ì„ ìƒì„¸ í‘œ ë“±ìœ¼ë¡œ ë³„ë„ë¡œ ë³´ì—¬ì§€ëŠ” ë¶€ë¶„(#12)\n            - ìƒì„¸ ìŠ¤í™ í‘œ(ì˜ˆ: CPU, ë©”ëª¨ë¦¬, ì†Œì¬ ì¸ì¦ ë“±)ë‚˜ ì¸í¬ê·¸ë˜í”½ì„ í™œìš©í•˜ì—¬ í•œëˆˆì— í™•ì¸ ê°€ëŠ¥\n\n            ë‹¤ì–‘í•œ í™œìš© ë°©ë²• ì œì•ˆ(How-to ê°€ì´ë“œ)(#17)\n            - ì‹œì—° ì˜ìƒ, ì‚¬ìš© ì˜ˆì‹œ GIF, ê°„ë‹¨í•œ ë‹¨ê³„ë³„ ì„¤ì¹˜/ì‚¬ìš© ì•ˆë‚´ ë“±ìœ¼ë¡œ ê³ ê° ì´í•´ë„ì™€ ì‹ ë¢°ë„ ìƒìŠ¹\n\n            ê¸°ëŠ¥ì  íŠ¹ì¥ì  ì–´í•„(#20)\n            - â€˜ë°°í„°ë¦¬ 2ë°° ì§€ì†â€™, â€˜íŠ¹í—ˆë°›ì€ ì½”íŒ… ê¸°ìˆ â€™ ë“± ê°ê´€ì Â·ê¸°ìˆ ì  ì¥ì ì„ ê°„ë‹¨ ë¬¸êµ¬ë‚˜ ì¸í¬ê·¸ë˜í”½ìœ¼ë¡œ ê°•ì¡°\n\n            2. ë””ìì¸ ì†Œêµ¬ì \n            (ê³ í€„ë¦¬í‹° ì´ë¯¸ì§€, ë””í…Œì¼ ì»·, ì»¬ëŸ¬Â·ê³µê°„ ì—°ì¶œ, ë¸Œëœë“œ ì´ë¯¸ì§€ ê°•í™”)\n\n            ëŒ€í‘œ ë¹„ì£¼ì–¼ì„¹ì…˜ (ì´ë¯¸ì§€/ë°°ë„ˆ)(#1)\n            - ë©”ì¸ ë°°ë„ˆ, ì¸ë„¤ì¼, ì¸íŠ¸ë¡œ ì´ë¯¸ì§€ ë“±ìœ¼ë¡œ ìƒí’ˆì˜ ì²«ì¸ìƒì„ ì„íŒ©íŠ¸ ìˆê²Œ ì „ë‹¬\n\n            ìƒí’ˆ ëŒ€í‘œ ì¹´í”¼ë¼ì´íŒ… ì„¹ì…˜(#4)\n            - ìƒí’ˆ ë¶„ìœ„ê¸°Â·ë””ìì¸ ì½˜ì…‰íŠ¸ì— ì–´ìš¸ë¦¬ëŠ” ê°•ë ¬í•˜ê³  ë§¤ë ¥ì ì¸ ì¹´í”¼ë¡œ ì‹œê°ì  ê´€ì‹¬ ìœ ë„\n\n            ì‚¬ìš©ì˜ˆì‹œ(í™œìš©ìƒ·/ì°©ìš©ìƒ·)(#5)\n            - ì‹¤ì œ ê³µê°„Â·ìƒí™©ì— ë°°ì¹˜í•œ ì´ë¯¸ì§€, ì°©ìš©ì»· ë“±ì„ í†µí•´ ë””ìì¸ ë§¤ë ¥ì„ ì§ê´€ì ìœ¼ë¡œ ë³´ì—¬ì¤Œ\n\n            ë””í…Œì¼ì»·(#6)\n            - ì†Œì¬, ë§ˆê°, ë²„íŠ¼Â·ì§€í¼ ë“± ì„¸ë¶€ ë¶€ë¶„ì„ í´ë¡œì¦ˆì—…í•´ ì œí’ˆì˜ ì™„ì„±ë„ì™€ ê³ ê¸‰ìŠ¤ëŸ¬ì›€ ê°•ì¡°\n\n            ì˜µì…˜ ì•ˆë‚´(ìƒ‰ìƒ/ì‚¬ì´ì¦ˆ ë“±)(#7)\n            - ë””ìì¸Â·ì»¬ëŸ¬ë³„ ë¹„êµ ì´ë¯¸ì§€, ì‚¬ì´ì¦ˆë³„ ì°©ìš©ê°(ì˜ë¥˜) ë“±ì„ ì‹œê°ì ìœ¼ë¡œ ì •ë¦¬\n\n            ì„ ë¬¼/íŒ¨í‚¤ì§€ ê´€ë ¨ ì•ˆë‚´(#16)\n            - ìƒí’ˆ íŒ¨í‚¤ì§€ ë””ìì¸, ì„ ë¬¼ ë°•ìŠ¤, êµ¬ì„±í’ˆ íŒ¨í‚¤ì§• ì‚¬ì§„ ë“±ì„ ë³´ì—¬ì£¼ì–´ ë””ìì¸ ê°€ì¹˜ ìƒìŠ¹\n\n            ë””ìì¸ì  íŠ¹ì¥ì  ì–´í•„(#21)\n            - â€˜ë¯¸ë‹ˆë©€ ìŠ¤íƒ€ì¼â€™, â€˜ê³¡ì„  í˜•íƒœë¡œ ì¸ì²´ê³µí•™ì  ë””ìì¸â€™ ë“± ë””ìì¸ í¬ì¸íŠ¸ë¥¼ í•œëˆˆì— ì„¤ëª…\n\n            3. ê°ì„±Â·ìŠ¤í† ë¦¬í…”ë§ ì†Œêµ¬ì \n            (ë¸Œëœë“œ ì² í•™, ê³ ê° ê³µê°, ê°œë°œÂ·ì œì‘ ë°°ê²½ ê°•ì¡°)\n\n            ìƒí’ˆ ì£¼ìš” íŠ¹ì§• ë° ìŠ¤í† ë¦¬(#3)\n            - ì œí’ˆì„ ë§Œë“¤ê²Œ ëœ ê³„ê¸°, ê³ ê°ì˜ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì•„ì´ë””ì–´ ë“± ì§§ì€ ì„œì‚¬ë¡œ ê³µê°ëŒ€ í˜•ì„±\n\n            ê°œë°œ/ì œì‘ ìŠ¤í† ë¦¬(#15)\n            - ì–´ë–¤ ê³ ë¯¼ê³¼ ê³¼ì •ì„ ê±°ì³ ì™„ì„±í–ˆëŠ”ì§€, ì‹œì œí’ˆ í…ŒìŠ¤íŠ¸ë‚˜ ì‹œí–‰ì°©ì˜¤ ë“±ì„ ì—í”¼ì†Œë“œ í˜•ì‹ìœ¼ë¡œ ì†Œê°œ\n\n            ë¸Œëœë“œ/ì œì¡°ì‚¬ì˜ íˆìŠ¤í† ë¦¬ ê°€ì¹˜ê´€ì„ ì†Œê°œí•˜ëŠ” ë¶€ë¶„(#10)\n            - ë¸Œëœë“œ ë¯¸ì…˜, ì¹œí™˜ê²½Â·ê³µì • ë¬´ì—­ ë“± ê°€ì¹˜ë¥¼ ì‹¤í˜„í•˜ëŠ” ëª¨ìŠµìœ¼ë¡œ ë¸Œëœë“œ ì´ë¯¸ì§€ë¥¼ ê°ì„±ì ìœ¼ë¡œ ì „ë‹¬\n\n            ê°ì„±Â·ìŠ¤í† ë¦¬í…”ë§ ê¸°ë°˜ ì–´í•„(#22)\n            - â€˜ì†Œë¹„ìì˜ ì‚¶ì„ ì–´ë–»ê²Œ ë³€í™”ì‹œí‚¬ ìˆ˜ ìˆëŠ”ê°€â€™, â€˜í•¨ê»˜ ë§Œë“œëŠ” ê°€ì¹˜â€™ ë“± ê°ì„±ì— í˜¸ì†Œí•˜ëŠ” ì„œì‚¬ ê°•í™”\n\n            4. ì‹ ë¢°ë„ ì†Œêµ¬ì \n            (í›„ê¸°Â·ì „ë¬¸ê°€ ë¦¬ë·°, ì¸ì¦, ìˆ˜ìƒ ì´ë ¥, ì†Œì…œë¯¸ë””ì–´ ì°¸ì—¬ ë“± ì‚¬íšŒì  ì¦ëª… ê°•ì¡°)\n\n            ë¦¬ë·° í•˜ì´ë¼ì´íŠ¸/í›„ê¸° ë° Q&A ë°œì·Œ í• ë§Œí•œ ë¶€ë¶„(#9)\n            - ê¸ì •ì ì¸ í›„ê¸°, ë³„ì  ìš”ì•½, ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ê³¼ ë‹µë³€ ë“±ì„ ê°„ë‹¨íˆ ì •ë¦¬í•´ ì‹ ë¢°ê° í˜•ì„±\n\n            ì¸ì¦/ìˆ˜ìƒ/ë³´ì¦ ì •ë³´(#18)\n            - KC, FDA, ISO ë“± ê³µì‹ ë ¥ ìˆëŠ” ì¸ì¦ ë§ˆí¬, ìˆ˜ìƒ ê²½ë ¥, íŠ¹í—ˆ ë³´ìœ  ë“±ì„ ì‹œê°ì ìœ¼ë¡œ ë°°ì¹˜\n\n            ê³ ê° ì°¸ì—¬(ì†Œì…œë¯¸ë””ì–´ ì¸ì¦ìƒ·, í•´ì‹œíƒœê·¸ ë“±)(#14)\n            - ì‹¤ì œ ì‚¬ìš©ìë“¤ì´ ì˜¬ë¦° SNS í›„ê¸°, í•´ì‹œíƒœê·¸ ëª¨ìŒ, ì´ë²¤íŠ¸ ì°¸ì—¬ ì‚¬ì§„ ë“±ì„ íë ˆì´ì…˜í•´ â€˜ì‹¤ì œ ì‚¬ìš© í›„ê¸°â€™ë¥¼ ê°•ì¡°\n\n            ì‚¬íšŒì  ì¦ëª…Â·ì‹ ë¢°ë„ ì–´í•„(#23)\n            - ì „ë¬¸ê°€Â·ì¸í”Œë£¨ì–¸ì„œ ë¦¬ë·°, ì–¸ë¡  ë³´ë„, í˜‘ë ¥ì‚¬(íŒŒíŠ¸ë„ˆì‚¬) ì†Œê°œ ë“±ì„ í†µí•´ ê°ê´€ì  ì‹ ë¢° í™•ë³´\n\n            5. ê°€ì„±ë¹„Â·í”„ë¡œëª¨ì…˜ ì†Œêµ¬ì \n            (í• ì¸ì´ë²¤íŠ¸, ì„¸íŠ¸ êµ¬ì„±, í•œì • ìˆ˜ëŸ‰/ê¸°ê°„ìœ¼ë¡œ êµ¬ë§¤ ìœ ë„)\n\n            í”„ë¡œëª¨ì…˜/ì´ë²¤íŠ¸ ì†Œê°œ(#2)\n            - í• ì¸ìœ¨, ì‚¬ì€í’ˆ ì¦ì •, í¬ì¸íŠ¸ ì ë¦½ ë“± í˜œíƒì„ ì‹œê°ì  ë°°ë„ˆë‚˜ ê°•ì¡° ë¬¸êµ¬ë¡œ ì•ˆë‚´\n\n            ê°€ê²©Â·í”„ë¡œëª¨ì…˜ì  ê°€ì¹˜ ì–´í•„(#24)\n            - ê°€ê²© ëŒ€ë¹„ ì„±ëŠ¥, í•œì • ê¸°ê°„ íŠ¹ê°€, ì„¸íŠ¸ êµ¬ë§¤ ì‹œ ì¶”ê°€ í• ì¸ ë“± ê°€ì„±ë¹„ë¥¼ ê°•ì¡°í•´ êµ¬ë§¤ ê²°ì • ìœ ë„\n\n            6. í¸ì˜ì„±Â·ë¶€ê°€ ì•ˆë‚´ ì†Œêµ¬ì \n            (ì‚¬ìš© ê°€ì´ë“œ, êµí™˜Â·ë°˜í’ˆ ì •ì±…, FAQ ë“± êµ¬ë§¤ ì „í›„ í¸ì˜ ì •ë³´ ì œê³µ)\n\n            ì¶”ê°€ ì•ˆë‚´(ì°¸ê³ ì‚¬í•­, ì£¼ì˜ì‚¬í•­, ASì •ë³´ ë“±)(#11)\n            - ì œí’ˆ ì‚¬ìš© ì‹œ ì£¼ì˜í•  ì , ë³´ì¦ ê¸°ê°„, A/S ì ˆì°¨, êµí™˜Â·í™˜ë¶ˆ ê·œì • ë“±ì„ ê°„ë‹¨íˆ ì •ë¦¬\n\n            FAQ/ìì£¼ ë¬»ëŠ” ì§ˆë¬¸(#19)\n            - ê³ ê°ë“¤ì´ ë°˜ë³µì ìœ¼ë¡œ ê¶ê¸ˆí•´í•˜ëŠ” ë¶€ë¶„ì„ ë³„ë„ ì„¹ì…˜ìœ¼ë¡œ ì •ë¦¬í•´ ë¬¸ì˜ ë¶€ë‹´ ê°ì†Œ\n\n            ì‚¬ìš© í¸ì˜Â·ë¶€ê°€ ì•ˆë‚´ ì–´í•„(#25)\n            - â€˜3ë¶„ ë§Œì— ì„¤ì¹˜â€™, â€˜ì¹´í†¡ìœ¼ë¡œ A/S ì‹ ì²­ ê°€ëŠ¥â€™ ë“± ì‚¬ìš©ì´ ê°„í¸í•˜ê³  ì§€ì›ì´ ì˜ ëœë‹¤ëŠ” ì ì„ ì ê·¹ í™ë³´\n            (Reference ends)\n            ---------------------------------------------------------\n\n            We want to build a product detail page using the existing **ìƒí’ˆì´ë¯¸ì§€** as the core layout. Please analyze the [Product Information], [ìƒí’ˆì´ë¯¸ì§€], and [Review Data], then propose multiple scenarios/options (Option A/B/C) that combine the most relevant ì†Œêµ¬ì  for this product. Each scenario must revolve around the ìƒí’ˆì´ë¯¸ì§€ì˜ ë‚´ìš©Â·ìˆœì„œ but can include short textual or design improvements in-between if it strengthens the appeal.\n\n            ### Key Requirements for the Proposals:\n\n            1. **Short, scannable format**:\n            - Use **1~2 sentence summary** for each optionâ€™s main idea, and **concise bullet points** for expected benefits.\n            - Do **not** produce long, generic paragraphs.\n\n            2. **Specific product-based details**:\n            - If a particular part of the product is frequently damaged, mention exactly how itâ€™s reinforced or improved.\n            - If thereâ€™s a certain fabric or material, describe it concretely (e.g., â€œì´ìŒìƒˆ ë¶€ë¶„ì— 2ì¤‘ ë°•ìŒì§ˆë¡œ ê°•ë„ í–¥ìƒâ€).\n            - If the product packaging caused issues, specify how the packaging is enhanced.\n\n            3. **Reason and evidence**:\n            - For each strategic angle, briefly **explain why** you recommend it, referencing the actual feedback (e.g., â€œReview Data shows many complaints about X, and the [ìƒí’ˆì´ë¯¸ì§€] shows our product addresses this with Y improvement.â€).\n            - This helps ensure itâ€™s **not** generic but tied to the productâ€™s real data. Use both Review Data and ìƒí’ˆì´ë¯¸ì§€.\n\n            4. **No generic statements** like â€œí’ˆì§ˆ ê°œì„ â€ or â€œë””ìì¸ì´ ì¢‹ë‹¤.â€ Instead, say **â€œì–´ë–¤ ë¶€ë¶„ì´, ì™œ, ì–´ë–»ê²Œ ê°œì„ ë˜ì—ˆëŠ”ì§€â€** with examples.\n\n            5. **Output**:\n            - **Answer in Korean**.\n            - **Use JSON format** with "proposals" array, no extra text outside JSON.\n            - Each item has:\n                - "optionId" ("Option A", "Option B", etc.)\n                - "title" (short and simple language)\n                - "summary" (1~2 sentences, referencing **specific** improvements or reasons using **information from ìƒí’ˆì´ë¯¸ì§€ and Review Data**)\n                - "expectedBenefits" (bullet points, referencing the real product data)\n                - "additionalNotes" (if needed)\n                - The most recommended option should be "Option A".\n\n            #### Example JSON (in Korean, no extra text outside JSON):\n\n            \`\`\`json\n            {\n            "proposals": [\n                {\n                "optionId": "Option A",\n                "title": "ê°•í™”ëœ ë‚´ë¶€ í”„ë ˆì„ê³¼ ì‰¬ìš´ ë¶„ë¦¬ êµ¬ì¡°",\n                "summary": "ë¦¬ë·°ì—ì„œ íŒŒì†Â·ë¶„ë¦¬ ì–´ë ¤ì›€ì´ ì§€ì ëœ ë§Œí¼, and the ìƒì„¸ì»· from ìƒí’ˆì´ë¯¸ì§€ shows ë‚´ë¶€ ì§€ì§€ëŒ€ ë³´ê°•ê³¼ ì†ì¡ì´ êµ¬ì¡° ê°œì„ ì„ í†µí•´...",\n                "expectedBenefits": [\n                    "ë‚´êµ¬ì„± í–¥ìƒìœ¼ë¡œ íŒŒì† ìµœì†Œí™”",\n                    "ë°•ìŠ¤ ë¶„ë¦¬ ì‘ì—… ê°„í¸í™”",\n                    "ë¶€ì • ë¦¬ë·° ë¶ˆì•ˆ í•´ì†Œë¡œ ì‹ ë¢°ë„ ìƒìŠ¹"\n                ],\n                "additionalNotes": "ì˜ˆ: ë°•ìŒì§ˆ ë¼ì¸ ë³´ê°•, ì½”ë„ˆ ë³´í˜¸ëŒ€ ì¶”ê°€"\n                }\n            ]\n            }\n            \`\`\`\n\n            **Important**:\n            - No extra text outside JSON.\n            - Make sure the **ìƒí’ˆì´ë¯¸ì§€** sequence is respected and included as is, while proposing how to enhance or highlight them with text/copy.\n            - Provide **concrete improvements** or changes (e.g., â€œì†ì¡ì´ êµ¬ì¡° ê°œì„ â€, â€œëª¨ì„œë¦¬ ì™„ì¶©ì¬ ì¶”ê°€â€) rather than generic statements.\n            - Keep it concise.\n\n            Thank you!\n\n        `,a=new G(t).getGenerativeModel({model:o,generation_config:{responseMimeType:"application/json"}}),r=await a.generateContent(i);console.log(r);const l=await r.response,c=await l.text();return console.log("Final AI Response (Retry):",c),{result:ae(c),error:"",labeledImages:s}}catch(e){return console.error("Error in retryGetReviewAnalysis:",e),{result:"êµ¬ê¸€ì •ì±…ìƒ ë¶€ì ì ˆí•œ ë¦¬ë·°ê°€ í¬í•¨ë˜ì–´ ë¶„ì„ë¶ˆê°€",error:e,labeledImages:s}}}(e,n,t,o,0,s)}return{result:p,error:"",labeledImages:s}}catch(e){return console.error("Error in getReviewAnalysis:",e),{result:"êµ¬ê¸€ì •ì±…ìƒ ë¶€ì ì ˆí•œ ë¦¬ë·°ê°€ í¬í•¨ë˜ì–´ ë¶„ì„ë¶ˆê°€",error:e,labeledImages:s}}}async function oe(e,n,t="gemini-2.0-flash"){try{console.log(e);const o=new G(n).getGenerativeModel({model:t,generation_config:{responseMimeType:"application/json"}}),i=`\n            review data: ${e}\n\n            Analyze the provided review data to summarize the strengths of the product that customers appreciated, as well as the common complaints. If there are no significant weaknesses or areas for improvement, recommend selecting products that maximize the current strengths. Finally, develop a sourcing strategy for new products that incorporates these insights. Please provide the results in Korean and format the output as following structure:\n            [ìƒí’ˆ ë¶„ì„ ê²°ê³¼"]\n            ê°•ì 1\n            ê°•ì 2\n            ê°•ì 3\n            ë¶ˆë§Œì‚¬í•­1\n            ë¶ˆë§Œì‚¬í•­2\n            ...\n\n            ê°œì„  ë°©ì•ˆ ì„¤ëª…,\n            ì†Œì‹± ì „ëµ ì„¤ëª…\n            Ensure that all text content is in Korean.\n        `,s=await o.generateContent(i);console.log(s);const a=await s.response,r=await a.text();return console.log(r),r}catch(e){return console.log(e),"êµ¬ê¸€ì •ì±…ìƒ ë¶€ì ì ˆí•œ ë¦¬ë·°ê°€ í¬í•¨ë˜ì–´ ë¶„ì„ë¶ˆê°€"}}async function ie(e,n,t,o,i="gemini-2.0-flash"){const s=new G(o).getGenerativeModel({model:i,generation_config:{responseMimeType:"application/json"}}),a=`\n        1. êµ¬ë§¤ì˜µì…˜(JSON) : ${JSON.stringify(t)}\n        2. ìƒí’ˆëª… : ${n}\n        3. ìƒí’ˆì´ë¯¸ì§€ : ì²¨ë¶€ì´ë¯¸ì§€(${e})\n\n        ìœ„ì˜ ìƒí’ˆì •ë³´(2. ìƒí’ˆëª…ê³¼ 3. ìƒí’ˆì´ë¯¸ì§€)ë¥¼ ì°¸ê³ í•˜ì—¬ "1. êµ¬ë§¤ì˜µì…˜(JSON)"ì—ì„œ ë§¤ì¹­ë˜ëŠ” ì˜µì…˜ë“¤ì„ ì°¾ì•„ì„œ ì˜µì…˜ì¢…ë¥˜ ë° êµ¬ë§¤ìˆ˜ëŸ‰ì„ ì•Œë ¤ì¤˜.\n        êµ¬ë§¤ìˆ˜ëŸ‰ì€ ìœ„ì˜ ìƒí’ˆì •ë³´ì— í•´ë‹¹ë˜ëŠ” ì œí’ˆì„ 1ê±´ êµ¬ë§¤í–ˆì„ ê²½ìš° êµ¬ì„±ë˜ëŠ” ì˜µì…˜ë³„ êµ¬ë§¤ìˆ˜ëŸ‰ì„ ì–˜ê¸°í•˜ëŠ” ê²ƒì´ë‹¤.\n        ì˜ˆë¥¼ë“¤ì–´ì„œ í™”ì´íŠ¸ 1ê°œ, ë¸”ë™ 1ê°œì˜ ì¡°í•©ìœ¼ë¡œ 1setë¡œ íŒë§¤í•˜ëŠ” ìƒí’ˆì¸ ê²½ìš°ì—ëŠ” í™”ì´íŠ¸ì˜ optionName, price, quantityì—ì„œ quantityê°€ 1ê°œ, ë¸”ë™ì˜ optionName, price, quantityë¡œ quantity 1ê°œ ì´ë ‡ê²Œ ê²°ê³¼ê°€ ë‚˜ì™€ì•¼ í•œë‹¤.\n        í™”ì´íŠ¸ 2ê°œê°€ 1setì¸ ê²½ìš°ì—ëŠ” {optionName : í™”ì´íŠ¸ì˜ ì˜µì…˜ì¢…ë¥˜ ë§¤ì¹­ë˜ëŠ” ì˜µì…˜ëª…, price : í™”ì´íŠ¸ì— í•´ë‹¹í•˜ëŠ” ê°€ê²©, quantity : 2} ì´ëŸ°ì‹ìœ¼ë¡œ ê²°ê³¼ê°€ ë‚˜ì™€ì•¼ í•œë‹¤.\n        ë§¤ì¹­ë˜ëŠ” ì˜µì…˜ì´ ì—†ëŠ” ê²½ìš°ì—ëŠ” {optionName : "", price : 0, quantity : 0} ìœ¼ë¡œ ì¶œë ¥í•´ì•¼ í•œë‹¤.\n        (ì¶œë ¥í˜•ì‹ : json data (array))\n        (ì¶œë ¥ì˜ˆì‹œ : [{optionName:"è“è‰²2023æ–°æ¬¾", price:"2.75", quantity:2},{optionName:"ç²‰è‰²2023æ–°æ¬¾", price:"2.75", quantity:1}])\n    `,r=[e],l=await Promise.all(r.map(le)),c=await s.generateContent([a,...l]);console.log(c);const u=await c.response,d=await u.text();return console.log(d),ae(d)}async function se(e,n,t="gemini-2.0-flash"){try{const o=new G(n).getGenerativeModel({model:t}),i=await le(e);if(!i)return console.error("Failed to convert image to generative part for:",e),null;const s='\n            Describe this image for e-commerce product detail page creation in Korean. Be concise, but ensure the ë¼ë²¨ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì  ì •ë³´ê°€ ë“¤ì–´ ìˆìŠµë‹ˆë‹¤.\n\n            Image Type: (ë©”ì¸ ì—°ì¶œì»·, ë¼ì´í”„ìŠ¤íƒ€ì¼/ì‚¬ìš© ì—°ì¶œì»·, ìƒì„¸ ë””í…Œì¼ì»·, ì‚¬ì´ì¦ˆ/ê·œê²© ì•ˆë‚´ ì´ë¯¸ì§€, ì˜µì…˜ë³„ ì»¬ëŸ¬Â·ì¢…ë¥˜ ì•ˆë‚´ ì´ë¯¸ì§€, êµ¬ì„±í’ˆÂ·íŒ¨í‚¤ì§€ êµ¬ì„± ì•ˆë‚´ ì´ë¯¸ì§€, ì‚¬ìš© ë°©ë²•Â·ì„¤ì¹˜ ê°€ì´ë“œ ì´ë¯¸ì§€, íŠ¹ì¥ì Â·í•µì‹¬ ê¸°ëŠ¥ ê°•ì¡° ì´ë¯¸ì§€, ê³ ê° ë¦¬ë·°Â·í›„ê¸° ì¸ìš© ì´ë¯¸ì§€, ë¸Œëœë“œ/ì œì¡°ì‚¬ ì†Œê°œ ì´ë¯¸ì§€, ì¸ì¦ì„œÂ·íŠ¹í—ˆÂ·ì‹œí—˜ì„±ì ì„œ ë“± ì¦ë¹™ ì´ë¯¸ì§€, ì£¼ì˜ì‚¬í•­Â·ì•ˆì „ ê²½ê³  ì•ˆë‚´ ì´ë¯¸ì§€, A/S ë° êµí™˜Â·ë°˜í’ˆ ì•ˆë‚´ ì´ë¯¸ì§€, ì´ë²¤íŠ¸Â·í”„ë¡œëª¨ì…˜ ì•ˆë‚´ ì´ë¯¸ì§€, ë“±)\n\n            Main Content: (ìƒí’ˆì˜ ì–´ë–¤ ë¶€ë¶„ì„ ë³´ì—¬ì£¼ëŠ”ì§€, ë””ìì¸ íŠ¹ì§•, ê°•ì¡°ì )\n\n            Marketing Angle: (ê¸°ëŠ¥, ë””ìì¸, ê°ì„±, ì‹ ë¢°ë„, ê°€ì„±ë¹„, í¸ì˜ì„± ì¤‘ ì–´ë–¤ ì†Œêµ¬ì ì„ ì–´í•„í•˜ëŠ”ì§€)\n\n            Details: (ì¬ì§ˆ, ìƒ‰ìƒ, í¬ê¸°, ì‚¬ìš© ìš©ë„ ë“± êµ¬ì²´ì  íŠ¹ì§•ì„ ì„¤ëª…. ê¸°ì¡´ ì¤‘êµ­ì–´ê°€ ì í˜€ ìˆì—ˆë‹¤ë©´, í•œêµ­ì–´ë¡œ ê°„ëµí•˜ê²Œ ë³€í™˜/ìš”ì•½í•˜ì—¬ ê¸°ì¬.)\n\n            Answer in Korean.\n            Output must be JSON with the following keys:\n\n            { "imageType": "...", "mainContent": "...", "marketingAngle": "...", "details": "..." }\n\n        ',a=await o.generateContent([s,i]),r=await a.response,l=await r.text();return console.log("Image Labeling Response:",l),ae(l)}catch(n){throw console.error("Error labeling image:",e,n),n}}function ae(e){try{console.log("[DEBUG] gemini.js - cleanAndParseJSON ì…ë ¥ í…ìŠ¤íŠ¸:",e);let n=e;const t=e.match(/```json\s*([\s\S]*?)\s*```/);t&&t[1]?(n=t[1].trim(),console.log("[DEBUG] gemini.js - ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ì—ì„œ ì¶”ì¶œëœ JSON:",n)):n=e.replace(/```json\n?/,"").replace(/```/,"").trim();try{const e=JSON.parse(n);return console.log("[DEBUG] gemini.js - JSON íŒŒì‹± ê²°ê³¼:",e),e}catch(t){console.error("[DEBUG] gemini.js - JSON íŒŒì‹± ì˜¤ë¥˜:",t),console.log("[DEBUG] gemini.js - íŒŒì‹± ì‹¤íŒ¨ ì›ë³¸ í…ìŠ¤íŠ¸:",e);const o=n.replace(/(\w+):/g,'"$1":').replace(/:\s*([^{}\[\],\s"'0-9true,false,null][^{}\[\],\s]*)/g,': "$1"').replace(/,\s*([}\]])/g,"$1");console.log("[DEBUG] gemini.js - ìˆ˜ì •ëœ JSON í…ìŠ¤íŠ¸:",o);try{const e=JSON.parse(o);return console.log("[DEBUG] gemini.js - ìˆ˜ì •ëœ JSON íŒŒì‹± ì„±ê³µ:",e),e}catch(n){console.error("[DEBUG] gemini.js - ìˆ˜ì •ëœ JSON íŒŒì‹± ì˜¤ë¥˜:",n);try{const n=e.match(/\[\s*{[\s\S]*}\s*\]/);if(n){const e=n[0];return console.log("[DEBUG] gemini.js - ë°°ì—´ í˜•ì‹ ì¶”ì¶œ:",e),JSON.parse(e)}const t=e.match(/{[\s\S]*}/);if(t){const e=t[0];return console.log("[DEBUG] gemini.js - ê°ì²´ í˜•ì‹ ì¶”ì¶œ:",e),JSON.parse(e)}}catch(e){console.error("[DEBUG] gemini.js - ì •ê·œì‹ ì¶”ì¶œ íŒŒì‹± ì˜¤ë¥˜:",e)}return null}}}catch(e){return console.error("[DEBUG] gemini.js - cleanAndParseJSON ì¼ë°˜ ì˜¤ë¥˜:",e),null}}const re=ae;async function le(e){console.log(e);try{const n=await fetch(e),t=await n.blob(),o=await function(e){return new Promise(((n,t)=>{const o=new FileReader;o.onloadend=()=>n(o.result),o.onerror=t,o.readAsDataURL(e)}))}(t);return{inlineData:{data:o.split(",")[1],mimeType:t.type||"image/jpeg"}}}catch(e){throw console.error("Error fetching image:",e),new Error("ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}}async function ce(e){return new Promise((n=>setTimeout(n,e)))}const ue={getLayout:Z,getReviewAnalysis:te,getReviewAnalysisResult:oe,matchPurchaseOption:ie,startNegotiation:z,continueNegotiation:V,translateMessage:W,formatNegotiationMessage:X,translateWithContext:q,processAIRocketRequest:J,generateCoupangAttributes:j,generateDetailHtmlContent:F,extractSizeChartFromImages:ne};export{V as continueNegotiation,ue as default,ne as extractSizeChartFromImages,X as formatNegotiationMessage,j as generateCoupangAttributes,F as generateDetailHtmlContent,Q as generateInitialUserPrompt,Z as getLayout,te as getReviewAnalysis,oe as getReviewAnalysisResult,ie as matchPurchaseOption,J as processAIRocketRequest,z as startNegotiation,W as translateMessage,q as translateWithContext};
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TotalBot - ì˜µì…˜ í¸ì§‘</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f6f7;
      color: #333;
    }

    .header {
      background: white;
      border-bottom: 1px solid #e5e8eb;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #1e90ff;
      color: white;
    }

    .btn-primary:hover {
      background: #1873cc;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .btn-success {
      background: #28a745;
      color: white;
    }

    .btn-success:hover {
      background: #218838;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 24px;
    }

    .editor-wrapper {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .product-name-section {
      padding: 24px;
      border-bottom: 1px solid #e5e8eb;
    }

    .product-name-section h2 {
      font-size: 18px;
      margin-bottom: 12px;
    }

    .product-name-section input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 15px;
    }

    /* ë©”ì¸ íƒ­ */
    .main-tabs {
      display: flex;
      gap: 4px;
      background: #f9fafb;
      padding: 0 24px;
      border-bottom: 2px solid #e5e8eb;
    }

    .main-tab {
      background: transparent;
      border: none;
      padding: 16px 24px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: #666;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }

    .main-tab:hover {
      color: #333;
      background: rgba(0,0,0,0.02);
    }

    .main-tab.active {
      color: #1e90ff;
      font-weight: 600;
      border-bottom-color: #1e90ff;
      background: white;
    }

    .main-tab-content {
      display: none;
    }

    .main-tab-content.active {
      display: block;
    }

    /* ì´ë¯¸ì§€ íƒ­ ë ˆì´ì•„ì›ƒ */
    .images-grid-layout {
      padding: 24px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    .image-section {
      background: white;
    }

    .image-section h3 {
      font-size: 16px;
      margin-bottom: 16px;
      color: #333;
      font-weight: 600;
    }

    .preview-image-large {
      width: 100%;
      max-width: 600px;
      border-radius: 8px;
      border: 2px solid #e5e8eb;
      cursor: pointer;
      transition: all 0.2s;
    }

    .preview-image-large:hover {
      border-color: #1e90ff;
      box-shadow: 0 2px 8px rgba(30,144,255,0.2);
    }

    .images-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
    }

    /* ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ (ê³µí†µ) */
    .image-item-container {
      position: relative;
      cursor: pointer;
      border-radius: 6px;
      overflow: hidden;
    }

    .image-item-container img {
      width: 100%;
      aspect-ratio: 1;
      object-fit: cover;
      border-radius: 6px;
      border: 2px solid #e5e8eb;
      transition: all 0.2s;
      display: block;
      position: relative;
      z-index: 2;
    }

    .image-item-container:hover img {
      border-color: #1e90ff;
      transform: scale(1.02);
    }

    /* í¸ì§‘ ë²„íŠ¼ (hoverì‹œ í‘œì‹œ) */
    .image-edit-btn {
      position: absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, rgba(30, 144, 255, 0.95), rgba(20, 120, 220, 0.95));
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 16px rgba(30, 144, 255, 0.3), 0 2px 4px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(8px);
      cursor: pointer;
      z-index: 10;
      letter-spacing: 0.5px;
    }

    .image-item-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0);
      transition: all 0.3s ease;
      z-index: 1;
      pointer-events: none;
      border-radius: 6px;
    }

    .image-item-container:hover::before {
      background: rgba(0, 0, 0, 0.3);
    }

    .image-item-container:hover .image-edit-btn {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) scale(1.05);
    }

    .image-edit-btn:hover {
      background: linear-gradient(135deg, rgba(20, 120, 220, 1), rgba(15, 100, 200, 1));
      box-shadow: 0 6px 20px rgba(30, 144, 255, 0.5), 0 4px 8px rgba(0, 0, 0, 0.2);
      transform: translateX(-50%) scale(1.1);
    }

    .image-edit-btn:active {
      transform: translateX(-50%) scale(1.02);
    }

    /* ì¶”ê°€ ì´ë¯¸ì§€ ì„ íƒ ê¸°ëŠ¥ */
    .additional-image-item.selected img {
      border: 3px solid #1e90ff !important;
      box-shadow: 0 0 0 3px rgba(30,144,255,0.2);
    }

    .additional-image-item.selected::after {
      content: 'âœ“';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 28px;
      height: 28px;
      background: #1e90ff;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
      z-index: 15;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    /* ì˜µì…˜ ì´ë¯¸ì§€ ê°œìˆ˜ í‘œì‹œ */
    .option-image-count {
      position: absolute;
      bottom: 8px;
      left: 8px;
      background: rgba(0,0,0,0.75);
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      z-index: 15;
      backdrop-filter: blur(4px);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    /* ìƒì„¸í˜ì´ì§€ ì—ë””í„° */
    .detail-page-editor {
      padding: 24px;
    }

    .detail-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid #e5e8eb;
    }

    .detail-toolbar h3 {
      margin: 0;
      font-size: 18px;
      color: #333;
    }

    .toolbar-actions {
      display: flex;
      gap: 12px;
    }

    .detail-content {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 24px;
      min-height: 600px;
    }

    .detail-sources {
      background: #f9fafb;
      border-radius: 8px;
      padding: 16px;
      border: 1px solid #e5e8eb;
      overflow-y: auto;
      max-height: 700px;
    }

    .source-section h4 {
      margin: 0 0 16px 0;
      font-size: 16px;
      color: #333;
    }

    .source-group {
      margin-bottom: 20px;
    }

    .source-group h5 {
      margin: 0 0 12px 0;
      font-size: 13px;
      color: #666;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .source-images {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .source-image-item {
      position: relative;
      cursor: grab;
      border-radius: 6px;
      overflow: hidden;
      border: 2px solid #e5e8eb;
      transition: all 0.2s;
    }

    .source-image-item:active {
      cursor: grabbing;
    }

    .source-image-item:hover {
      border-color: #1e90ff;
      transform: scale(1.05);
    }

    .source-image-item img {
      width: 100%;
      aspect-ratio: 1;
      object-fit: cover;
      display: block;
    }

    /* ë“œë¡­ë‹¤ìš´ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
    .dropdown-box {
      background: white;
      border: 2px solid #e5e8eb;
      border-radius: 10px;
      margin-bottom: 16px;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .dropdown-box:hover {
      border-color: #1e90ff;
      box-shadow: 0 2px 8px rgba(30, 144, 255, 0.1);
    }

    .dropdown-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 18px;
      cursor: pointer;
      background: linear-gradient(to right, #f8f9fa, #ffffff);
      transition: all 0.2s ease;
      user-select: none;
    }

    .dropdown-header:hover {
      background: linear-gradient(to right, #f0f2f5, #f8f9fa);
    }

    .dropdown-header.active {
      background: linear-gradient(to right, rgba(30, 144, 255, 0.05), rgba(30, 144, 255, 0.02));
    }

    .dropdown-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      font-size: 14px;
      color: #1a1a1a;
    }

    .dropdown-icon {
      font-size: 18px;
    }

    .dropdown-arrow {
      font-size: 20px;
      color: #666;
      transition: transform 0.3s ease;
    }

    .dropdown-header.active .dropdown-arrow {
      transform: rotate(180deg);
    }

    .dropdown-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      padding: 0 18px;
    }

    .dropdown-content.active {
      max-height: 600px;
      overflow-y: auto;
      padding: 18px;
      border-top: 1px solid #e5e8eb;
    }

    .dropdown-content::-webkit-scrollbar {
      width: 6px;
    }

    .dropdown-content::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }

    .dropdown-content::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 3px;
    }

    .dropdown-content::-webkit-scrollbar-thumb:hover {
      background: #999;
    }

    /* í…œí”Œë¦¿ ê·¸ë¦¬ë“œ */
    .template-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .template-item {
      cursor: pointer;
      border: 2px solid #e5e8eb;
      border-radius: 8px;
      padding: 8px;
      transition: all 0.2s;
      background: white;
    }

    .template-item:hover {
      border-color: #1e90ff;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(30, 144, 255, 0.15);
    }

    .template-item.active {
      border-color: #1e90ff;
      background: rgba(30, 144, 255, 0.05);
    }

    .template-preview {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px;
      background: #fafbfc;
      border-radius: 4px;
      margin-bottom: 6px;
      min-height: 50px;
    }

    .template-preview-vertical {
      flex-direction: column;
      align-items: stretch;
    }

    .template-preview-card {
      border: 1px solid #e5e8eb;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
    }

    .template-preview-gradient {
      background: linear-gradient(to right, #f8f9fa, #ffffff);
      border-left: 3px solid #1e90ff;
    }

    .template-preview-img {
      width: 30px;
      height: 30px;
      background: #ddd;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 8px;
      color: #888;
      font-weight: 600;
      flex-shrink: 0;
    }

    .template-preview-vertical .template-preview-img {
      width: 100%;
      height: 35px;
    }

    .template-preview-text {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .template-name {
      text-align: center;
      font-size: 11px;
      color: #666;
      font-weight: 600;
    }

    .template-item.active .template-name {
      color: #1e90ff;
    }

    .template-select-inline {
      padding: 6px 10px;
      border: 1px solid #e5e8eb;
      border-radius: 4px;
      font-size: 12px;
      background: white;
      cursor: pointer;
      margin: 6px 0;
      width: 100%;
    }

    .template-select-inline:focus {
      outline: none;
      border-color: #1e90ff;
    }

    .detail-canvas {
      background: white;
      border-radius: 8px;
      border: 2px dashed #e5e8eb;
      padding: 24px;
    }

    .canvas-header h4 {
      margin: 0 0 8px 0;
      font-size: 16px;
      color: #333;
    }

    .canvas-header .hint {
      margin: 0 0 20px 0;
      font-size: 13px;
      color: #888;
    }

    .detail-page-items {
      min-height: 400px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .detail-page-item {
      background: white;
      border: 2px solid #e5e8eb;
      border-radius: 8px;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: move;
      transition: all 0.2s;
    }

    .detail-page-item:hover {
      border-color: #1e90ff;
      box-shadow: 0 2px 8px rgba(30, 144, 255, 0.1);
    }

    .detail-page-item.dragging {
      opacity: 0.5;
    }

    .detail-page-item.drag-over {
      border-color: #1e90ff;
      border-style: solid;
      background: rgba(30, 144, 255, 0.05);
    }

    /* ì˜µì…˜ ë¸”ë¡ ìŠ¤íƒ€ì¼ */
    .detail-page-item.option-block {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px;
      background: white;
      border: 1px solid #e5e8eb;
    }

    .option-block-content {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .option-block-image {
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
      border: 1px solid #e5e8eb;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #666;
      font-weight: 600;
      flex-shrink: 0;
    }

    .option-block-text {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .option-block-title {
      font-size: 15px;
      font-weight: 700;
      color: #1a1a1a;
      padding: 0;
      cursor: text;
      line-height: 1.4;
    }

    .option-block-title:hover {
      color: #1e90ff;
    }

    .option-block-title:focus {
      outline: none;
      color: #1e90ff;
    }

    .option-block-subtitle {
      font-size: 12px;
      color: #666;
      line-height: 1.6;
      cursor: text;
      padding: 0;
    }

    .option-block-subtitle:hover {
      color: #333;
    }

    .option-block-subtitle:focus {
      outline: none;
      color: #1e90ff;
    }

    /* í’ˆì§ˆí‘œì‹œì‚¬í•­ ë¸”ë¡ */
    .detail-page-item.quality-table {
      display: block;
      padding: 20px;
      background: #fafbfc;
    }

    .quality-table-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }

    .quality-table-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
      flex: 1;
      padding: 10px;
      border-radius: 6px;
      cursor: text;
      background: white;
      border: 1px solid #e5e8eb;
    }

    .quality-table-title:hover {
      border-color: #1e90ff;
    }

    .quality-table-title:focus {
      outline: none;
      border-color: #1e90ff;
      box-shadow: 0 0 0 3px rgba(30, 144, 255, 0.1);
    }

    .quality-table-content {
      background: white;
      border: 1px solid #e5e8eb;
      border-radius: 8px;
      overflow: hidden;
    }

    .quality-table-row {
      display: grid;
      grid-template-columns: 150px 1fr;
      border-bottom: 1px solid #e5e8eb;
    }

    .quality-table-row:last-child {
      border-bottom: none;
    }

    .quality-table-label {
      padding: 12px 16px;
      background: #f8f9fa;
      font-weight: 600;
      font-size: 13px;
      color: #555;
      border-right: 1px solid #e5e8eb;
      display: flex;
      align-items: center;
    }

    .quality-table-value {
      padding: 12px 16px;
      font-size: 13px;
      color: #333;
      cursor: text;
    }

    .quality-table-value:hover {
      background: #fafbfc;
    }

    .quality-table-value:focus {
      outline: 2px solid #1e90ff;
      background: white;
    }

    .item-drag-handle {
      color: #999;
      font-size: 24px;
      cursor: move;
      padding: 4px 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .item-drag-handle:hover {
      color: #666;
      background: #f5f5f5;
      border-radius: 4px;
    }

    .item-preview {
      flex-shrink: 0;
    }

    .item-preview-placeholder {
      width: 80px;
      height: 80px;
      background: #f5f5f5;
      border: 2px dashed #ddd;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #666;
      font-weight: 600;
      text-align: center;
      line-height: 1.3;
    }

    .item-info {
      flex: 1;
    }

    .item-type {
      font-size: 11px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .item-label {
      font-size: 14px;
      color: #333;
      font-weight: 500;
    }

    .item-text-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      margin-top: 8px;
    }

    .item-text-display {
      padding: 12px;
      background: #f9fafb;
      border-radius: 6px;
      font-size: 14px;
      color: #333;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .item-actions {
      display: flex;
      gap: 8px;
    }

    .item-action-btn {
      background: transparent;
      border: none;
      color: #666;
      cursor: pointer;
      padding: 8px;
      border-radius: 4px;
      font-size: 16px;
      transition: all 0.2s;
    }

    .item-action-btn:hover {
      background: #f5f5f5;
      color: #1e90ff;
    }

    .item-action-btn.delete:hover {
      color: #ef4444;
    }

    .add-text-btn {
      width: 100%;
      padding: 16px;
      background: #f9fafb;
      border: 2px dashed #ccc;
      border-radius: 8px;
      color: #666;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 12px;
    }

    .add-text-btn:hover {
      border-color: #1e90ff;
      color: #1e90ff;
      background: rgba(30, 144, 255, 0.05);
    }

    .add-text-btn span {
      font-size: 20px;
      font-weight: bold;
      margin-right: 4px;
    }

    /* ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ */
    .modal-large {
      max-width: 900px;
      width: 90%;
    }

    .detail-preview-content {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      padding: 20px;
    }

    .detail-preview-content img {
      width: 100%;
      display: block;
      margin-bottom: 0;
      border-radius: 8px;
    }

    .detail-preview-text {
      padding: 20px;
      font-size: 14px;
      line-height: 1.6;
      color: #333;
      background: white;
    }

    /* ì˜µì…˜ í…Œì´ë¸” ì»¨í…Œì´ë„ˆ */
    .options-table-container {
      padding: 24px;
      background: white;
      overflow-x: auto;
    }

    /* ìƒì„¸í˜ì´ì§€ íƒ­ */
    .detail-page-editor {
      padding: 24px;
      background: white;
    }

    .detail-toolbar {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e5e8eb;
    }

    .detail-preview {
      min-height: 400px;
      border: 1px solid #e5e8eb;
      border-radius: 8px;
      background: #f9fafb;
    }

    .toolbar {
      padding: 16px 24px;
      border-bottom: 1px solid #e5e8eb;
      background: #f9fafb;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .toolbar h3 {
      font-size: 16px;
      font-weight: 600;
      margin-right: auto;
    }

    .bulk-edit-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .bulk-edit-group input {
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
      width: 150px;
    }

    .options-table {
      width: 100%;
      border-collapse: collapse;
    }

    .options-table th {
      background: #f9fafb;
      padding: 12px;
      text-align: left;
      font-size: 13px;
      font-weight: 600;
      border-bottom: 2px solid #e5e8eb;
      position: sticky;
      top: 0;
    }

    .options-table td {
      padding: 12px;
      border-bottom: 1px solid #f0f0f0;
    }

    .options-table tbody tr:hover {
      background: #f9fafb;
    }

    .options-table input {
      padding: 6px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
      width: 100%;
    }

    .options-table input:focus {
      outline: none;
      border-color: #1e90ff;
      box-shadow: 0 0 0 3px rgba(30,144,255,0.1);
    }

    .price-display {
      font-size: 13px;
      font-weight: 500;
      color: #333;
    }

    .profit-positive {
      color: #10b981;
      font-weight: 600;
    }

    .profit-warning {
      color: #ef4444;
      font-weight: 600;
    }

    .option-image-preview {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 4px;
      border: 1px solid #e5e8eb;
      cursor: pointer;
    }

    .option-image-preview:hover {
      border-color: #1e90ff;
    }

    .no-image {
      width: 50px;
      height: 50px;
      background: #f0f0f0;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #ccc;
    }

    /* ë§¤ì§ ë¸ŒëŸ¬ì‰¬ ëª¨ë‹¬ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 1200px;
      max-height: 90vh;
      overflow: auto;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e5e8eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      font-size: 20px;
      font-weight: 600;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border: none;
      background: #f0f0f0;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      line-height: 1;
    }

    .modal-close:hover {
      background: #e0e0e0;
    }

    .modal-body {
      padding: 24px;
    }

    .image-editor-container {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 24px;
    }

    .canvas-container {
      border: 1px solid #e5e8eb;
      border-radius: 8px;
      overflow: auto;
      background: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 500px;
      max-height: 70vh;
    }

    .canvas-container canvas {
      display: block;
      cursor: crosshair;
    }

    .canvas-container canvas.eraser-mode {
      cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><circle cx="12" cy="12" r="10" fill="none" stroke="red" stroke-width="2"/></svg>') 12 12, crosshair;
    }

    .editor-tools {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .tool-group {
      background: #f9fafb;
      padding: 16px;
      border-radius: 8px;
    }

    .tool-group h3 {
      font-size: 14px;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .tool-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .tool-btn {
      padding: 10px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }

    .tool-btn:hover {
      background: #f0f0f0;
      border-color: #1e90ff;
    }

    .tool-btn.active {
      background: #1e90ff;
      color: white;
      border-color: #1e90ff;
    }

    .slider-group {
      margin-top: 12px;
    }

    .slider-group label {
      display: block;
      font-size: 13px;
      margin-bottom: 8px;
    }

    .slider-group input[type="range"] {
      width: 100%;
    }

    .alert {
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 14px;
    }

    .alert-success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .alert-error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    /* ì¼ê´„ í¸ì§‘ íƒ­ ìŠ¤íƒ€ì¼ */
    .edit-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 5px;
    }

    .edit-tab {
      background: transparent;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #666;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }

    .edit-tab:hover {
      color: #333;
      background: #f5f5f5;
    }

    .edit-tab.active {
      color: #000;
      font-weight: 700;
      border-bottom-color: #000;
    }

    .edit-tab-content {
      display: none;
      animation: fadeIn 0.3s;
    }

    .edit-tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .option-select {
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
      margin-right: 10px;
      background: white;
      cursor: pointer;
    }

    .hint {
      font-size: 12px;
      color: #888;
      margin: 10px 0 0 0;
      font-style: italic;
    }

    /* ë§¤í•‘ ë‹¤ì´ì–¼ë¡œê·¸ */
    .mapping-dialog {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    .mapping-dialog.active {
      display: flex;
    }

    .mapping-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .mapping-content h2 {
      margin: 0 0 20px 0;
      font-size: 20px;
      color: #333;
    }

    .mapping-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 8px;
    }

    .mapping-row input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }

    .mapping-row input:first-child {
      background: #f0f0f0;
      color: #666;
    }

    .mapping-row input:last-child {
      border: 2px solid #000;
    }

    .mapping-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    /* ì„¤ì • ëª¨ë‹¬ */
    .settings-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    .settings-modal.active {
      display: flex;
    }

    .settings-content {
      background: white;
      border-radius: 12px;
      padding: 0;
      width: 90%;
      max-width: 800px;
      max-height: 85vh;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
    }

    .settings-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e5e8eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .settings-header h2 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
    }

    .settings-body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .settings-section {
      margin-bottom: 32px;
    }

    .settings-section h3 {
      font-size: 16px;
      margin-bottom: 16px;
      color: #333;
      font-weight: 600;
      border-bottom: 2px solid #e5e8eb;
      padding-bottom: 8px;
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }

    .settings-field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .settings-field label {
      font-size: 13px;
      color: #666;
      font-weight: 500;
    }

    .settings-field input {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }

    .settings-main-tabs {
      display: flex;
      gap: 0;
      margin-bottom: 24px;
      border-bottom: 2px solid #e0e0e0;
    }

    .settings-main-tab {
      background: transparent;
      border: none;
      padding: 14px 28px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: #666;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }

    .settings-main-tab:hover {
      color: #333;
      background: #f5f5f5;
    }

    .settings-main-tab.active {
      color: #1e90ff;
      font-weight: 700;
      border-bottom-color: #1e90ff;
    }

    .settings-main-tab-content {
      display: none;
    }

    .settings-main-tab-content.active {
      display: block;
    }

    .settings-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      border-bottom: 2px solid #e0e0e0;
    }

    .settings-tab {
      background: transparent;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #666;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }

    .settings-tab:hover {
      color: #333;
      background: #f5f5f5;
    }

    .settings-tab.active {
      color: #1e90ff;
      font-weight: 600;
      border-bottom-color: #1e90ff;
    }

    .settings-tab-content {
      display: none;
    }

    .settings-tab-content.active {
      display: block;
    }

    .margin-rows-container {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #e5e8eb;
      border-radius: 6px;
      padding: 12px;
      background: #f9fafb;
    }

    .margin-row {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid #e5e8eb;
    }

    .margin-row input {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
    }

    .margin-row button {
      padding: 6px 12px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    .margin-row button:hover {
      background: #dc2626;
    }

    .margin-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .settings-footer {
      padding: 16px 24px;
      border-top: 1px solid #e5e8eb;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    .price-cell {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .price-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 600;
      text-align: right;
    }

    .price-input:focus {
      outline: none;
      border-color: #1e90ff;
      box-shadow: 0 0 0 3px rgba(30,144,255,0.1);
    }

    .price-main {
      font-size: 14px;
      font-weight: 600;
      color: #333;
    }

    .price-sub {
      font-size: 11px;
      color: #888;
      text-align: center;
    }

    .price-sub.profit-positive {
      color: #10b981;
      font-weight: 500;
    }

    .price-sub.profit-warning {
      color: #ef4444;
      font-weight: 500;
    }

    .margin-cell {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .margin-amount {
      font-size: 13px;
      font-weight: 600;
    }

    .margin-percent {
      font-size: 11px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ì˜µì…˜ í¸ì§‘</h1>
    <div class="header-actions">
      <button class="btn btn-secondary" onclick="window.location.href='/products.html'">ëª©ë¡ìœ¼ë¡œ</button>
      <button class="btn btn-success" onclick="saveProduct()">ì €ì¥</button>
    </div>
  </div>

  <div class="container">
    <div id="alertContainer"></div>

    <div class="editor-wrapper">
      <!-- ìƒí’ˆëª… ì„¹ì…˜ -->
      <div class="product-name-section">
        <h2>ìƒí’ˆëª…</h2>
        <input type="text" id="productTitle" placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
      </div>

      <!-- íƒ­ ë©”ë‰´ -->
      <div class="main-tabs">
        <button class="main-tab" onclick="switchMainTab('images')">ì´ë¯¸ì§€</button>
        <button class="main-tab active" onclick="switchMainTab('options')">ì˜µì…˜</button>
        <button class="main-tab" onclick="switchMainTab('detail')">ìƒì„¸í˜ì´ì§€</button>
      </div>

      <!-- ì´ë¯¸ì§€ íƒ­ -->
      <div id="images-tab" class="main-tab-content">
        <div class="images-grid-layout">
          <!-- ì¶”ê°€ ì´ë¯¸ì§€ë“¤ (ì¢Œì¸¡) -->
          <div class="image-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h3 style="margin: 0;">ì¶”ê°€ ì´ë¯¸ì§€</h3>
              <button class="btn btn-primary" onclick="openAIImageEditor('additional')" style="font-size: 13px; padding: 6px 12px;">
                ğŸ¨ AI í¸ì§‘
              </button>
            </div>
            <div class="images-grid" id="additionalImagesGridTab">
              <!-- ì¶”ê°€ ì´ë¯¸ì§€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
            </div>
          </div>

          <!-- ì˜µì…˜ ì´ë¯¸ì§€ ìœ ë‹ˆí¬ ê°’ (ìš°ì¸¡) -->
          <div class="image-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h3 style="margin: 0;">ì˜µì…˜ ì´ë¯¸ì§€</h3>
              <button class="btn btn-primary" onclick="openAIImageEditor('option')" style="font-size: 13px; padding: 6px 12px;">
                ğŸ¨ AI í¸ì§‘
              </button>
            </div>
            <div class="images-grid" id="optionImagesGridTab">
              <!-- ì˜µì…˜ ì´ë¯¸ì§€ ìœ ë‹ˆí¬ ê°’ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
            </div>
          </div>
        </div>
      </div>

      <!-- ì˜µì…˜ íƒ­ -->
      <div id="options-tab" class="main-tab-content active">
        <!-- ì¼ê´„ í¸ì§‘ íˆ´ë°” -->
      <div class="toolbar">
        <h3>ì˜µì…˜ ì¼ê´„ í¸ì§‘</h3>

        <!-- íƒ­ ì„ íƒ -->
        <div class="edit-tabs">
          <button class="edit-tab active" onclick="switchEditTab('find-replace')">ì°¾ê¸°/ë°”ê¾¸ê¸°</button>
          <button class="edit-tab" onclick="switchEditTab('mapping')">ì´ë¦„ ë§¤í•‘</button>
          <button class="edit-tab" onclick="switchEditTab('numbering')">ìˆœë²ˆ ë¶€ì—¬</button>
        </div>

        <!-- ì°¾ê¸°/ë°”ê¾¸ê¸° íƒ­ -->
        <div id="find-replace-tab" class="edit-tab-content active">
          <div class="bulk-edit-group">
            <select id="replaceTargetOption" class="option-select">
              <option value="optionName1">ì˜µì…˜1</option>
              <option value="optionName2">ì˜µì…˜2</option>
            </select>
            <input type="text" id="findText" placeholder="ì°¾ì„ í…ìŠ¤íŠ¸ (ë¹ˆ ì¹¸ìœ¼ë¡œ ë¹ˆ ê°’ ì°¾ê¸°)">
            <span>â†’</span>
            <input type="text" id="replaceText" placeholder="ë°”ê¿€ í…ìŠ¤íŠ¸">
            <button class="btn btn-primary btn-sm" onclick="bulkReplace()">ì¹˜í™˜</button>
          </div>
        </div>

        <!-- ì´ë¦„ ë§¤í•‘ íƒ­ -->
        <div id="mapping-tab" class="edit-tab-content">
          <div class="bulk-edit-group">
            <select id="mappingTargetOption" class="option-select">
              <option value="optionName1">ì˜µì…˜1</option>
              <option value="optionName2">ì˜µì…˜2</option>
            </select>
            <button class="btn btn-primary btn-sm" onclick="openMappingDialog()">ìœ ë‹ˆí¬ ê°’ í¸ì§‘</button>
          </div>
          <p class="hint">ë™ì¼í•œ ì˜µì…˜ ê°’ë“¤ì„ í•œ ë²ˆì— ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <!-- ìˆœë²ˆ ë¶€ì—¬ íƒ­ -->
        <div id="numbering-tab" class="edit-tab-content">
          <div class="bulk-edit-group">
            <select id="numberingTargetOption" class="option-select">
              <option value="optionName1">ì˜µì…˜1</option>
              <option value="optionName2">ì˜µì…˜2</option>
            </select>
            <input type="text" id="numberingPrefix" placeholder="ì ‘ë‘ì‚¬ (ì„ íƒ)" style="width: 150px;">
            <select id="numberingType" class="option-select" style="width: 120px;">
              <option value="number">ìˆ«ì (1, 2, 3...)</option>
              <option value="letter">ì•ŒíŒŒë²³ (A, B, C...)</option>
            </select>
            <button class="btn btn-primary btn-sm" onclick="applyNumbering()">ìˆœë²ˆ ë¶€ì—¬</button>
          </div>
          <p class="hint">ìœ ë‹ˆí¬í•œ ì˜µì…˜ ê°’ì— ìˆœì°¨ì ìœ¼ë¡œ ë²ˆí˜¸ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.</p>
        </div>
      </div>

      <!-- ì˜µì…˜ í…Œì´ë¸” -->
      <div class="options-table-container">
        <table class="options-table">
          <thead>
            <tr>
              <th style="width: 60px;">#</th>
              <th style="width: 80px;">ì´ë¯¸ì§€</th>
              <th>ì˜µì…˜1</th>
              <th>ì˜µì…˜2</th>
              <th style="width: 120px;">ì›ê°€</th>
              <th style="width: 120px;">ê³µê¸‰ê°€</th>
              <th style="width: 120px;">íŒë§¤ê°€</th>
            </tr>
          </thead>
          <tbody id="optionsTableBody">
            <!-- ì˜µì…˜ í–‰ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
          </tbody>
        </table>
      </div>
      </div>

      <!-- ìƒì„¸í˜ì´ì§€ íƒ­ -->
      <div id="detail-tab" class="main-tab-content">
        <div class="detail-page-editor">
          <div class="detail-toolbar">
            <h3>ìƒì„¸í˜ì´ì§€ êµ¬ì„±</h3>
            <div class="toolbar-actions">
              <button class="btn btn-secondary" onclick="resetDetailPage()">ì´ˆê¸°í™”</button>
              <button class="btn btn-primary" onclick="previewDetailPage()">ë¯¸ë¦¬ë³´ê¸°</button>
            </div>
          </div>

          <div class="detail-content">
            <!-- ì¢Œì¸¡: ë“œë¡­ë‹¤ìš´ ë©”ë‰´ -->
            <div class="detail-sources">
              <div class="source-section">

                <!-- ì´ë¯¸ì§€ ì¶”ê°€í•˜ê¸° ë“œë¡­ë‹¤ìš´ -->
                <div class="dropdown-box">
                  <div class="dropdown-header" onclick="toggleDropdown('imagesDropdown')">
                    <div class="dropdown-title">
                      <span class="dropdown-icon">ğŸ–¼ï¸</span>
                      <span>ì´ë¯¸ì§€ ì¶”ê°€í•˜ê¸°</span>
                    </div>
                    <span class="dropdown-arrow">â–¼</span>
                  </div>
                  <div id="imagesDropdown" class="dropdown-content">
                    <div class="source-group" style="margin-bottom: 20px;">
                      <h5 style="font-size: 13px; color: #666; margin-bottom: 10px;">ëŒ€í‘œ ì´ë¯¸ì§€</h5>
                      <div id="detailMainImageSource" class="source-images"></div>
                    </div>

                    <div class="source-group" style="margin-bottom: 20px;">
                      <h5 style="font-size: 13px; color: #666; margin-bottom: 10px;">ì¶”ê°€ ì´ë¯¸ì§€ (ì—°ì¶œ)</h5>
                      <div id="detailAdditionalImagesSource" class="source-images"></div>
                    </div>

                    <div class="source-group">
                      <h5 style="font-size: 13px; color: #666; margin-bottom: 10px;">ì˜µì…˜ ì´ë¯¸ì§€</h5>
                      <div id="detailOptionImagesSource" class="source-images"></div>
                    </div>
                  </div>
                </div>

                <!-- í…ìŠ¤íŠ¸ ì¶”ê°€í•˜ê¸° ë“œë¡­ë‹¤ìš´ -->
                <div class="dropdown-box">
                  <div class="dropdown-header" onclick="toggleDropdown('textDropdown')">
                    <div class="dropdown-title">
                      <span class="dropdown-icon">ğŸ“</span>
                      <span>í…ìŠ¤íŠ¸ ì¶”ê°€í•˜ê¸°</span>
                    </div>
                    <span class="dropdown-arrow">â–¼</span>
                  </div>
                  <div id="textDropdown" class="dropdown-content">
                    <p style="font-size: 12px; color: #666; margin-bottom: 12px; line-height: 1.5;">í…ìŠ¤íŠ¸ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì¶”ê°€í•˜ì„¸ìš”</p>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                      <div class="text-add-btn" draggable="true" data-text-type="title" style="padding: 12px; border: 2px solid #1e90ff; background: rgba(30, 144, 255, 0.05); border-radius: 8px; cursor: grab; font-weight: 600; color: #1e90ff; font-size: 16px; user-select: none;">
                        ğŸ“Œ íƒ€ì´í‹€
                      </div>
                      <div class="text-add-btn" draggable="true" data-text-type="subtitle" style="padding: 10px; border: 2px solid #667eea; background: rgba(102, 126, 234, 0.05); border-radius: 8px; cursor: grab; font-weight: 600; color: #667eea; font-size: 14px; user-select: none;">
                        ğŸ“ ì¤‘ê°„ íƒ€ì´í‹€
                      </div>
                      <div class="text-add-btn" draggable="true" data-text-type="paragraph" style="padding: 10px; border: 2px solid #666; background: rgba(0, 0, 0, 0.02); border-radius: 8px; cursor: grab; font-weight: 500; color: #666; font-size: 13px; user-select: none;">
                        ğŸ“„ ì¼ë°˜ í…ìŠ¤íŠ¸
                      </div>
                    </div>
                  </div>
                </div>

                <!-- í…œí”Œë¦¿ ë³€ê²½ ë“œë¡­ë‹¤ìš´ -->
                <div class="dropdown-box">
                  <div class="dropdown-header" onclick="toggleDropdown('templateDropdown')">
                    <div class="dropdown-title">
                      <span class="dropdown-icon">ğŸ“</span>
                      <span>í…œí”Œë¦¿ ë³€ê²½</span>
                    </div>
                    <span class="dropdown-arrow">â–¼</span>
                  </div>
                  <div id="templateDropdown" class="dropdown-content">
                    <p style="font-size: 12px; color: #666; margin-bottom: 12px; line-height: 1.5;">í…œí”Œë¦¿ì„ ì„ íƒí•˜ë©´ ëª¨ë“  ì˜µì…˜ ë¸”ë¡ì— ì ìš©ë©ë‹ˆë‹¤</p>

                    <div class="template-grid" style="grid-template-columns: repeat(2, 1fr); gap: 8px;">
                    <div class="template-item" data-template="horizontal" onclick="selectOptionTemplate('horizontal')">
                      <div class="template-preview">
                        <div class="template-preview-img" style="background: #ddd;">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: #333; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: #999; width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ê°€ë¡œí˜•</div>
                    </div>

                    <div class="template-item" data-template="horizontal-reverse" onclick="selectOptionTemplate('horizontal-reverse')">
                      <div class="template-preview" style="flex-direction: row-reverse;">
                        <div class="template-preview-img" style="background: #ddd;">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: #333; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: #999; width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ê°€ë¡œ ë°˜ì „</div>
                    </div>

                    <div class="template-item" data-template="vertical" onclick="selectOptionTemplate('vertical')">
                      <div class="template-preview template-preview-vertical">
                        <div class="template-preview-img" style="background: #ddd;">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 5px; background: #333; width: 60%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: #999; width: 45%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ì„¸ë¡œí˜•</div>
                    </div>

                    <div class="template-item" data-template="card" onclick="selectOptionTemplate('card')">
                      <div class="template-preview template-preview-card">
                        <div class="template-preview-img" style="background: #ddd;">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 5px; background: #333; width: 65%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: #999; width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ì¹´ë“œí˜•</div>
                    </div>

                    <div class="template-item" data-template="centered" onclick="selectOptionTemplate('centered')">
                      <div class="template-preview template-preview-vertical" style="align-items: center;">
                        <div class="template-preview-img" style="background: #ddd;">IMG</div>
                        <div class="template-preview-text" style="text-align: center; align-items: center;">
                          <div style="height: 5px; background: #333; width: 60%; margin: 0 auto 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: #999; width: 45%; margin: 0 auto; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ì¤‘ì•™ ì •ë ¬</div>
                    </div>

                    <div class="template-item" data-template="split" onclick="selectOptionTemplate('split')">
                      <div class="template-preview" style="gap: 0;">
                        <div class="template-preview-img" style="background: #ddd; border-radius: 3px 0 0 3px;">IMG</div>
                        <div class="template-preview-text" style="background: #f5f5f5; padding: 4px; border-radius: 0 3px 3px 0;">
                          <div style="height: 5px; background: #333; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: #999; width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">50/50 ë¶„í• </div>
                    </div>

                    <div class="template-item" data-template="modern" onclick="selectOptionTemplate('modern')">
                      <div class="template-preview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 6px; border-radius: 4px;">
                        <div class="template-preview-img" style="background: rgba(255,255,255,0.9);">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: white; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: rgba(255,255,255,0.8); width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ëª¨ë˜í˜•</div>
                    </div>

                    <div class="template-item active" data-template="gradient" onclick="selectOptionTemplate('gradient')">
                      <div class="template-preview template-preview-gradient">
                        <div class="template-preview-img" style="background: #ddd;">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: #333; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: #999; width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ê·¸ë¼ë°ì´ì…˜</div>
                    </div>

                    <!-- ì»¬ëŸ¬í’€ í…œí”Œë¦¿ -->
                    <div class="template-item" data-template="neon" onclick="selectOptionTemplate('neon')">
                      <div class="template-preview" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 6px; border-radius: 4px;">
                        <div class="template-preview-img" style="background: rgba(255,255,255,0.9);">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: white; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: rgba(255,255,255,0.8); width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ğŸ’— ë„¤ì˜¨</div>
                    </div>

                    <div class="template-item" data-template="sunset" onclick="selectOptionTemplate('sunset')">
                      <div class="template-preview" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); padding: 6px; border-radius: 4px;">
                        <div class="template-preview-img" style="background: rgba(255,255,255,0.9);">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: white; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: rgba(255,255,255,0.8); width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ğŸŒ… ì¼ëª°</div>
                    </div>

                    <div class="template-item" data-template="ocean" onclick="selectOptionTemplate('ocean')">
                      <div class="template-preview" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 6px; border-radius: 4px;">
                        <div class="template-preview-img" style="background: rgba(255,255,255,0.9);">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: white; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: rgba(255,255,255,0.8); width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ğŸŒŠ ë°”ë‹¤</div>
                    </div>

                    <div class="template-item" data-template="mint" onclick="selectOptionTemplate('mint')">
                      <div class="template-preview" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); padding: 6px; border-radius: 4px;">
                        <div class="template-preview-img" style="background: rgba(255,255,255,0.9);">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: white; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: rgba(255,255,255,0.8); width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ğŸŒ¿ ë¯¼íŠ¸</div>
                    </div>

                    <div class="template-item" data-template="dark" onclick="selectOptionTemplate('dark')">
                      <div class="template-preview" style="background: #1a1a1a; padding: 6px; border-radius: 4px; border: 1px solid #333;">
                        <div class="template-preview-img" style="background: #2a2a2a;">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: white; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: rgba(255,255,255,0.7); width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ğŸŒ™ ë‹¤í¬</div>
                    </div>

                    <!-- ë…íŠ¹í•œ ìŠ¤íƒ€ì¼ -->
                    <div class="template-item" data-template="neon-border" onclick="selectOptionTemplate('neon-border')">
                      <div class="template-preview" style="border: 2px solid #f093fb; padding: 6px; border-radius: 4px; box-shadow: 0 0 10px rgba(240, 147, 251, 0.3);">
                        <div class="template-preview-img" style="background: #ddd;">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: #333; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: #999; width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">âœ¨ ë„¤ì˜¨ í…Œë‘ë¦¬</div>
                    </div>

                    <div class="template-item" data-template="badge" onclick="selectOptionTemplate('badge')">
                      <div class="template-preview" style="border: 2px dashed #1e90ff; padding: 6px; border-radius: 12px;">
                        <div class="template-preview-img" style="background: #ddd;">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: #333; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: #999; width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ğŸ·ï¸ ë°°ì§€</div>
                    </div>

                    <div class="template-item" data-template="diagonal" onclick="selectOptionTemplate('diagonal')">
                      <div class="template-preview" style="background: linear-gradient(45deg, #f8f9fa 50%, white 50%); padding: 6px; border-radius: 4px; border: 1px solid #e5e8eb;">
                        <div class="template-preview-img" style="background: #ddd;">IMG</div>
                        <div class="template-preview-text">
                          <div style="height: 6px; background: #333; width: 70%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: #999; width: 50%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ğŸ“ ëŒ€ê°ì„ </div>
                    </div>

                    <div class="template-item" data-template="overlay" onclick="selectOptionTemplate('overlay')">
                      <div class="template-preview template-preview-vertical" style="position: relative; background: #ddd; padding: 0;">
                        <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 8px; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);">
                          <div style="height: 5px; background: white; width: 60%; margin-bottom: 3px; border-radius: 2px;"></div>
                          <div style="height: 4px; background: rgba(255,255,255,0.8); width: 45%; border-radius: 2px;"></div>
                        </div>
                      </div>
                      <div class="template-name">ğŸ–¼ï¸ ì˜¤ë²„ë ˆì´</div>
                    </div>

                  </div>
                  </div>
                </div>

              </div>
            </div>

            <!-- ìš°ì¸¡: ìƒì„¸í˜ì´ì§€ êµ¬ì„± -->
            <div class="detail-canvas">
              <div class="canvas-header">
                <h4>ìƒì„¸í˜ì´ì§€ êµ¬ì„± ìˆœì„œ</h4>
                <p class="hint">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œë¥¼ ë³€ê²½í•˜ê±°ë‚˜, ì¢Œì¸¡ì—ì„œ ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•˜ì„¸ìš”</p>
              </div>

              <div id="detailPageCanvas" class="detail-page-items">
                <!-- ìƒì„¸í˜ì´ì§€ ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë¨ -->
              </div>

              <button class="add-text-btn" onclick="addTextBlock()">
                <span>+</span> í…ìŠ¤íŠ¸ ë¸”ë¡ ì¶”ê°€
              </button>
              <button class="add-text-btn" onclick="addQualityTable()" style="margin-top: 8px;">
                <span>+</span> í’ˆì§ˆí‘œì‹œì‚¬í•­ ì¶”ê°€
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ìƒì„¸í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
  <div class="modal" id="detailPreviewModal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>ìƒì„¸í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸°</h2>
        <button class="modal-close" onclick="closeDetailPreview()">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="detailPreviewContent" class="detail-preview-content">
          <!-- ë¯¸ë¦¬ë³´ê¸° ë‚´ìš©ì´ ì—¬ê¸°ì— ë Œë”ë§ë¨ -->
        </div>
      </div>
    </div>
  </div>

  <!-- ë§¤ì§ ë¸ŒëŸ¬ì‰¬ ëª¨ë‹¬ -->
  <div class="modal" id="magicBrushModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ¨ ë§¤ì§ ë¸ŒëŸ¬ì‰¬ - ì´ë¯¸ì§€ í¸ì§‘</h2>
        <button class="modal-close" onclick="closeMagicBrush()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="image-editor-container">
          <div class="canvas-container">
            <canvas id="imageCanvas"></canvas>
          </div>
          <div class="editor-tools">
            <div class="tool-group">
              <h3>ë§¤ì§ ì´ë ˆì´ì € (AI)</h3>
              <div class="tool-buttons">
                <button class="tool-btn" id="magicEraserBtn" onclick="toggleMagicEraser()">ë§¤ì§ ì´ë ˆì´ì €</button>
                <button class="tool-btn" onclick="applyMagicEraser()">ì˜ì—­ ì œê±° ë° ì±„ìš°ê¸°</button>
              </div>
              <div class="slider-group">
                <label>ë¸ŒëŸ¬ì‹œ í¬ê¸°: <span id="brushSizeValue">20</span>px</label>
                <input type="range" id="brushSizeSlider" min="5" max="100" value="20" oninput="updateBrushSize()">
              </div>
              <p style="font-size: 12px; color: #888; margin-top: 8px;">
                âœ¨ ë“œë˜ê·¸ë¡œ ì œê±°í•  ì˜ì—­ì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ì¹ í•œ í›„ "ì˜ì—­ ì œê±° ë° ì±„ìš°ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
              </p>
            </div>

            <div class="tool-group">
              <h3>ì¼ë°˜ ì§€ìš°ê°œ</h3>
              <div class="tool-buttons">
                <button class="tool-btn" id="eraserBtn" onclick="toggleEraser()">íˆ¬ëª…í•˜ê²Œ ì§€ìš°ê¸°</button>
                <button class="tool-btn" onclick="clearCanvas()">ì „ì²´ ì§€ìš°ê¸°</button>
              </div>
            </div>

            <div class="tool-group">
              <h3>ë°°ê²½ ì œê±°</h3>
              <button class="tool-btn" onclick="removeBackground()">ë°°ê²½ ìë™ ì œê±°</button>
            </div>

            <div class="tool-group">
              <h3>í¬ê¸° ì¡°ì •</h3>
              <div class="tool-buttons">
                <button class="tool-btn" onclick="resizeImage(800, 800)">800x800</button>
                <button class="tool-btn" onclick="resizeImage(1000, 1000)">1000x1000</button>
                <button class="tool-btn" onclick="resizeImage(1200, 1200)">1200x1200</button>
                <button class="tool-btn" onclick="resizeImage(1500, 1500)">1500x1500</button>
              </div>
            </div>

            <div class="tool-group">
              <h3>ë°ê¸°/ëŒ€ë¹„</h3>
              <div class="slider-group">
                <label>ë°ê¸°: <span id="brightnessValue">0</span></label>
                <input type="range" id="brightnessSlider" min="-100" max="100" value="0" oninput="adjustBrightness()">
              </div>
              <div class="slider-group">
                <label>ëŒ€ë¹„: <span id="contrastValue">0</span></label>
                <input type="range" id="contrastSlider" min="-100" max="100" value="0" oninput="adjustContrast()">
              </div>
            </div>

            <div class="tool-group">
              <h3>í•„í„°</h3>
              <div class="tool-buttons">
                <button class="tool-btn" onclick="applyFilter('grayscale')">í‘ë°±</button>
                <button class="tool-btn" onclick="applyFilter('sepia')">ì„¸í”¼ì•„</button>
                <button class="tool-btn" onclick="applyFilter('blur')">ë¸”ëŸ¬</button>
                <button class="tool-btn" onclick="applyFilter('sharpen')">ì„ ëª…í•˜ê²Œ</button>
              </div>
            </div>

            <div class="tool-group">
              <button class="btn btn-primary" style="width: 100%;" onclick="saveEditedImage()">ì €ì¥</button>
              <button class="btn btn-secondary" style="width: 100%; margin-top: 8px;" onclick="resetImage()">ì´ˆê¸°í™”</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì´ë¦„ ë§¤í•‘ ë‹¤ì´ì–¼ë¡œê·¸ -->
  <div class="mapping-dialog" id="mappingDialog">
    <div class="mapping-content">
      <h2 id="mappingDialogTitle">ì˜µì…˜ ì´ë¦„ ë§¤í•‘</h2>
      <p class="hint">ìœ ë‹ˆí¬í•œ ì˜µì…˜ ê°’ë“¤ì„ í•œ ë²ˆì— ë³€ê²½í•©ë‹ˆë‹¤. ë™ì¼í•œ ê°’ì„ ê°€ì§„ ëª¨ë“  í•­ëª©ì´ í•¨ê»˜ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</p>
      <div id="mappingRows"></div>
      <div class="mapping-buttons">
        <button class="btn btn-secondary" onclick="closeMappingDialog()">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="applyMapping()">ì ìš©</button>
      </div>
    </div>
  </div>

  <!-- ì„¤ì • ëª¨ë‹¬ -->
  <div class="settings-modal" id="settingsModal">
    <div class="settings-content">
      <div class="settings-header">
        <h2>âš™ï¸ TotalBot ì„¤ì •</h2>
        <button class="modal-close" onclick="closeSettingsModal()">Ã—</button>
      </div>

      <!-- ì„¤ì • ë©”ì¸ íƒ­ -->
      <div class="settings-main-tabs">
        <button class="settings-main-tab active" onclick="switchMainSettingsTab('info')">ì •ë³´ ì„¤ì •</button>
        <button class="settings-main-tab" onclick="switchMainSettingsTab('price')">ê°€ê²© ì„¤ì •</button>
        <button class="settings-main-tab" onclick="switchMainSettingsTab('template')">í…œí”Œë¦¿ ì„¤ì •</button>
      </div>

      <div class="settings-body">
        <!-- ì •ë³´ ì„¤ì • íƒ­ -->
        <div id="info-main-settings-tab" class="settings-main-tab-content active">
          <div class="settings-section">
            <h3>ê³„ì • ì •ë³´</h3>
            <div class="settings-grid">
              <div class="settings-field">
                <label>ì¿ íŒ¡ ì•„ì´ë””</label>
                <input type="text" id="coupangId" placeholder="ì¿ íŒ¡ ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              <div class="settings-field">
                <label>ì¿ íŒ¡ ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="coupangPassword" placeholder="ì¿ íŒ¡ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              </div>
            </div>
          </div>

          <div class="settings-section">
            <h3>ì£¼ì†Œ ì •ë³´</h3>
            <div class="settings-grid">
              <div class="settings-field" style="grid-column: 1 / -1;">
                <label>ì£¼ì†Œ</label>
                <input type="text" id="address" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              </div>
            </div>
          </div>
        </div>

        <!-- ê°€ê²© ì„¤ì • íƒ­ -->
        <div id="price-main-settings-tab" class="settings-main-tab-content">
          <!-- ê¸°ë³¸ ì„¤ì • -->
          <div class="settings-section">
            <h3>ê¸°ë³¸ ì„¤ì •</h3>
            <div class="settings-grid">
              <div class="settings-field">
                <label>í™˜ìœ¨ (CNY â†’ KRW)</label>
                <input type="number" id="settingsExchangeRate" value="190" step="1">
              </div>
              <div class="settings-field">
                <label>ê°œë‹¹í¬ì¥ ë¹„ìš© (ì›)</label>
                <input type="number" id="settingsPackagingCost" value="500" step="100">
              </div>
              <div class="settings-field">
                <label>ì‰½ë¨¼íŠ¸ ë¹„ìš© (ì›)</label>
                <input type="number" id="settingsShipmentCost" value="0" step="100">
              </div>
              <div class="settings-field">
                <label>ì¿ íŒ¡ ìµœì†Œ ë§ˆì§„ê¸ˆ (ì›)</label>
                <input type="number" id="settingsMinMargin" value="3000" step="100">
              </div>
            </div>
          </div>

          <!-- ë§ˆì§„ ì„¤ì • -->
          <div class="settings-section">
            <h3>ë§ˆì§„ ì„¤ì •</h3>

            <div class="settings-tabs">
              <button class="settings-tab active" onclick="switchSettingsTab('supply')">ê³µê¸‰ê°€ ë§ˆì§„</button>
              <button class="settings-tab" onclick="switchSettingsTab('sale')">íŒë§¤ê°€ ë§ˆì§„</button>
            </div>

            <!-- ê³µê¸‰ê°€ ë§ˆì§„ íƒ­ -->
            <div id="supply-settings-tab" class="settings-tab-content active">
              <p style="font-size: 13px; color: #666; margin-bottom: 12px;">
                ì›ê°€ êµ¬ê°„ë³„ë¡œ ê³µê¸‰ê°€ ë§ˆì§„ìœ¨ì„ ì„¤ì •í•©ë‹ˆë‹¤. ë‚®ì€ ê¸ˆì•¡ë¶€í„° ìˆœì„œëŒ€ë¡œ ì…ë ¥í•˜ì„¸ìš”.
              </p>
              <div class="margin-rows-container" id="supplyMarginRows">
                <!-- ê³µê¸‰ê°€ ë§ˆì§„ í–‰ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
              </div>
              <div class="margin-actions">
                <button class="btn btn-primary btn-sm" onclick="addSupplyMarginRow()">+ í–‰ ì¶”ê°€</button>
                <button class="btn btn-secondary btn-sm" onclick="sortSupplyMarginRows()">ì •ë ¬</button>
                <button class="btn btn-secondary btn-sm" onclick="clearSupplyMarginRows()">ëª¨ë‘ ì‚­ì œ</button>
              </div>
            </div>

            <!-- íŒë§¤ê°€ ë§ˆì§„ íƒ­ -->
            <div id="sale-settings-tab" class="settings-tab-content">
              <p style="font-size: 13px; color: #666; margin-bottom: 12px;">
                ê³µê¸‰ê°€ êµ¬ê°„ë³„ë¡œ íŒë§¤ê°€ ë§ˆì§„ìœ¨ì„ ì„¤ì •í•©ë‹ˆë‹¤. ë‚®ì€ ê¸ˆì•¡ë¶€í„° ìˆœì„œëŒ€ë¡œ ì…ë ¥í•˜ì„¸ìš”.
              </p>
              <div class="margin-rows-container" id="saleMarginRows">
                <!-- íŒë§¤ê°€ ë§ˆì§„ í–‰ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
              </div>
              <div class="margin-actions">
                <button class="btn btn-primary btn-sm" onclick="addSaleMarginRow()">+ í–‰ ì¶”ê°€</button>
                <button class="btn btn-secondary btn-sm" onclick="sortSaleMarginRows()">ì •ë ¬</button>
                <button class="btn btn-secondary btn-sm" onclick="clearSaleMarginRows()">ëª¨ë‘ ì‚­ì œ</button>
              </div>
            </div>
          </div>
        </div>

        <!-- í…œí”Œë¦¿ ì„¤ì • íƒ­ -->
        <div id="template-main-settings-tab" class="settings-main-tab-content">
          <div class="settings-section">
            <h3>ëŒ€í‘œ ì´ë¯¸ì§€</h3>
            <div class="settings-field">
              <label>ëŒ€í‘œ ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
              <input type="file" id="brandImageUpload" accept="image/*" onchange="handleBrandImageUpload(event)">
              <div id="brandImagePreview" style="margin-top: 10px; display: none;">
                <img id="brandImagePreviewImg" style="max-width: 200px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              </div>
            </div>
          </div>

          <div class="settings-section">
            <h3>ìƒì„¸í˜ì´ì§€ ê¸°ë³¸ êµ¬ì„± ì„¤ì •</h3>
            <p style="font-size: 13px; color: #666; margin-bottom: 12px;">
              ìƒí’ˆ ìˆ˜ì§‘ ì‹œ ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ìƒì„¸í˜ì´ì§€ì˜ ê¸°ë³¸ êµ¬ì„±ì„ ì„¤ì •í•©ë‹ˆë‹¤.
            </p>
            <div id="defaultDetailPageCanvas" class="detail-page-canvas" style="min-height: 300px; background: #f8f9fa; border-radius: 8px; padding: 20px;">
              <!-- ê¸°ë³¸ í…œí”Œë¦¿ ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë¨ -->
            </div>
            <div style="margin-top: 12px; display: flex; gap: 8px;">
              <button class="btn btn-primary btn-sm" onclick="addDefaultText()">+ í…ìŠ¤íŠ¸ ì¶”ê°€</button>
              <button class="btn btn-secondary btn-sm" onclick="resetDefaultTemplate()">ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”</button>
            </div>
          </div>

          <div class="settings-section">
            <h3>í’ˆì§ˆí‘œì‹œì‚¬í•­ ê¸°ë³¸ ë‚´ìš©</h3>
            <p style="font-size: 13px; color: #666; margin-bottom: 12px;">
              í’ˆì§ˆí‘œì‹œì‚¬í•­ì— ê¸°ë³¸ìœ¼ë¡œ í‘œì‹œë  ë‚´ìš©ì„ ì„¤ì •í•©ë‹ˆë‹¤.
            </p>
            <div id="defaultQualityRows">
              <!-- í’ˆì§ˆí‘œì‹œì‚¬í•­ í–‰ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
            </div>
            <button class="btn btn-primary btn-sm" onclick="addDefaultQualityRow()" style="margin-top: 12px;">+ í–‰ ì¶”ê°€</button>
          </div>
        </div>
      </div>

      <div class="settings-footer">
        <button class="btn btn-secondary" onclick="closeSettingsModal()">ì·¨ì†Œ</button>
        <button class="btn btn-success" onclick="saveSettings()">ì €ì¥</button>
      </div>
    </div>
  </div>

  <script>
    // ë²„ì „ í™•ì¸ìš© (ë¸Œë¼ìš°ì € ìºì‹œ í™•ì¸)
    console.log('ğŸ”„ TotalBot Editor ë²„ì „: 2025-11-15-v2 (ì„¤ì • íƒ­ ì¶”ê°€)');
    console.log('âœ… ìµœì‹  ë²„ì „ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ì„¤ì • ëª¨ë‹¬ì— 3ê°œì˜ íƒ­ì´ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.');

    let productId = null;
    let productData = {
      title: '',
      titleCn: '',
      platform: '1688-product',
      mainImage: '',
      images: [],
      results: []
    };

    // ì„ íƒëœ ì¶”ê°€ ì´ë¯¸ì§€ ì¶”ì  (ê²¬ì ì„œìš©)
    let selectedAdditionalImages = new Set();

    // ìƒì„¸í˜ì´ì§€ êµ¬ì„± ë°ì´í„°
    let detailPageItems = [];
    let selectedOptionTemplate = 'gradient'; // ê¸°ë³¸ í…œí”Œë¦¿
    let draggedItem = null;

    // TotalBot ì„¤ì •
    let settings = {
      // ì •ë³´ ì„¤ì •
      coupangId: '',
      coupangPassword: '',
      address: '',
      // ê°€ê²© ì„¤ì •
      exchangeRate: 190,
      packagingCost: 500,
      shipmentCost: 0,
      minMargin: 3000,
      supplyMargins: [
        { amount: 10000, percent: 50 },
        { amount: 50000, percent: 45 },
        { amount: 100000, percent: 40 },
        { amount: 200000, percent: 35 },
        { amount: Infinity, percent: 30 }
      ],
      saleMargins: [
        { amount: 10000, percent: 35 },
        { amount: 50000, percent: 30 },
        { amount: 100000, percent: 25 },
        { amount: 200000, percent: 20 },
        { amount: Infinity, percent: 15 }
      ],
      // í…œí”Œë¦¿ ì„¤ì •
      brandImageUrl: '',
      defaultDetailTemplate: [
        { type: 'brand-image', label: 'ë¸Œëœë“œ ì´ë¯¸ì§€' },
        { type: 'title', label: 'ì œí’ˆëª…' },
        { type: 'option-blocks', label: 'ì˜µì…˜ ë¸”ë¡ë“¤' },
        { type: 'quality-table', label: 'í’ˆì§ˆí‘œì‹œì‚¬í•­' }
      ],
      defaultQualityRows: [
        { label: 'ì œí’ˆëª…', value: '' },
        { label: 'ì œì¡°ì‚¬', value: '' },
        { label: 'ì›ì‚°ì§€', value: '' },
        { label: 'ì œì¡°ë…„ì›”', value: '' }
      ]
    };

    // ì„¤ì • ë¡œë“œ (localStorageì—ì„œ)
    function loadSettings() {
      const saved = localStorage.getItem('totalbotSettings');
      if (saved) {
        try {
          settings = JSON.parse(saved);
        } catch (e) {
          console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', e);
        }
      }
    }

    // ì„¤ì • ì €ì¥ (localStorageì—)
    function saveSettingsToStorage() {
      localStorage.setItem('totalbotSettings', JSON.stringify(settings));
    }

    let currentEditingImage = null;
    let currentEditingImageUrl = null; // ì›ë³¸ ì´ë¯¸ì§€ URL ì¶”ì 
    let currentEditingOptionIndexes = null; // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì˜µì…˜ ì¸ë±ìŠ¤ë“¤
    let originalImageData = null;
    const canvas = document.getElementById('imageCanvas');
    const ctx = canvas.getContext('2d');

    // ì§€ìš°ê°œ ê´€ë ¨ ë³€ìˆ˜
    let isErasing = false;
    let isMagicErasing = false;
    let isDrawing = false;
    let brushSize = 20;
    let lastX = 0;
    let lastY = 0;
    let maskCanvas = null;
    let maskCtx = null;

    // í˜ì´ì§€ ë¡œë“œ
    window.addEventListener('load', () => {
      loadSettings(); // ì„¤ì • ë¨¼ì € ë¡œë“œ

      const urlParams = new URLSearchParams(window.location.search);
      productId = urlParams.get('id');

      if (productId) {
        loadProduct(productId);
      }
    });

    // ì„¤ì • ëª¨ë‹¬ ì—´ê¸°
    function openSettingsModal() {
      // ì •ë³´ ì„¤ì •ê°’ í‘œì‹œ
      document.getElementById('coupangId').value = settings.coupangId || '';
      document.getElementById('coupangPassword').value = settings.coupangPassword || '';
      document.getElementById('address').value = settings.address || '';

      // ê°€ê²© ì„¤ì •ê°’ í‘œì‹œ
      document.getElementById('settingsExchangeRate').value = settings.exchangeRate;
      document.getElementById('settingsPackagingCost').value = settings.packagingCost;
      document.getElementById('settingsShipmentCost').value = settings.shipmentCost;
      document.getElementById('settingsMinMargin').value = settings.minMargin;

      // ë§ˆì§„ í–‰ ë Œë”ë§
      renderSupplyMarginRows();
      renderSaleMarginRows();

      // í…œí”Œë¦¿ ì„¤ì • ë Œë”ë§
      if (settings.brandImageUrl) {
        document.getElementById('brandImagePreview').style.display = 'block';
        document.getElementById('brandImagePreviewImg').src = settings.brandImageUrl;
      }
      renderDefaultDetailTemplate();
      renderDefaultQualityRows();

      document.getElementById('settingsModal').classList.add('active');
    }

    // ì„¤ì • ëª¨ë‹¬ ë‹«ê¸°
    function closeSettingsModal() {
      document.getElementById('settingsModal').classList.remove('active');
    }

    // ë“œë¡­ë‹¤ìš´ í† ê¸€ í•¨ìˆ˜
    function toggleDropdown(dropdownId) {
      const content = document.getElementById(dropdownId);
      const header = content.previousElementSibling;

      // í† ê¸€
      content.classList.toggle('active');
      header.classList.toggle('active');
    }

    // ì„¤ì • ë©”ì¸ íƒ­ ì „í™˜
    function switchMainSettingsTab(tabName) {
      // ëª¨ë“  ë©”ì¸ íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
      document.querySelectorAll('.settings-main-tab').forEach(btn => btn.classList.remove('active'));
      // ëª¨ë“  ë©”ì¸ íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
      document.querySelectorAll('.settings-main-tab-content').forEach(content => content.classList.remove('active'));

      // ì„ íƒí•œ íƒ­ í™œì„±í™”
      event.target.classList.add('active');
      document.getElementById(`${tabName}-main-settings-tab`).classList.add('active');
    }

    // ì„¤ì • íƒ­ ì „í™˜ (ê°€ê²© ì„¤ì • ë‚´ë¶€)
    function switchSettingsTab(tabName) {
      // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
      document.querySelectorAll('.settings-tab').forEach(btn => btn.classList.remove('active'));
      // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
      document.querySelectorAll('.settings-tab-content').forEach(content => content.classList.remove('active'));

      // ì„ íƒí•œ íƒ­ í™œì„±í™”
      event.target.classList.add('active');
      document.getElementById(`${tabName}-settings-tab`).classList.add('active');
    }

    // ê³µê¸‰ê°€ ë§ˆì§„ í–‰ ë Œë”ë§
    function renderSupplyMarginRows() {
      const container = document.getElementById('supplyMarginRows');
      container.innerHTML = '';

      settings.supplyMargins.forEach((margin, index) => {
        const row = document.createElement('div');
        row.className = 'margin-row';
        row.innerHTML = `
          <div>
            <input type="number"
              value="${margin.amount === Infinity ? '' : margin.amount}"
              placeholder="ê¸ˆì•¡ (ì›)"
              onchange="updateSupplyMargin(${index}, 'amount', this.value)"
              ${margin.amount === Infinity ? 'disabled' : ''}>
            <small style="font-size: 11px; color: #888;">ë¯¸ë§Œ</small>
          </div>
          <div>
            <input type="number"
              value="${margin.percent}"
              placeholder="ë§ˆì§„ (%)"
              onchange="updateSupplyMargin(${index}, 'percent', this.value)">
            <small style="font-size: 11px; color: #888;">%</small>
          </div>
          <button onclick="deleteSupplyMargin(${index})" ${margin.amount === Infinity ? 'disabled' : ''}>ì‚­ì œ</button>
        `;
        container.appendChild(row);
      });
    }

    // íŒë§¤ê°€ ë§ˆì§„ í–‰ ë Œë”ë§
    function renderSaleMarginRows() {
      const container = document.getElementById('saleMarginRows');
      container.innerHTML = '';

      settings.saleMargins.forEach((margin, index) => {
        const row = document.createElement('div');
        row.className = 'margin-row';
        row.innerHTML = `
          <div>
            <input type="number"
              value="${margin.amount === Infinity ? '' : margin.amount}"
              placeholder="ê¸ˆì•¡ (ì›)"
              onchange="updateSaleMargin(${index}, 'amount', this.value)"
              ${margin.amount === Infinity ? 'disabled' : ''}>
            <small style="font-size: 11px; color: #888;">ë¯¸ë§Œ</small>
          </div>
          <div>
            <input type="number"
              value="${margin.percent}"
              placeholder="ë§ˆì§„ (%)"
              onchange="updateSaleMargin(${index}, 'percent', this.value)">
            <small style="font-size: 11px; color: #888;">%</small>
          </div>
          <button onclick="deleteSaleMargin(${index})" ${margin.amount === Infinity ? 'disabled' : ''}>ì‚­ì œ</button>
        `;
        container.appendChild(row);
      });
    }

    // ê³µê¸‰ê°€ ë§ˆì§„ ì—…ë°ì´íŠ¸
    function updateSupplyMargin(index, field, value) {
      if (field === 'amount') {
        settings.supplyMargins[index].amount = value === '' ? Infinity : parseFloat(value);
      } else {
        settings.supplyMargins[index].percent = parseFloat(value);
      }
    }

    // íŒë§¤ê°€ ë§ˆì§„ ì—…ë°ì´íŠ¸
    function updateSaleMargin(index, field, value) {
      if (field === 'amount') {
        settings.saleMargins[index].amount = value === '' ? Infinity : parseFloat(value);
      } else {
        settings.saleMargins[index].percent = parseFloat(value);
      }
    }

    // ê³µê¸‰ê°€ ë§ˆì§„ í–‰ ì¶”ê°€
    function addSupplyMarginRow() {
      // Infinity í–‰ ì´ì „ì— ì¶”ê°€
      settings.supplyMargins.splice(settings.supplyMargins.length - 1, 0, { amount: 0, percent: 30 });
      renderSupplyMarginRows();
    }

    // íŒë§¤ê°€ ë§ˆì§„ í–‰ ì¶”ê°€
    function addSaleMarginRow() {
      settings.saleMargins.splice(settings.saleMargins.length - 1, 0, { amount: 0, percent: 15 });
      renderSaleMarginRows();
    }

    // ê³µê¸‰ê°€ ë§ˆì§„ í–‰ ì‚­ì œ
    function deleteSupplyMargin(index) {
      if (settings.supplyMargins[index].amount !== Infinity) {
        settings.supplyMargins.splice(index, 1);
        renderSupplyMarginRows();
      }
    }

    // íŒë§¤ê°€ ë§ˆì§„ í–‰ ì‚­ì œ
    function deleteSaleMargin(index) {
      if (settings.saleMargins[index].amount !== Infinity) {
        settings.saleMargins.splice(index, 1);
        renderSaleMarginRows();
      }
    }

    // ê³µê¸‰ê°€ ë§ˆì§„ ì •ë ¬
    function sortSupplyMarginRows() {
      const infinityRow = settings.supplyMargins.pop();
      settings.supplyMargins.sort((a, b) => a.amount - b.amount);
      settings.supplyMargins.push(infinityRow);
      renderSupplyMarginRows();
    }

    // íŒë§¤ê°€ ë§ˆì§„ ì •ë ¬
    function sortSaleMarginRows() {
      const infinityRow = settings.saleMargins.pop();
      settings.saleMargins.sort((a, b) => a.amount - b.amount);
      settings.saleMargins.push(infinityRow);
      renderSaleMarginRows();
    }

    // ê³µê¸‰ê°€ ë§ˆì§„ ëª¨ë‘ ì‚­ì œ
    function clearSupplyMarginRows() {
      if (confirm('ëª¨ë“  ê³µê¸‰ê°€ ë§ˆì§„ ì„¤ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        settings.supplyMargins = [{ amount: Infinity, percent: 30 }];
        renderSupplyMarginRows();
      }
    }

    // íŒë§¤ê°€ ë§ˆì§„ ëª¨ë‘ ì‚­ì œ
    function clearSaleMarginRows() {
      if (confirm('ëª¨ë“  íŒë§¤ê°€ ë§ˆì§„ ì„¤ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        settings.saleMargins = [{ amount: Infinity, percent: 15 }];
        renderSaleMarginRows();
      }
    }

    // ì„¤ì • ì €ì¥
    function saveSettings() {
      // ì •ë³´ ì„¤ì • ì €ì¥
      settings.coupangId = document.getElementById('coupangId').value || '';
      settings.coupangPassword = document.getElementById('coupangPassword').value || '';
      settings.address = document.getElementById('address').value || '';

      // ê°€ê²© ì„¤ì • ì €ì¥
      settings.exchangeRate = parseFloat(document.getElementById('settingsExchangeRate').value) || 190;
      settings.packagingCost = parseFloat(document.getElementById('settingsPackagingCost').value) || 500;
      settings.shipmentCost = parseFloat(document.getElementById('settingsShipmentCost').value) || 0;
      settings.minMargin = parseFloat(document.getElementById('settingsMinMargin').value) || 3000;

      // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
      saveSettingsToStorage();

      // ê°€ê²© ì¬ê³„ì‚°
      renderOptions();

      closeSettingsModal();
      showAlert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
    }

    // ëŒ€í‘œ ì´ë¯¸ì§€ ì—…ë¡œë“œ
    function handleBrandImageUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          settings.brandImageUrl = e.target.result;
          document.getElementById('brandImagePreview').style.display = 'block';
          document.getElementById('brandImagePreviewImg').src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    }

    // ê¸°ë³¸ í…œí”Œë¦¿ì— í…ìŠ¤íŠ¸ ì¶”ê°€
    function addDefaultText() {
      const text = prompt('ì¶”ê°€í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
      if (text) {
        settings.defaultDetailTemplate.push({
          type: 'text',
          label: text,
          text: text
        });
        renderDefaultDetailTemplate();
      }
    }

    // ê¸°ë³¸ í…œí”Œë¦¿ ì´ˆê¸°í™”
    function resetDefaultTemplate() {
      if (confirm('ê¸°ë³¸ í…œí”Œë¦¿ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        settings.defaultDetailTemplate = [
          { type: 'brand-image', label: 'ë¸Œëœë“œ ì´ë¯¸ì§€' },
          { type: 'title', label: 'ì œí’ˆëª…' },
          { type: 'option-blocks', label: 'ì˜µì…˜ ë¸”ë¡ë“¤' },
          { type: 'quality-table', label: 'í’ˆì§ˆí‘œì‹œì‚¬í•­' }
        ];
        renderDefaultDetailTemplate();
      }
    }

    // ê¸°ë³¸ í…œí”Œë¦¿ ë Œë”ë§
    function renderDefaultDetailTemplate() {
      const canvas = document.getElementById('defaultDetailPageCanvas');
      canvas.innerHTML = '';

      if (settings.defaultDetailTemplate.length === 0) {
        canvas.innerHTML = '<p style="text-align: center; color: #888; padding: 60px;">í…œí”Œë¦¿ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>';
        return;
      }

      settings.defaultDetailTemplate.forEach((item, index) => {
        const div = document.createElement('div');
        div.style.cssText = `
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 12px 16px;
          margin-bottom: 8px;
          background: white;
          border-radius: 6px;
          border: 1px solid #e0e0e0;
        `;

        const label = document.createElement('div');
        label.style.cssText = 'font-size: 14px; font-weight: 500;';
        label.textContent = item.label;

        const actions = document.createElement('div');
        actions.style.cssText = 'display: flex; gap: 8px;';

        // ìœ„ë¡œ ì´ë™ ë²„íŠ¼
        if (index > 0) {
          const upBtn = document.createElement('button');
          upBtn.className = 'btn btn-sm';
          upBtn.textContent = 'â†‘';
          upBtn.onclick = () => {
            [settings.defaultDetailTemplate[index-1], settings.defaultDetailTemplate[index]] =
            [settings.defaultDetailTemplate[index], settings.defaultDetailTemplate[index-1]];
            renderDefaultDetailTemplate();
          };
          actions.appendChild(upBtn);
        }

        // ì•„ë˜ë¡œ ì´ë™ ë²„íŠ¼
        if (index < settings.defaultDetailTemplate.length - 1) {
          const downBtn = document.createElement('button');
          downBtn.className = 'btn btn-sm';
          downBtn.textContent = 'â†“';
          downBtn.onclick = () => {
            [settings.defaultDetailTemplate[index], settings.defaultDetailTemplate[index+1]] =
            [settings.defaultDetailTemplate[index+1], settings.defaultDetailTemplate[index]];
            renderDefaultDetailTemplate();
          };
          actions.appendChild(downBtn);
        }

        // ì‚­ì œ ë²„íŠ¼ (ë¸Œëœë“œ ì´ë¯¸ì§€, ì œí’ˆëª…, ì˜µì…˜ ë¸”ë¡ë“¤, í’ˆì§ˆí‘œì‹œì‚¬í•­ì€ ì‚­ì œ ë¶ˆê°€)
        if (item.type === 'text') {
          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'btn btn-sm';
          deleteBtn.textContent = 'ğŸ—‘';
          deleteBtn.onclick = () => {
            settings.defaultDetailTemplate.splice(index, 1);
            renderDefaultDetailTemplate();
          };
          actions.appendChild(deleteBtn);
        }

        div.appendChild(label);
        div.appendChild(actions);
        canvas.appendChild(div);
      });
    }

    // í’ˆì§ˆí‘œì‹œì‚¬í•­ ê¸°ë³¸ í–‰ ì¶”ê°€
    function addDefaultQualityRow() {
      settings.defaultQualityRows.push({ label: '', value: '' });
      renderDefaultQualityRows();
    }

    // í’ˆì§ˆí‘œì‹œì‚¬í•­ í–‰ ë Œë”ë§
    function renderDefaultQualityRows() {
      const container = document.getElementById('defaultQualityRows');
      container.innerHTML = '';

      settings.defaultQualityRows.forEach((row, index) => {
        const rowDiv = document.createElement('div');
        rowDiv.style.cssText = 'display: flex; gap: 12px; margin-bottom: 12px;';

        const labelInput = document.createElement('input');
        labelInput.type = 'text';
        labelInput.placeholder = 'í•­ëª©ëª…';
        labelInput.value = row.label;
        labelInput.style.cssText = 'flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;';
        labelInput.oninput = (e) => {
          settings.defaultQualityRows[index].label = e.target.value;
        };

        const valueInput = document.createElement('input');
        valueInput.type = 'text';
        valueInput.placeholder = 'ê¸°ë³¸ê°’ (ë¹„ì–´ìˆì–´ë„ ë¨)';
        valueInput.value = row.value;
        valueInput.style.cssText = 'flex: 2; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;';
        valueInput.oninput = (e) => {
          settings.defaultQualityRows[index].value = e.target.value;
        };

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'btn btn-secondary btn-sm';
        deleteBtn.textContent = 'ğŸ—‘';
        deleteBtn.onclick = () => {
          settings.defaultQualityRows.splice(index, 1);
          renderDefaultQualityRows();
        };

        rowDiv.appendChild(labelInput);
        rowDiv.appendChild(valueInput);
        rowDiv.appendChild(deleteBtn);
        container.appendChild(rowDiv);
      });
    }

    // ë©”ì¸ íƒ­ ì „í™˜
    function switchMainTab(tabName) {
      // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
      document.querySelectorAll('.main-tab').forEach(btn => btn.classList.remove('active'));
      // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
      document.querySelectorAll('.main-tab-content').forEach(content => content.classList.remove('active'));

      // ì„ íƒí•œ íƒ­ í™œì„±í™”
      event.target.classList.add('active');
      document.getElementById(`${tabName}-tab`).classList.add('active');
    }

    // ìƒí’ˆ ë°ì´í„° ë¡œë“œ
    // ì¶”ê°€ ì´ë¯¸ì§€ ì„ íƒ í† ê¸€
    function toggleAdditionalImageSelection(imageUrl, event) {
      // í¸ì§‘ ë²„íŠ¼ í´ë¦­ì‹œì—ëŠ” ì„ íƒë˜ì§€ ì•Šë„ë¡
      if (event.target.classList.contains('image-edit-btn')) {
        return;
      }

      if (selectedAdditionalImages.has(imageUrl)) {
        selectedAdditionalImages.delete(imageUrl);
      } else {
        selectedAdditionalImages.add(imageUrl);
      }

      // UI ì—…ë°ì´íŠ¸
      const imgElement = document.querySelector(`[data-additional-image="${imageUrl}"]`);
      if (imgElement) {
        imgElement.classList.toggle('selected');
      }
    }

    // ìœ ë‹ˆí¬ ì˜µì…˜ ì´ë¯¸ì§€ ë Œë”ë§
    function renderUniqueOptionImages() {
      const optionImagesGrid = document.getElementById('optionImagesGridTab');
      optionImagesGrid.innerHTML = '';

      if (!productData.results || productData.results.length === 0) {
        optionImagesGrid.innerHTML = '<p style="color: #888; padding: 20px;">ì˜µì…˜ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      // ìœ ë‹ˆí¬ ì´ë¯¸ì§€ ì¶”ì¶œ (ì´ë¯¸ì§€ë³„ë¡œ ì‚¬ìš© íšŸìˆ˜ë„ ê³„ì‚°)
      const imageMap = new Map();

      productData.results.forEach((option, index) => {
        const imgSrc = option.imageLink || option.titleImage?.[0] || '';
        if (imgSrc) {
          if (!imageMap.has(imgSrc)) {
            imageMap.set(imgSrc, {
              url: imgSrc,
              count: 0,
              optionIndexes: []
            });
          }
          const imageInfo = imageMap.get(imgSrc);
          imageInfo.count++;
          imageInfo.optionIndexes.push(index);
        }
      });

      // ìœ ë‹ˆí¬ ì´ë¯¸ì§€ë“¤ì„ ê·¸ë¦¬ë“œì— í‘œì‹œ
      imageMap.forEach((imageInfo, imgSrc) => {
        const container = document.createElement('div');
        container.className = 'image-item-container option-image-item';
        container.setAttribute('data-option-image', imgSrc);

        const img = document.createElement('img');
        img.src = imgSrc;
        img.onerror = function() {
          this.parentElement.innerHTML = '<div style="padding: 20px; background: #f5f5f5; text-align: center; border-radius: 6px;">ğŸ“·</div>';
        };

        // í¸ì§‘ ë²„íŠ¼
        const editBtn = document.createElement('button');
        editBtn.className = 'image-edit-btn';
        editBtn.textContent = 'í¸ì§‘';
        editBtn.onclick = (e) => {
          e.stopPropagation();
          openMagicBrush(imgSrc, imageInfo.optionIndexes);
        };

        const countLabel = document.createElement('div');
        countLabel.className = 'option-image-count';
        countLabel.textContent = `${imageInfo.count}ê°œ ì˜µì…˜`;

        container.appendChild(img);
        container.appendChild(editBtn);
        container.appendChild(countLabel);
        optionImagesGrid.appendChild(container);
      });
    }

    async function loadProduct(id) {
      try {
        const response = await fetch(`/api/products/${id}`, {
          credentials: 'include'
        });

        if (!response.ok) {
          throw new Error('ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        const data = await response.json();
        productData = data.product;

        // ìƒí’ˆëª… í‘œì‹œ
        document.getElementById('productTitle').value = productData.title || productData.titleCn || '';

        // ì¶”ê°€ ì´ë¯¸ì§€ë“¤ (ì´ë¯¸ì§€ íƒ­ - ì¢Œì¸¡)
        const additionalGridTab = document.getElementById('additionalImagesGridTab');
        additionalGridTab.innerHTML = '';

        // ëŒ€í‘œ ì´ë¯¸ì§€ë¥¼ ì¶”ê°€ ì´ë¯¸ì§€ ëª©ë¡ ë§¨ ì•ì— ì¶”ê°€
        const allImages = [];
        if (productData.mainImage) {
          allImages.push(productData.mainImage);
        }
        if (productData.images && productData.images.length > 0) {
          allImages.push(...productData.images);
        }

        if (allImages.length > 0) {
          allImages.forEach(img => {
            const container = document.createElement('div');
            container.className = 'image-item-container additional-image-item';
            container.setAttribute('data-additional-image', img);

            // ì´ì „ ì„ íƒ ìƒíƒœ ë³µì›
            if (selectedAdditionalImages.has(img)) {
              container.classList.add('selected');
            }

            const imgEl = document.createElement('img');
            imgEl.src = img;
            imgEl.onerror = function() { this.style.display = 'none'; };

            // í¸ì§‘ ë²„íŠ¼
            const editBtn = document.createElement('button');
            editBtn.className = 'image-edit-btn';
            editBtn.textContent = 'í¸ì§‘';
            editBtn.onclick = (e) => {
              e.stopPropagation();
              openMagicBrush(img);
            };

            // ì»¨í…Œì´ë„ˆ í´ë¦­ì‹œ ì„ íƒ/í•´ì œ
            container.onclick = (e) => toggleAdditionalImageSelection(img, e);

            container.appendChild(imgEl);
            container.appendChild(editBtn);
            additionalGridTab.appendChild(container);
          });
        } else {
          additionalGridTab.innerHTML = '<p style="color: #888; padding: 20px;">ì¶”ê°€ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        // ì˜µì…˜ ì´ë¯¸ì§€ ë Œë”ë§ (ì´ë¯¸ì§€ íƒ­ - ìš°ì¸¡)
        renderUniqueOptionImages();

        // ì˜µì…˜ ë Œë”ë§
        renderOptions();

        // ìƒì„¸í˜ì´ì§€ ì—ë””í„° ì´ˆê¸°í™”
        initDetailPageEditor();

        // ìë™ ë²ˆì—­ (ë¹ˆ í•„ë“œë§Œ ë²ˆì—­)
        await autoTranslate(true);

        showAlert('ìƒí’ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');
      } catch (error) {
        console.error('ìƒí’ˆ ë¡œë“œ ì˜¤ë¥˜:', error);
        showAlert('ìƒí’ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    }

    // ========================================
    // ìƒì„¸í˜ì´ì§€ ì—ë””í„° ê¸°ëŠ¥
    // ========================================

    // ìƒì„¸í˜ì´ì§€ ì—ë””í„° ì´ˆê¸°í™”
    function initDetailPageEditor() {
      renderDetailSources();

      // ì €ì¥ëœ detailPageItemsê°€ ìˆìœ¼ë©´ ë¶ˆëŸ¬ì˜¤ê¸°, ì—†ìœ¼ë©´ ìë™ ìƒì„±
      if (productData.detailPageItems && productData.detailPageItems.length > 0) {
        console.log('[Editor] ì €ì¥ëœ detailPageItems ë¶ˆëŸ¬ì˜¤ê¸° (' + productData.detailPageItems.length + 'ê°œ)');
        detailPageItems = productData.detailPageItems;
        renderDetailCanvas();
      } else {
        console.log('[Editor] detailPageItems ì—†ìŒ, ìë™ ìƒì„±');
        autoGenerateDetailPage();
      }

      // ë“œë¡­ ì¡´ ì„¤ì •
      const canvas = document.getElementById('detailPageCanvas');
      let dropIndicator = null;
      let dropIndex = -1;

      canvas.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'copy';

        // ë“œë¡­ ìœ„ì¹˜ ê³„ì‚°
        const items = canvas.querySelectorAll('.detail-page-item');
        let closestItem = null;
        let closestDistance = Number.POSITIVE_INFINITY;
        let insertBefore = false;

        items.forEach((item, index) => {
          const rect = item.getBoundingClientRect();
          const midpoint = rect.top + rect.height / 2;
          const distance = Math.abs(e.clientY - midpoint);

          if (distance < closestDistance) {
            closestDistance = distance;
            closestItem = item;
            insertBefore = e.clientY < midpoint;
            dropIndex = insertBefore ? index : index + 1;
          }
        });

        // ë“œë¡­ ì¸ë””ì¼€ì´í„° í‘œì‹œ
        if (!dropIndicator) {
          dropIndicator = document.createElement('div');
          dropIndicator.style.cssText = `
            height: 3px;
            background: #1e90ff;
            margin: 4px 0;
            border-radius: 2px;
            box-shadow: 0 0 8px rgba(30, 144, 255, 0.5);
          `;
        }

        if (closestItem) {
          if (insertBefore) {
            closestItem.parentNode.insertBefore(dropIndicator, closestItem);
          } else {
            closestItem.parentNode.insertBefore(dropIndicator, closestItem.nextSibling);
          }
        } else {
          // ë¹ˆ ìº”ë²„ìŠ¤ê±°ë‚˜ ëª¨ë“  ì•„ì´í…œ ì•„ë˜
          canvas.appendChild(dropIndicator);
          dropIndex = detailPageItems.length;
        }
      });

      canvas.addEventListener('dragleave', (e) => {
        if (e.target === canvas && dropIndicator && dropIndicator.parentNode) {
          dropIndicator.parentNode.removeChild(dropIndicator);
          dropIndicator = null;
        }
      });

      canvas.addEventListener('drop', (e) => {
        e.preventDefault();

        if (dropIndicator && dropIndicator.parentNode) {
          dropIndicator.parentNode.removeChild(dropIndicator);
          dropIndicator = null;
        }

        const imageSrc = e.dataTransfer.getData('imageSrc');
        const textType = e.dataTransfer.getData('textType');
        const label = e.dataTransfer.getData('label');

        // í…ìŠ¤íŠ¸ ë“œë¡­
        if (textType) {
          const labels = {
            'title': 'íƒ€ì´í‹€',
            'subtitle': 'ì¤‘ê°„ íƒ€ì´í‹€',
            'paragraph': 'ì¼ë°˜ í…ìŠ¤íŠ¸'
          };

          const newItem = {
            type: 'custom-text',
            textType: textType,
            text: '',
            color: '#000000',
            align: 'left',
            font: 'system-ui',
            label: labels[textType]
          };

          // ë“œë¡­ ìœ„ì¹˜ì— ì‚½ì…
          if (dropIndex >= 0 && dropIndex < detailPageItems.length) {
            detailPageItems.splice(dropIndex, 0, newItem);
          } else {
            detailPageItems.push(newItem);
          }

          renderDetailCanvas();
          showAlert(`${labels[textType]}ì´(ê°€) ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
          dropIndex = -1;
          return;
        }

        // ì´ë¯¸ì§€ ë“œë¡­
        if (!imageSrc) return;

        const imageCount = detailPageItems.filter(item =>
          item.type === 'brand-image' || item.type === 'image' || item.type === 'option-block'
        ).length + 1;

        const newItem = {
          type: 'image',
          imageSrc: imageSrc,
          label: label,
          imageNumber: imageCount,
          layout: 'presentation',
          align: 'center',
          imageText: '',
          textPosition: 'right'
        };

        // ë“œë¡­ ìœ„ì¹˜ì— ì‚½ì…
        if (dropIndex >= 0 && dropIndex < detailPageItems.length) {
          detailPageItems.splice(dropIndex, 0, newItem);
        } else {
          detailPageItems.push(newItem);
        }

        renderDetailCanvas();
        showAlert('ì´ë¯¸ì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        dropIndex = -1;
      });

      // í…ìŠ¤íŠ¸ ë²„íŠ¼ ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì„¤ì •
      setupTextDragEvents();
    }

    // í…ìŠ¤íŠ¸ ë²„íŠ¼ ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì„¤ì •
    function setupTextDragEvents() {
      const textButtons = document.querySelectorAll('.text-add-btn[draggable="true"]');

      textButtons.forEach(btn => {
        btn.addEventListener('dragstart', (e) => {
          const textType = e.target.dataset.textType;
          e.dataTransfer.setData('textType', textType);
          e.dataTransfer.effectAllowed = 'copy';

          // ë“œë˜ê·¸ ì¤‘ ìŠ¤íƒ€ì¼ ë³€ê²½
          e.target.style.opacity = '0.5';
          e.target.style.cursor = 'grabbing';
        });

        btn.addEventListener('dragend', (e) => {
          // ë“œë˜ê·¸ ëë‚˜ë©´ ìŠ¤íƒ€ì¼ ë³µì›
          e.target.style.opacity = '1';
          e.target.style.cursor = 'grab';
        });
      });
    }

    // ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë¯¸ì§€ ì†ŒìŠ¤ ë Œë”ë§
    function renderDetailSources() {
      // ëŒ€í‘œ ì´ë¯¸ì§€
      const mainImageSource = document.getElementById('detailMainImageSource');
      mainImageSource.innerHTML = '';
      if (productData.mainImage) {
        const item = createSourceImageItem(productData.mainImage, 'ëŒ€í‘œ ì´ë¯¸ì§€');
        mainImageSource.appendChild(item);
      }

      // ì¶”ê°€ ì´ë¯¸ì§€
      const additionalImagesSource = document.getElementById('detailAdditionalImagesSource');
      additionalImagesSource.innerHTML = '';
      if (productData.images && productData.images.length > 0) {
        productData.images.forEach((img, index) => {
          const item = createSourceImageItem(img, `ì¶”ê°€ ì´ë¯¸ì§€ ${index + 1}`);
          additionalImagesSource.appendChild(item);
        });
      }

      // ì˜µì…˜ ì´ë¯¸ì§€ (ìœ ë‹ˆí¬)
      const optionImagesSource = document.getElementById('detailOptionImagesSource');
      optionImagesSource.innerHTML = '';

      const uniqueOptionImages = new Map();
      if (productData.results) {
        productData.results.forEach(option => {
          const img = option.imageLink || option.titleImage?.[0];
          if (img && !uniqueOptionImages.has(img)) {
            const optionName = option.optionName1 || option.optionName1Cn || 'ì˜µì…˜';
            uniqueOptionImages.set(img, optionName);
          }
        });

        uniqueOptionImages.forEach((name, img) => {
          const item = createSourceImageItem(img, name, true);
          optionImagesSource.appendChild(item);
        });
      }
    }

    // ì†ŒìŠ¤ ì´ë¯¸ì§€ ì•„ì´í…œ ìƒì„±
    function createSourceImageItem(imageSrc, label, isOption = false) {
      const div = document.createElement('div');
      div.className = 'source-image-item';
      div.draggable = true;
      div.dataset.imageSrc = imageSrc;
      div.dataset.label = label;
      div.dataset.isOption = isOption;

      const img = document.createElement('img');
      img.src = imageSrc;
      img.onerror = function() {
        this.parentElement.style.display = 'none';
      };

      div.appendChild(img);

      // ë“œë˜ê·¸ ì´ë²¤íŠ¸
      div.addEventListener('dragstart', (e) => {
        e.dataTransfer.effectAllowed = 'copy';
        e.dataTransfer.setData('imageSrc', imageSrc);
        e.dataTransfer.setData('label', label);
        e.dataTransfer.setData('isOption', isOption);
      });

      div.addEventListener('click', () => {
        // ì¶”ê°€ ì´ë¯¸ì§€ë§Œ í´ë¦­ìœ¼ë¡œ ì¶”ê°€ ê°€ëŠ¥ (ëŒ€í‘œ ì´ë¯¸ì§€ì™€ ì˜µì…˜ ì´ë¯¸ì§€ëŠ” ìë™ êµ¬ì„±ì— í¬í•¨ë¨)
        if (!isOption && label.includes('ì¶”ê°€ ì´ë¯¸ì§€')) {
          const imageCount = detailPageItems.filter(item =>
            item.type === 'brand-image' || item.type === 'image' || item.type === 'option-block'
          ).length + 1;

          addDetailPageItem({
            type: 'image',
            imageSrc: imageSrc,
            label: label,
            imageNumber: imageCount,
            layout: 'presentation',
            align: 'center',
            imageText: '',
            textPosition: 'right'
          });
        }
      });

      return div;
    }

    // ìƒì„¸í˜ì´ì§€ ìº”ë²„ìŠ¤ ë Œë”ë§
    function renderDetailCanvas() {
      const canvas = document.getElementById('detailPageCanvas');
      canvas.innerHTML = '';

      if (detailPageItems.length === 0) {
        canvas.innerHTML = '<p style="text-align: center; color: #888; padding: 60px;">ì¢Œì¸¡ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì¶”ê°€í•˜ì„¸ìš”</p>';
        return;
      }

      detailPageItems.forEach((item, index) => {
        const itemEl = createDetailPageItemElement(item, index);
        canvas.appendChild(itemEl);
      });
    }

    // ìƒì„¸í˜ì´ì§€ ì•„ì´í…œ ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
    function createDetailPageItemElement(item, index) {
      const div = document.createElement('div');
      div.className = 'detail-page-item';
      div.draggable = true;
      div.dataset.index = index;

      // í’ˆì§ˆí‘œì‹œì‚¬í•­ ë¸”ë¡
      if (item.type === 'quality-table') {
        div.classList.add('quality-table');

        // í—¤ë”
        const header = document.createElement('div');
        header.className = 'quality-table-header';

        const handle = document.createElement('span');
        handle.className = 'item-drag-handle';
        handle.innerHTML = 'â‹®â‹®';

        const title = document.createElement('div');
        title.className = 'quality-table-title';
        title.textContent = item.title || 'í’ˆì§ˆí‘œì‹œì‚¬í•­';
        title.contentEditable = true;
        title.onblur = (e) => {
          detailPageItems[index].title = e.target.textContent;
        };

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'item-action-btn delete';
        deleteBtn.innerHTML = 'ğŸ—‘';
        deleteBtn.title = 'ì‚­ì œ';
        deleteBtn.onclick = () => {
          detailPageItems.splice(index, 1);
          renderDetailCanvas();
        };

        header.appendChild(handle);
        header.appendChild(title);
        header.appendChild(deleteBtn);

        // í…Œì´ë¸” ì»¨í…ì¸ 
        const tableContent = document.createElement('div');
        tableContent.className = 'quality-table-content';

        if (item.rows && item.rows.length > 0) {
          item.rows.forEach((row, rowIndex) => {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'quality-table-row';

            const label = document.createElement('div');
            label.className = 'quality-table-label';
            label.textContent = row.label || 'í•­ëª©';
            label.contentEditable = true;
            label.onblur = (e) => {
              detailPageItems[index].rows[rowIndex].label = e.target.textContent;
            };

            const value = document.createElement('div');
            value.className = 'quality-table-value';
            value.textContent = row.value || 'ë‚´ìš©';
            value.contentEditable = true;
            value.onblur = (e) => {
              detailPageItems[index].rows[rowIndex].value = e.target.textContent;
            };

            rowDiv.appendChild(label);
            rowDiv.appendChild(value);
            tableContent.appendChild(rowDiv);
          });
        }

        div.appendChild(header);
        div.appendChild(tableContent);

        setupDragEvents(div, index);
        return div;
      }

      // ì˜µì…˜ ë¸”ë¡ì€ íŠ¹ë³„í•œ ë ˆì´ì•„ì›ƒ
      if (item.type === 'option-block') {
        div.classList.add('option-block');

        // ë“œë˜ê·¸ í•¸ë“¤
        const handle = document.createElement('span');
        handle.className = 'item-drag-handle';
        handle.innerHTML = 'â‹®â‹®';

        // ì»¨í…ì¸  (ì¢Œì¸¡ ì´ë¯¸ì§€ + ìš°ì¸¡ í…ìŠ¤íŠ¸)
        const content = document.createElement('div');
        content.className = 'option-block-content';

        const imagePlaceholder = document.createElement('div');
        imagePlaceholder.className = 'option-block-image';
        if (item.imageSrc) {
          imagePlaceholder.innerHTML = '<img src="' + item.imageSrc + '" style="width:100%;height:100%;object-fit:cover;border-radius:6px;">';
        } else {
          imagePlaceholder.textContent = item.imageLabel || '[Image #1]';
        }

        const textArea = document.createElement('div');
        textArea.className = 'option-block-text';

        const title = document.createElement('div');
        title.className = 'option-block-title';
        title.textContent = item.optionName || 'ì˜µì…˜ëª…';
        title.contentEditable = true;
        title.onblur = (e) => {
          detailPageItems[index].optionName = e.target.textContent;
        };

        // í…œí”Œë¦¿ ì„ íƒê¸° ì¶”ê°€
        const templateSelect = document.createElement('select');
        templateSelect.className = 'template-select-inline';
        templateSelect.dataset.itemIndex = index; // ì¸ë±ìŠ¤ë¥¼ datasetì— ì €ì¥
        templateSelect.innerHTML = `
          <optgroup label="ê¸°ë³¸ ìŠ¤íƒ€ì¼">
            <option value="horizontal" ${item.template === 'horizontal' ? 'selected' : ''}>ê°€ë¡œí˜•</option>
            <option value="horizontal-reverse" ${item.template === 'horizontal-reverse' ? 'selected' : ''}>ê°€ë¡œí˜• ë°˜ì „</option>
            <option value="vertical" ${item.template === 'vertical' ? 'selected' : ''}>ì„¸ë¡œí˜•</option>
            <option value="card" ${item.template === 'card' ? 'selected' : ''}>ì¹´ë“œí˜•</option>
            <option value="centered" ${item.template === 'centered' ? 'selected' : ''}>ì¤‘ì•™ ì •ë ¬</option>
            <option value="split" ${item.template === 'split' ? 'selected' : ''}>50/50 ë¶„í• </option>
            <option value="gradient" ${item.template === 'gradient' ? 'selected' : ''}>ê·¸ë¼ë°ì´ì…˜</option>
          </optgroup>
          <optgroup label="ì»¬ëŸ¬í’€">
            <option value="modern" ${item.template === 'modern' ? 'selected' : ''}>ğŸŸ£ ëª¨ë˜ (ë³´ë¼)</option>
            <option value="neon" ${item.template === 'neon' ? 'selected' : ''}>ğŸ’— ë„¤ì˜¨ (í•‘í¬)</option>
            <option value="sunset" ${item.template === 'sunset' ? 'selected' : ''}>ğŸŒ… ì¼ëª° (ì˜¤ë Œì§€)</option>
            <option value="ocean" ${item.template === 'ocean' ? 'selected' : ''}>ğŸŒŠ ë°”ë‹¤ (íŒŒë‘)</option>
            <option value="mint" ${item.template === 'mint' ? 'selected' : ''}>ğŸŒ¿ ë¯¼íŠ¸ (ì´ˆë¡)</option>
            <option value="dark" ${item.template === 'dark' ? 'selected' : ''}>ğŸŒ™ ë‹¤í¬ëª¨ë“œ</option>
          </optgroup>
          <optgroup label="ë…íŠ¹í•œ ìŠ¤íƒ€ì¼">
            <option value="neon-border" ${item.template === 'neon-border' ? 'selected' : ''}>âœ¨ ë„¤ì˜¨ í…Œë‘ë¦¬</option>
            <option value="badge" ${item.template === 'badge' ? 'selected' : ''}>ğŸ·ï¸ ë°°ì§€í˜•</option>
            <option value="diagonal" ${item.template === 'diagonal' ? 'selected' : ''}>ğŸ“ ëŒ€ê°ì„ </option>
            <option value="overlay" ${item.template === 'overlay' ? 'selected' : ''}>ğŸ–¼ï¸ ì˜¤ë²„ë ˆì´</option>
          </optgroup>
        `;
        templateSelect.onchange = function(e) {
          const newTemplate = e.target.value;
          const itemIndex = parseInt(e.target.dataset.itemIndex);

          // ì˜µì…˜ëª…ìœ¼ë¡œ ì•„ì´í…œ ì°¾ê¸° (ë” ì•ˆì „)
          const optionName = item.optionName;
          const foundIndex = detailPageItems.findIndex((it, idx) =>
            it.type === 'option-block' && it.optionName === optionName
          );

          if (foundIndex !== -1) {
            detailPageItems[foundIndex].template = newTemplate;
            console.log(`âœ… í…œí”Œë¦¿ ë³€ê²½ ì„±ê³µ: ì˜µì…˜="${optionName}", index=${foundIndex}, template=${newTemplate}`, detailPageItems[foundIndex]);
            showAlert(`"${optionName}" í…œí”Œë¦¿ì´ ${newTemplate}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
          } else {
            console.error(`âŒ í…œí”Œë¦¿ ë³€ê²½ ì‹¤íŒ¨: ì˜µì…˜="${optionName}"ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
          }
        };

        const subtitle = document.createElement('div');
        subtitle.className = 'option-block-subtitle';
        subtitle.textContent = item.option2List || 'ì˜µì…˜2 ëª©ë¡';
        subtitle.contentEditable = true;
        subtitle.onblur = (e) => {
          detailPageItems[index].option2List = e.target.textContent;
        };

        textArea.appendChild(title);
        textArea.appendChild(templateSelect);
        textArea.appendChild(subtitle);

        content.appendChild(imagePlaceholder);
        content.appendChild(textArea);

        // ì‚­ì œ ë²„íŠ¼
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'item-action-btn delete';
        deleteBtn.innerHTML = 'ğŸ—‘';
        deleteBtn.title = 'ì‚­ì œ';
        deleteBtn.onclick = () => {
          detailPageItems.splice(index, 1);
          renderDetailCanvas();
        };

        div.appendChild(handle);
        div.appendChild(content);
        div.appendChild(deleteBtn);

        setupDragEvents(div, index);
        return div;
      }

      // ì»¤ìŠ¤í…€ í…ìŠ¤íŠ¸ ë¸”ë¡ (ìƒ‰ìƒ + ì •ë ¬ ì˜µì…˜ í¬í•¨)
      if (item.type === 'custom-text') {
        div.classList.add('custom-text-block');

        // ë“œë˜ê·¸ í•¸ë“¤
        const handle = document.createElement('span');
        handle.className = 'item-drag-handle';
        handle.innerHTML = 'â‹®â‹®';

        // ì»¨í…ì¸  ì˜ì—­
        const content = document.createElement('div');
        content.className = 'custom-text-content';
        content.style.cssText = 'flex: 1; display: flex; flex-direction: column; gap: 10px;';

        // í…ìŠ¤íŠ¸ ì…ë ¥
        const textInput = document.createElement('textarea');
        textInput.className = 'custom-text-input';
        textInput.value = item.text || '';
        textInput.placeholder = 'í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...';
        textInput.style.cssText = `
          width: 100%;
          padding: 12px;
          border: 1px solid #e5e8eb;
          border-radius: 6px;
          font-size: 14px;
          resize: vertical;
          min-height: 60px;
        `;
        textInput.oninput = (e) => {
          detailPageItems[index].text = e.target.value;
        };

        // ì˜µì…˜ ì»¨íŠ¸ë¡¤
        const controls = document.createElement('div');
        controls.style.cssText = 'display: flex; gap: 10px; align-items: center;';

        // ìƒ‰ìƒ ì„ íƒ
        const colorLabel = document.createElement('label');
        colorLabel.style.cssText = 'display: flex; align-items: center; gap: 6px; font-size: 12px; color: #666;';
        colorLabel.innerHTML = 'ğŸ¨ ìƒ‰ìƒ:';

        const colorInput = document.createElement('input');
        colorInput.type = 'color';
        colorInput.value = item.color || '#000000';
        colorInput.style.cssText = 'width: 40px; height: 30px; border: 1px solid #e5e8eb; border-radius: 4px; cursor: pointer;';
        colorInput.onchange = (e) => {
          detailPageItems[index].color = e.target.value;
        };
        colorLabel.appendChild(colorInput);

        // ì •ë ¬ ì„ íƒ
        const alignLabel = document.createElement('label');
        alignLabel.style.cssText = 'display: flex; align-items: center; gap: 6px; font-size: 12px; color: #666;';
        alignLabel.innerHTML = 'ğŸ“ ì •ë ¬:';

        const alignSelect = document.createElement('select');
        alignSelect.value = item.align || 'left';
        alignSelect.style.cssText = 'padding: 6px 10px; border: 1px solid #e5e8eb; border-radius: 4px; font-size: 12px;';
        alignSelect.innerHTML = `
          <option value="left" ${item.align === 'left' ? 'selected' : ''}>ì™¼ìª½</option>
          <option value="center" ${item.align === 'center' ? 'selected' : ''}>ê°€ìš´ë°</option>
          <option value="right" ${item.align === 'right' ? 'selected' : ''}>ì˜¤ë¥¸ìª½</option>
        `;
        alignSelect.onchange = (e) => {
          detailPageItems[index].align = e.target.value;
        };
        alignLabel.appendChild(alignSelect);

        // í°íŠ¸ ì„ íƒ
        const fontLabel = document.createElement('label');
        fontLabel.style.cssText = 'display: flex; align-items: center; gap: 6px; font-size: 12px; color: #666;';
        fontLabel.innerHTML = 'ğŸ”¤ í°íŠ¸:';

        const fontSelect = document.createElement('select');
        fontSelect.value = item.font || 'system-ui';
        fontSelect.style.cssText = 'padding: 6px 10px; border: 1px solid #e5e8eb; border-radius: 4px; font-size: 12px;';
        fontSelect.innerHTML = `
          <option value="system-ui" ${item.font === 'system-ui' ? 'selected' : ''}>ì‹œìŠ¤í…œ ê¸°ë³¸</option>
          <option value="'Noto Sans KR', sans-serif" ${item.font === "'Noto Sans KR', sans-serif" ? 'selected' : ''}>Noto Sans KR</option>
          <option value="'Nanum Gothic', sans-serif" ${item.font === "'Nanum Gothic', sans-serif" ? 'selected' : ''}>ë‚˜ëˆ”ê³ ë”•</option>
          <option value="Georgia, serif" ${item.font === 'Georgia, serif' ? 'selected' : ''}>Georgia</option>
          <option value="'Times New Roman', serif" ${item.font === "'Times New Roman', serif" ? 'selected' : ''}>Times New Roman</option>
          <option value="'Courier New', monospace" ${item.font === "'Courier New', monospace" ? 'selected' : ''}>Courier New</option>
        `;
        fontSelect.onchange = (e) => {
          detailPageItems[index].font = e.target.value;
        };
        fontLabel.appendChild(fontSelect);

        // íƒ€ì… í‘œì‹œ
        const typeLabel = document.createElement('div');
        typeLabel.style.cssText = 'margin-left: auto; font-size: 11px; color: #999; font-weight: 600;';
        const typeNames = {
          'title': 'íƒ€ì´í‹€',
          'subtitle': 'ì¤‘ê°„ íƒ€ì´í‹€',
          'paragraph': 'ì¼ë°˜ í…ìŠ¤íŠ¸'
        };
        typeLabel.textContent = typeNames[item.textType] || item.textType;

        controls.appendChild(colorLabel);
        controls.appendChild(alignLabel);
        controls.appendChild(fontLabel);
        controls.appendChild(typeLabel);

        content.appendChild(textInput);
        content.appendChild(controls);

        // ì‚­ì œ ë²„íŠ¼
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'item-action-btn delete';
        deleteBtn.innerHTML = 'ğŸ—‘';
        deleteBtn.title = 'ì‚­ì œ';
        deleteBtn.onclick = () => {
          detailPageItems.splice(index, 1);
          renderDetailCanvas();
        };

        div.appendChild(handle);
        div.appendChild(content);
        div.appendChild(deleteBtn);

        setupDragEvents(div, index);
        return div;
      }

      // ì¼ë°˜ ì•„ì´í…œ
      // ë“œë˜ê·¸ í•¸ë“¤
      const handle = document.createElement('span');
      handle.className = 'item-drag-handle';
      handle.innerHTML = 'â‹®â‹®';

      // ë¯¸ë¦¬ë³´ê¸° ([Image #1] í˜•ì‹)
      const preview = document.createElement('div');
      preview.className = 'item-preview';

      const placeholder = document.createElement('div');
      placeholder.className = 'item-preview-placeholder';

      if (item.type === 'brand-image' || item.type === 'image') {
        if (item.imageSrc) {
          // ì‹¤ì œ ì´ë¯¸ì§€ ì¸ë„¤ì¼ í‘œì‹œ
          placeholder.innerHTML = '<img src="' + item.imageSrc + '" style="width:100%;height:100%;object-fit:cover;border-radius:4px;">';
        } else {
          placeholder.textContent = '[Image #' + (index + 1) + ']';
        }
      } else if (item.type === 'title') {
        placeholder.innerHTML = 'ğŸ“<br>[Text #' + (index + 1) + ']';
      } else {
        placeholder.innerHTML = 'ğŸ“<br>[Text #' + (index + 1) + ']';
      }

      preview.appendChild(placeholder);

      // ì •ë³´
      const info = document.createElement('div');
      info.className = 'item-info';

      const type = document.createElement('div');
      type.className = 'item-type';

      if (item.type === 'brand-image') {
        type.textContent = 'ë¸Œëœë“œ ì´ë¯¸ì§€';
      } else if (item.type === 'title') {
        type.textContent = 'ì œí’ˆëª…';
      } else if (item.type === 'image') {
        type.textContent = 'ì¶”ê°€ ì´ë¯¸ì§€';
      } else {
        type.textContent = 'í…ìŠ¤íŠ¸';
      }

      const label = document.createElement('div');
      label.className = 'item-label';
      label.textContent = item.label || item.text || 'ë‚´ìš© ì—†ìŒ';

      info.appendChild(type);
      info.appendChild(label);

      // ì´ë¯¸ì§€ ë ˆì´ì•„ì›ƒ ì„ íƒ
      if (item.type === 'image') {
        // ë ˆì´ì•„ì›ƒ ìœ í˜• ì„ íƒ
        const layoutGroup = document.createElement('div');
        layoutGroup.style.cssText = 'margin-top: 10px; display: flex; flex-direction: column; gap: 8px;';

        const layoutLabel = document.createElement('label');
        layoutLabel.style.cssText = 'font-size: 12px; color: #666; font-weight: 600;';
        layoutLabel.textContent = 'ğŸ“ ë ˆì´ì•„ì›ƒ ìœ í˜•:';

        const layoutSelect = document.createElement('select');
        layoutSelect.value = item.layout || 'presentation';
        layoutSelect.style.cssText = 'padding: 6px 10px; border: 1px solid #e5e8eb; border-radius: 4px; font-size: 12px;';
        layoutSelect.innerHTML = `
          <option value="presentation" ${item.layout === 'presentation' ? 'selected' : ''}>ì—°ì¶œ ì´ë¯¸ì§€</option>
          <option value="image-with-text" ${item.layout === 'image-with-text' ? 'selected' : ''}>ì´ë¯¸ì§€ + í…ìŠ¤íŠ¸</option>
        `;
        layoutSelect.onchange = (e) => {
          detailPageItems[index].layout = e.target.value;
          // ê¸°ë³¸ê°’ ì„¤ì •
          if (e.target.value === 'presentation' && !detailPageItems[index].align) {
            detailPageItems[index].align = 'center';
          }
          if (e.target.value === 'image-with-text' && !detailPageItems[index].imageText) {
            detailPageItems[index].imageText = '';
          }
          renderDetailCanvas();
        };

        layoutGroup.appendChild(layoutLabel);
        layoutGroup.appendChild(layoutSelect);
        info.appendChild(layoutGroup);

        // ì—°ì¶œ ì´ë¯¸ì§€ì¼ ë•Œ: ì •ë ¬ ì„ íƒ
        if (item.layout === 'presentation' || !item.layout) {
          const alignGroup = document.createElement('div');
          alignGroup.style.cssText = 'margin-top: 8px; display: flex; flex-direction: column; gap: 6px;';

          const alignLabel = document.createElement('label');
          alignLabel.style.cssText = 'font-size: 12px; color: #666; font-weight: 600;';
          alignLabel.textContent = 'ğŸ“ ì´ë¯¸ì§€ ì •ë ¬:';

          const alignSelect = document.createElement('select');
          alignSelect.value = item.align || 'center';
          alignSelect.style.cssText = 'padding: 6px 10px; border: 1px solid #e5e8eb; border-radius: 4px; font-size: 12px;';
          alignSelect.innerHTML = `
            <option value="left" ${item.align === 'left' ? 'selected' : ''}>ì™¼ìª½</option>
            <option value="center" ${item.align === 'center' ? 'selected' : ''}>ê°€ìš´ë°</option>
            <option value="right" ${item.align === 'right' ? 'selected' : ''}>ì˜¤ë¥¸ìª½</option>
          `;
          alignSelect.onchange = (e) => {
            detailPageItems[index].align = e.target.value;
          };

          alignGroup.appendChild(alignLabel);
          alignGroup.appendChild(alignSelect);
          info.appendChild(alignGroup);
        }

        // ì´ë¯¸ì§€ + í…ìŠ¤íŠ¸ì¼ ë•Œ: í…ìŠ¤íŠ¸ ìœ„ì¹˜ ì„ íƒ
        if (item.layout === 'image-with-text') {
          // í…ìŠ¤íŠ¸ ìœ„ì¹˜ ì„ íƒ
          const positionGroup = document.createElement('div');
          positionGroup.style.cssText = 'margin-top: 8px; display: flex; flex-direction: column; gap: 6px;';

          const positionLabel = document.createElement('label');
          positionLabel.style.cssText = 'font-size: 12px; color: #666; font-weight: 600;';
          positionLabel.textContent = 'ğŸ“ í…ìŠ¤íŠ¸ ìœ„ì¹˜:';

          const positionSelect = document.createElement('select');
          positionSelect.value = item.textPosition || 'right';
          positionSelect.style.cssText = 'padding: 6px 10px; border: 1px solid #e5e8eb; border-radius: 4px; font-size: 12px;';
          positionSelect.innerHTML = `
            <option value="left" ${item.textPosition === 'left' ? 'selected' : ''}>ì™¼ìª½</option>
            <option value="right" ${item.textPosition === 'right' ? 'selected' : ''}>ì˜¤ë¥¸ìª½</option>
          `;
          positionSelect.onchange = (e) => {
            detailPageItems[index].textPosition = e.target.value;
          };

          positionGroup.appendChild(positionLabel);
          positionGroup.appendChild(positionSelect);
          info.appendChild(positionGroup);

          // í…ìŠ¤íŠ¸ ì…ë ¥
          const textGroup = document.createElement('div');
          textGroup.style.cssText = 'margin-top: 8px; display: flex; flex-direction: column; gap: 6px;';

          const textLabel = document.createElement('label');
          textLabel.style.cssText = 'font-size: 12px; color: #666; font-weight: 600;';
          textLabel.textContent = 'ğŸ“ í…ìŠ¤íŠ¸ ë‚´ìš©:';

          const textInput = document.createElement('textarea');
          textInput.value = item.imageText || '';
          textInput.placeholder = 'ì´ë¯¸ì§€ ì˜†ì— í‘œì‹œí•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...';
          textInput.style.cssText = 'padding: 8px 10px; border: 1px solid #e5e8eb; border-radius: 4px; font-size: 12px; resize: vertical; min-height: 60px;';
          textInput.oninput = (e) => {
            detailPageItems[index].imageText = e.target.value;
          };

          textGroup.appendChild(textLabel);
          textGroup.appendChild(textInput);
          info.appendChild(textGroup);
        }
      }

      // í…ìŠ¤íŠ¸ í‘œì‹œ/ì…ë ¥
      if (item.type === 'title' || item.type === 'text') {
        const textDisplay = document.createElement('div');
        textDisplay.className = 'item-text-display';
        textDisplay.textContent = item.text || '';
        textDisplay.contentEditable = true;
        textDisplay.onblur = (e) => {
          detailPageItems[index].text = e.target.textContent;
          detailPageItems[index].label = e.target.textContent;
        };
        info.appendChild(textDisplay);
      }

      // ì•¡ì…˜ ë²„íŠ¼ë“¤
      const actions = document.createElement('div');
      actions.className = 'item-actions';

      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'item-action-btn delete';
      deleteBtn.innerHTML = 'ğŸ—‘';
      deleteBtn.title = 'ì‚­ì œ';
      deleteBtn.onclick = () => {
        detailPageItems.splice(index, 1);
        renderDetailCanvas();
      };

      actions.appendChild(deleteBtn);

      // ì¡°í•©
      div.appendChild(handle);
      div.appendChild(preview);
      div.appendChild(info);
      div.appendChild(actions);

      setupDragEvents(div, index);
      return div;
    }

    // ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì„¤ì •
    function setupDragEvents(div, index) {
      div.addEventListener('dragstart', (e) => {
        draggedItem = index;
        div.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
      });

      div.addEventListener('dragend', () => {
        div.classList.remove('dragging');
        draggedItem = null;
      });

      div.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        div.classList.add('drag-over');
      });

      div.addEventListener('dragleave', () => {
        div.classList.remove('drag-over');
      });

      div.addEventListener('drop', (e) => {
        e.preventDefault();
        div.classList.remove('drag-over');

        if (draggedItem !== null && draggedItem !== index) {
          // ìˆœì„œ ë³€ê²½
          const item = detailPageItems.splice(draggedItem, 1)[0];
          detailPageItems.splice(index, 0, item);
          renderDetailCanvas();
        }
      });
    }

    // ìƒì„¸í˜ì´ì§€ ì•„ì´í…œ ì¶”ê°€
    function addDetailPageItem(item) {
      detailPageItems.push(item);
      renderDetailCanvas();
    }

    // í…ìŠ¤íŠ¸ ë¸”ë¡ ì¶”ê°€
    function addTextBlock() {
      addDetailPageItem({
        type: 'text',
        text: '',
        label: 'í…ìŠ¤íŠ¸ ë¸”ë¡'
      });
    }

    // ì»¤ìŠ¤í…€ í…ìŠ¤íŠ¸ ë¸”ë¡ ì¶”ê°€ (í¬ê¸°ë³„)
    function addCustomTextBlock(textType) {
      const labels = {
        'title': 'íƒ€ì´í‹€',
        'subtitle': 'ì¤‘ê°„ íƒ€ì´í‹€',
        'paragraph': 'ì¼ë°˜ í…ìŠ¤íŠ¸'
      };

      addDetailPageItem({
        type: 'custom-text',
        textType: textType,
        text: '',
        color: '#000000',
        align: 'left',
        font: 'system-ui',
        label: labels[textType]
      });

      showAlert(`${labels[textType]}ì´(ê°€) ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }

    // í’ˆì§ˆí‘œì‹œì‚¬í•­ ì¶”ê°€
    function addQualityTable() {
      const productTitle = productData.title || productData.titleCn || 'ì œí’ˆëª…';
      addDetailPageItem({
        type: 'quality-table',
        title: 'í’ˆì§ˆí‘œì‹œì‚¬í•­',
        rows: [
          { label: 'ìƒí’ˆëª…', value: productTitle },
          { label: 'ì†Œì¬', value: 'ë©´ 100%' },
          { label: 'ìƒ‰ìƒ', value: 'ìƒì„¸í˜ì´ì§€ ì°¸ì¡°' },
          { label: 'ì¹˜ìˆ˜', value: 'ìƒì„¸í˜ì´ì§€ ì°¸ì¡°' },
          { label: 'ì œì¡°êµ­', value: 'Made in China' },
          { label: 'ì œì¡°ì‚¬', value: 'ë¸Œëœë“œëª…' },
          { label: 'ì„¸íƒë°©ë²• ë° ì·¨ê¸‰ì‹œ ì£¼ì˜ì‚¬í•­', value: 'ìƒì„¸í˜ì´ì§€ ì°¸ì¡°' },
          { label: 'ì œì¡°ì—°ì›”', value: 'ìˆ˜ì… ì‹œ í†µê´€ì¼ìë¡œ ê°ˆìŒ' },
          { label: 'í’ˆì§ˆë³´ì¦ê¸°ì¤€', value: 'ê´€ë ¨ë²• ë° ì†Œë¹„ì ë¶„ìŸí•´ê²° ê·œì •ì— ë”°ë¦„' },
          { label: 'A/S ì±…ì„ìì™€ ì „í™”ë²ˆí˜¸', value: 'ìƒí˜¸ëª… / ì „í™”ë²ˆí˜¸' }
        ]
      });
    }

    // ìë™ êµ¬ì„±
    function autoGenerateDetailPage() {
      detailPageItems = [];
      let imageCounter = 1;

      // 1. ë¸Œëœë“œ ì´ë¯¸ì§€ (ëŒ€í‘œ ì´ë¯¸ì§€)
      if (productData.mainImage) {
        detailPageItems.push({
          type: 'brand-image',
          imageSrc: productData.mainImage,
          label: 'ë¸Œëœë“œ ì´ë¯¸ì§€',
          imageNumber: imageCounter++
        });
      }

      // 2. ì œí’ˆëª… (íƒ€ì´í‹€)
      const productTitle = productData.title || productData.titleCn || 'ì œí’ˆëª…';
      detailPageItems.push({
        type: 'title',
        text: productTitle,
        label: productTitle
      });

      // 3. ì¶”ê°€ ì´ë¯¸ì§€ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í¬í•¨ ì•ˆí•¨ (ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€)

      // 4. ì˜µì…˜ ë¸”ë¡ë“¤ - ì˜µì…˜1ë³„ë¡œ ê·¸ë£¹í•‘
      const option1Groups = new Map();

      if (productData.results && productData.results.length > 0) {
        productData.results.forEach(option => {
          const opt1 = option.optionName1 || option.optionName1Cn || 'ì˜µì…˜1';
          const opt2 = option.optionName2 || option.optionName2Cn || '';
          const img = option.imageLink || option.titleImage?.[0] || '';

          if (!option1Groups.has(opt1)) {
            option1Groups.set(opt1, {
              image: img,
              imageSrc: img,
              optionName: opt1,
              option2List: []
            });
          }

          if (opt2) {
            option1Groups.get(opt1).option2List.push(opt2);
          }
        });

        // ì˜µì…˜ ë¸”ë¡ ì¶”ê°€
        option1Groups.forEach((group, opt1) => {
          // ì˜µì…˜2 ì¤‘ë³µ ì œê±°
          const uniqueOption2 = [...new Set(group.option2List)];
          const option2Text = uniqueOption2.length > 0
            ? uniqueOption2.join(', ')
            : 'ì˜µì…˜2 ì—†ìŒ';

          detailPageItems.push({
            type: 'option-block',
            imageSrc: group.imageSrc,
            imageLabel: '[Image #' + imageCounter++ + ']',
            optionName: group.optionName,
            option2List: option2Text,
            template: selectedOptionTemplate
          });
        });
      }

      // 5. í’ˆì§ˆí‘œì‹œì‚¬í•­ ì¶”ê°€
      detailPageItems.push({
        type: 'quality-table',
        title: 'í’ˆì§ˆí‘œì‹œì‚¬í•­',
        rows: [
          { label: 'ìƒí’ˆëª…', value: productTitle },
          { label: 'ì†Œì¬', value: 'ë©´ 100%' },
          { label: 'ìƒ‰ìƒ', value: 'ìƒì„¸í˜ì´ì§€ ì°¸ì¡°' },
          { label: 'ì¹˜ìˆ˜', value: 'ìƒì„¸í˜ì´ì§€ ì°¸ì¡°' },
          { label: 'ì œì¡°êµ­', value: 'Made in China' },
          { label: 'ì œì¡°ì‚¬', value: 'ë¸Œëœë“œëª…' },
          { label: 'ì„¸íƒë°©ë²• ë°<br>ì·¨ê¸‰ì‹œ ì£¼ì˜ì‚¬í•­', value: 'ìƒì„¸í˜ì´ì§€ ì°¸ì¡°' },
          { label: 'ì œì¡°ì—°ì›”', value: 'ìˆ˜ì… ì‹œ í†µê´€ì¼ìë¡œ ê°ˆìŒ' },
          { label: 'í’ˆì§ˆë³´ì¦ê¸°ì¤€', value: 'ê´€ë ¨ë²• ë° ì†Œë¹„ì ë¶„ìŸí•´ê²° ê·œì •ì— ë”°ë¦„' },
          { label: 'A/S ì±…ì„ìì™€<br>ì „í™”ë²ˆí˜¸', value: 'ìƒí˜¸ëª… / ì „í™”ë²ˆí˜¸' }
        ]
      });

      renderDetailCanvas();
    }

    // ì˜µì…˜ í…œí”Œë¦¿ ì„ íƒ
    function selectOptionTemplate(template) {
      selectedOptionTemplate = template;

      // ëª¨ë“  í…œí”Œë¦¿ ì•„ì´í…œì—ì„œ active í´ë˜ìŠ¤ ì œê±°
      document.querySelectorAll('.template-item').forEach(item => {
        item.classList.remove('active');
      });

      // ì„ íƒëœ í…œí”Œë¦¿ì— active í´ë˜ìŠ¤ ì¶”ê°€
      document.querySelector(`[data-template="${template}"]`).classList.add('active');

      // ëª¨ë“  ê¸°ì¡´ ì˜µì…˜ ë¸”ë¡ì˜ í…œí”Œë¦¿ë„ ë³€ê²½
      detailPageItems.forEach((item, index) => {
        if (item.type === 'option-block') {
          item.template = template;
        }
      });

      // í™”ë©´ ë‹¤ì‹œ ë Œë”ë§
      renderDetailCanvas();

      console.log('âœ… í…œí”Œë¦¿ ì„ íƒë¨:', template, '- ëª¨ë“  ì˜µì…˜ ë¸”ë¡ì— ì ìš©');
      showAlert(`ëª¨ë“  ì˜µì…˜ ë¸”ë¡ì´ ${template} í…œí”Œë¦¿ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }

    // ì´ˆê¸°í™” (ìë™ êµ¬ì„±ìœ¼ë¡œ ë¦¬ì…‹)
    function resetDetailPage() {
      if (confirm('ìƒì„¸í˜ì´ì§€ë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        autoGenerateDetailPage();
        showAlert('ìƒì„¸í˜ì´ì§€ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
      }
    }

    // ë¯¸ë¦¬ë³´ê¸°
    function previewDetailPage() {
      console.log('ë¯¸ë¦¬ë³´ê¸° ì‹œì‘, detailPageItems:', JSON.parse(JSON.stringify(detailPageItems)));
      const previewContent = document.getElementById('detailPreviewContent');
      previewContent.innerHTML = '';

      if (detailPageItems.length === 0) {
        previewContent.innerHTML = '<p style="text-align: center; padding: 60px; color: #888;">ìƒì„¸í˜ì´ì§€ì— ì¶”ê°€ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
      } else {
        detailPageItems.forEach(item => {
          // ë¸Œëœë“œ ì´ë¯¸ì§€
          if (item.type === 'brand-image') {
            const img = document.createElement('img');
            img.src = item.imageSrc;
            img.style.marginBottom = '0';
            previewContent.appendChild(img);
          }
          // ì œí’ˆëª… (íƒ€ì´í‹€)
          else if (item.type === 'title') {
            const titleDiv = document.createElement('div');
            titleDiv.className = 'detail-preview-text';
            titleDiv.style.fontSize = '24px';
            titleDiv.style.fontWeight = '700';
            titleDiv.style.textAlign = 'center';
            titleDiv.style.padding = '30px 20px';
            titleDiv.textContent = item.text || 'ì œí’ˆëª…';
            previewContent.appendChild(titleDiv);
          }
          // ì¶”ê°€ ì´ë¯¸ì§€
          else if (item.type === 'image') {
            const layout = item.layout || 'presentation';

            if (layout === 'presentation') {
              // ì—°ì¶œ ì´ë¯¸ì§€ - ì •ë ¬ì— ë”°ë¼ í‘œì‹œ
              const imageContainer = document.createElement('div');
              const align = item.align || 'center';

              imageContainer.style.cssText = `
                display: flex;
                justify-content: ${align === 'left' ? 'flex-start' : align === 'right' ? 'flex-end' : 'center'};
                margin: 20px 0;
                padding: 0 20px;
              `;

              const img = document.createElement('img');
              img.src = item.imageSrc;

              // ê°€ìš´ë° ì •ë ¬ì€ 100%, ì™¼ìª½/ì˜¤ë¥¸ìª½ì€ 50%ë¡œ ì‘ê²Œ
              if (align === 'center') {
                img.style.cssText = `
                  max-width: 100%;
                  height: auto;
                  border-radius: 8px;
                  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                `;
              } else {
                img.style.cssText = `
                  max-width: 50%;
                  height: auto;
                  border-radius: 8px;
                  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                `;
              }

              imageContainer.appendChild(img);
              previewContent.appendChild(imageContainer);
            } else if (layout === 'image-with-text') {
              // ì´ë¯¸ì§€ + í…ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ - ì‹¬í”Œí•˜ê²Œ
              const textPosition = item.textPosition || 'right';

              const container = document.createElement('div');
              container.style.cssText = `
                display: flex;
                align-items: center;
                gap: 40px;
                padding: 0 20px;
                margin: 20px 0;
              `;

              // ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ
              const imgContainer = document.createElement('div');
              imgContainer.style.cssText = `
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
              `;

              const img = document.createElement('img');
              img.src = item.imageSrc;
              img.style.cssText = `
                max-width: 100%;
                height: auto;
                border-radius: 8px;
              `;
              imgContainer.appendChild(img);

              // í…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ
              const textContainer = document.createElement('div');
              textContainer.style.cssText = `
                flex: 1;
                display: flex;
                align-items: center;
              `;

              const text = document.createElement('div');
              text.style.cssText = `
                font-size: 18px;
                line-height: 1.8;
                color: #333;
                white-space: pre-wrap;
                width: 100%;
              `;
              text.textContent = item.imageText || 'í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...';
              textContainer.appendChild(text);

              // í…ìŠ¤íŠ¸ ìœ„ì¹˜ì— ë”°ë¼ ìˆœì„œ ê²°ì •
              if (textPosition === 'left') {
                container.appendChild(textContainer);
                container.appendChild(imgContainer);
              } else {
                container.appendChild(imgContainer);
                container.appendChild(textContainer);
              }

              previewContent.appendChild(container);
            }
          }
          // ì˜µì…˜ ë¸”ë¡
          else if (item.type === 'option-block') {
            const template = item.template || selectedOptionTemplate;
            console.log('ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§:', { optionName: item.optionName, template, itemTemplate: item.template, selectedOptionTemplate });
            const optionBlock = document.createElement('div');

            // í…œí”Œë¦¿ë³„ ìŠ¤íƒ€ì¼ ì ìš©
            if (template === 'horizontal') {
              // ê°€ë¡œí˜• (ë¯¸ë‹ˆë©€)
              optionBlock.style.cssText = `
                display: flex;
                align-items: center;
                gap: 16px;
                padding: 20px;
                margin: 10px 0;
                background: white;
                border: 1px solid #e5e8eb;
                border-radius: 6px;
              `;
            } else if (template === 'horizontal-reverse') {
              // ê°€ë¡œí˜• ë°˜ì „ (ì´ë¯¸ì§€ ì˜¤ë¥¸ìª½)
              optionBlock.style.cssText = `
                display: flex;
                flex-direction: row-reverse;
                align-items: center;
                gap: 16px;
                padding: 20px;
                margin: 10px 0;
                background: white;
                border: 1px solid #e5e8eb;
                border-radius: 6px;
              `;
            } else if (template === 'vertical') {
              // ì„¸ë¡œí˜•
              optionBlock.style.cssText = `
                display: flex;
                flex-direction: column;
                gap: 16px;
                padding: 20px;
                margin: 10px 0;
                background: white;
                border: 1px solid #e5e8eb;
                border-radius: 8px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
              `;
            } else if (template === 'card') {
              // ì¹´ë“œí˜•
              optionBlock.style.cssText = `
                display: flex;
                flex-direction: column;
                gap: 16px;
                padding: 24px;
                margin: 10px 0;
                background: white;
                border: 2px solid #e5e8eb;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
              `;
            } else if (template === 'centered') {
              // ì¤‘ì•™ ì •ë ¬í˜•
              optionBlock.style.cssText = `
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                gap: 20px;
                padding: 30px;
                margin: 10px 0;
                background: white;
                border: 1px solid #e5e8eb;
                border-radius: 10px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
              `;
            } else if (template === 'split') {
              // 50/50 ë¶„í• í˜•
              optionBlock.style.cssText = `
                display: flex;
                align-items: stretch;
                gap: 0;
                margin: 10px 0;
                background: white;
                border: 1px solid #e5e8eb;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
              `;
            } else if (template === 'modern') {
              // ëª¨ë˜í˜• (ë³´ë¼ ê·¸ë¼ë°ì´ì…˜)
              optionBlock.style.cssText = `
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 24px;
                margin: 10px 0;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
              `;
            } else if (template === 'neon') {
              // ë„¤ì˜¨ (í•‘í¬/ì‚¬ì´ì–¸)
              optionBlock.style.cssText = `
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 24px;
                margin: 10px 0;
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(240, 147, 251, 0.4);
              `;
            } else if (template === 'sunset') {
              // ì¼ëª° (ì˜¤ë Œì§€/í•‘í¬)
              optionBlock.style.cssText = `
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 24px;
                margin: 10px 0;
                background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(250, 112, 154, 0.3);
              `;
            } else if (template === 'ocean') {
              // ë°”ë‹¤ (íŒŒë‘/ì²­ë¡)
              optionBlock.style.cssText = `
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 24px;
                margin: 10px 0;
                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(79, 172, 254, 0.3);
              `;
            } else if (template === 'mint') {
              // ë¯¼íŠ¸ (ë¯¼íŠ¸/ì—°ë‘)
              optionBlock.style.cssText = `
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 24px;
                margin: 10px 0;
                background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(67, 233, 123, 0.3);
              `;
            } else if (template === 'dark') {
              // ë‹¤í¬ëª¨ë“œ
              optionBlock.style.cssText = `
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 24px;
                margin: 10px 0;
                background: #1a1a1a;
                border: 1px solid #333;
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
              `;
            } else if (template === 'neon-border') {
              // ë„¤ì˜¨ í…Œë‘ë¦¬
              optionBlock.style.cssText = `
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 24px;
                margin: 10px 0;
                background: white;
                border: 3px solid;
                border-image: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) 1;
                border-radius: 0;
                box-shadow: 0 0 20px rgba(240, 147, 251, 0.3);
              `;
            } else if (template === 'badge') {
              // ë°°ì§€ ìŠ¤íƒ€ì¼
              optionBlock.style.cssText = `
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 20px 24px;
                margin: 10px 0;
                background: white;
                border: 2px dashed #1e90ff;
                border-radius: 20px;
                position: relative;
              `;
            } else if (template === 'diagonal') {
              // ëŒ€ê°ì„  ë¶„í• 
              optionBlock.style.cssText = `
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 24px;
                margin: 10px 0;
                background: linear-gradient(45deg, #f8f9fa 50%, white 50%);
                border: 1px solid #e5e8eb;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
              `;
            } else if (template === 'overlay') {
              // ì˜¤ë²„ë ˆì´ (ì´ë¯¸ì§€ ìœ„ì— í…ìŠ¤íŠ¸)
              optionBlock.style.cssText = `
                position: relative;
                margin: 10px 0;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
              `;
            } else {
              // gradient (ê¸°ë³¸)
              optionBlock.style.cssText = `
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 24px;
                margin: 10px 0;
                background: linear-gradient(to right, #f8f9fa, #ffffff);
                border: 1px solid #e5e8eb;
                border-left: 4px solid #1e90ff;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
              `;
            }

            // ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ
            if (item.imageSrc) {
              const imgContainer = document.createElement('div');

              if (template === 'vertical' || template === 'card' || template === 'centered') {
                imgContainer.style.cssText = `
                  width: 100%;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  background: ${template === 'centered' ? '#fafbfc' : '#f8f9fa'};
                  border-radius: 8px;
                  overflow: hidden;
                  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                  min-height: 300px;
                  padding: 10px;
                `;
              } else if (template === 'split') {
                imgContainer.style.cssText = `
                  flex: 1;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  background: #f8f9fa;
                  padding: 30px;
                  min-height: 300px;
                `;
              } else if (template === 'overlay') {
                imgContainer.style.cssText = `
                  width: 100%;
                  position: relative;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  min-height: 400px;
                  background: #f8f9fa;
                `;
              } else if (template === 'modern' || template === 'neon' || template === 'sunset' || template === 'ocean' || template === 'mint') {
                imgContainer.style.cssText = `
                  flex-shrink: 0;
                  width: 220px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  background: rgba(255, 255, 255, 0.95);
                  border-radius: 12px;
                  overflow: hidden;
                  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
                  min-height: 220px;
                  padding: 15px;
                `;
              } else if (template === 'dark') {
                imgContainer.style.cssText = `
                  flex-shrink: 0;
                  width: 220px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  background: #2a2a2a;
                  border-radius: 12px;
                  overflow: hidden;
                  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
                  min-height: 220px;
                  padding: 15px;
                `;
              } else {
                imgContainer.style.cssText = `
                  flex-shrink: 0;
                  width: 200px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  background: #f8f9fa;
                  border-radius: 8px;
                  overflow: hidden;
                  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
                  min-height: 200px;
                  padding: 10px;
                `;
              }

              const img = document.createElement('img');
              img.src = item.imageSrc;
              if (template === 'overlay') {
                img.style.cssText = `
                  max-width: 100%;
                  max-height: 100%;
                  width: auto;
                  height: auto;
                  object-fit: contain;
                `;
              } else {
                img.style.cssText = `
                  max-width: 100%;
                  max-height: 100%;
                  width: auto;
                  height: auto;
                  object-fit: contain;
                `;
              }
              imgContainer.appendChild(img);
              optionBlock.appendChild(imgContainer);
            }

            // í…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ
            const textContainer = document.createElement('div');
            const isColorTemplate = ['modern', 'neon', 'sunset', 'ocean', 'mint', 'dark'].includes(template);

            if (template === 'split') {
              textContainer.style.cssText = `
                flex: 1;
                display: flex;
                flex-direction: column;
                justify-content: center;
                gap: 16px;
                padding: 30px;
                background: white;
              `;
            } else if (template === 'overlay') {
              textContainer.style.cssText = `
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                padding: 30px;
                background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
                z-index: 10;
              `;
            } else {
              textContainer.style.cssText = `
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 12px;
              `;
            }

            const optionTitle = document.createElement('div');
            if (isColorTemplate || template === 'overlay') {
              optionTitle.style.cssText = `
                font-size: 24px;
                font-weight: 700;
                color: white;
                line-height: 1.4;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
              `;
            } else {
              optionTitle.style.cssText = `
                font-size: 22px;
                font-weight: 700;
                color: #1a1a1a;
                line-height: 1.4;
              `;
            }
            optionTitle.textContent = item.optionName || 'ì˜µì…˜ëª…';

            const optionSubtitle = document.createElement('div');
            if (isColorTemplate) {
              optionSubtitle.style.cssText = `
                font-size: 15px;
                color: rgba(255, 255, 255, 0.95);
                line-height: 1.8;
                padding: 12px 16px;
                background: rgba(255, 255, 255, 0.15);
                border-radius: 8px;
                border: 1px solid rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(10px);
              `;
            } else if (template === 'overlay') {
              optionSubtitle.style.cssText = `
                font-size: 15px;
                color: rgba(255, 255, 255, 0.9);
                line-height: 1.8;
                padding: 12px 16px;
                background: rgba(0, 0, 0, 0.3);
                border-radius: 8px;
                backdrop-filter: blur(5px);
              `;
            } else if (template === 'split') {
              optionSubtitle.style.cssText = `
                font-size: 15px;
                color: #666;
                line-height: 1.8;
                padding: 16px;
                background: #f8f9fa;
                border-radius: 6px;
                border: none;
              `;
            } else {
              optionSubtitle.style.cssText = `
                font-size: 15px;
                color: #666;
                line-height: 1.8;
                padding: 12px 16px;
                background: ${template === 'card' ? '#f8f9fa' : 'white'};
                border-radius: 6px;
                border: 1px solid #e5e8eb;
              `;
            }
            optionSubtitle.textContent = item.option2List || '';

            textContainer.appendChild(optionTitle);
            textContainer.appendChild(optionSubtitle);
            optionBlock.appendChild(textContainer);

            previewContent.appendChild(optionBlock);
          }
          // í’ˆì§ˆí‘œì‹œì‚¬í•­
          else if (item.type === 'quality-table') {
            const qualityTable = document.createElement('div');
            qualityTable.style.cssText = `
              margin: 20px 0;
              background: white;
              border: 2px solid #e5e8eb;
              border-radius: 12px;
              overflow: hidden;
            `;

            const tableTitle = document.createElement('div');
            tableTitle.style.cssText = `
              font-size: 20px;
              font-weight: 700;
              color: #333;
              padding: 20px 24px;
              background: #f8f9fa;
              border-bottom: 2px solid #e5e8eb;
              text-align: center;
            `;
            tableTitle.textContent = item.title || 'í’ˆì§ˆí‘œì‹œì‚¬í•­';
            qualityTable.appendChild(tableTitle);

            if (item.rows && item.rows.length > 0) {
              item.rows.forEach((row, idx) => {
                const rowDiv = document.createElement('div');
                rowDiv.style.cssText = `
                  display: grid;
                  grid-template-columns: 200px 1fr;
                  border-bottom: ${idx === item.rows.length - 1 ? 'none' : '1px solid #e5e8eb'};
                `;

                const label = document.createElement('div');
                label.style.cssText = `
                  padding: 14px 20px;
                  background: #fafbfc;
                  font-weight: 600;
                  font-size: 14px;
                  color: #555;
                  border-right: 1px solid #e5e8eb;
                `;
                label.textContent = row.label || '';

                const value = document.createElement('div');
                value.style.cssText = `
                  padding: 14px 20px;
                  font-size: 14px;
                  color: #333;
                  background: white;
                `;
                value.textContent = row.value || '';

                rowDiv.appendChild(label);
                rowDiv.appendChild(value);
                qualityTable.appendChild(rowDiv);
              });
            }

            previewContent.appendChild(qualityTable);
          }
          // ì¼ë°˜ í…ìŠ¤íŠ¸
          else if (item.type === 'text' && item.text) {
            const textDiv = document.createElement('div');
            textDiv.className = 'detail-preview-text';
            textDiv.textContent = item.text;
            previewContent.appendChild(textDiv);
          }
          // ì»¤ìŠ¤í…€ í…ìŠ¤íŠ¸ (ìƒ‰ìƒ + ì •ë ¬ + í¬ê¸°)
          else if (item.type === 'custom-text' && item.text) {
            const textDiv = document.createElement('div');
            textDiv.className = 'detail-preview-custom-text';

            // í¬ê¸°ë³„ ìŠ¤íƒ€ì¼
            const fontSizes = {
              'title': '32px',
              'subtitle': '24px',
              'paragraph': '16px'
            };

            const fontWeights = {
              'title': '700',
              'subtitle': '600',
              'paragraph': '400'
            };

            const margins = {
              'title': '30px 0',
              'subtitle': '20px 0',
              'paragraph': '15px 0'
            };

            textDiv.style.cssText = `
              font-size: ${fontSizes[item.textType] || '16px'};
              font-weight: ${fontWeights[item.textType] || '400'};
              font-family: ${item.font || 'system-ui'};
              color: ${item.color || '#000000'};
              text-align: ${item.align || 'left'};
              margin: ${margins[item.textType] || '15px 0'};
              padding: 0 20px;
              line-height: 1.6;
              white-space: pre-wrap;
            `;
            textDiv.textContent = item.text;
            previewContent.appendChild(textDiv);
          }
        });
      }

      document.getElementById('detailPreviewModal').classList.add('active');
    }

    // ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸°
    function closeDetailPreview() {
      document.getElementById('detailPreviewModal').classList.remove('active');
    }

    // ì˜µì…˜ ë Œë”ë§
    function renderOptions() {
      const tbody = document.getElementById('optionsTableBody');
      tbody.innerHTML = '';

      if (!productData.results || productData.results.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #888;">ì˜µì…˜ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }

      console.log('[Editor Debug] ì˜µì…˜ ë Œë”ë§ ì‹œì‘, ì´', productData.results.length, 'ê°œ');
      if (productData.results.length > 0) {
        console.log('[Editor Debug] ì²« ë²ˆì§¸ ì˜µì…˜ ë°ì´í„°:', productData.results[0]);
      }

      productData.results.forEach((option, index) => {
        const row = tbody.insertRow();

        const imgSrc = option.imageLink || option.titleImage?.[0] || '';
        const imgHtml = imgSrc
          ? `<img src="${imgSrc}" class="option-image-preview" onclick="openMagicBrush('${imgSrc}')" onerror="this.parentElement.innerHTML='<div class=\\'no-image\\'>ğŸ“·</div>'">`
          : '<div class="no-image">ğŸ“·</div>';

        // ì‚¬ìš©ì ì •ì˜ ê°€ê²©ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ìë™ ê³„ì‚°
        const priceCNY = parseFloat(option.price) || 0;

        if (index === 0) {
          console.log('[Editor Debug] ì²« ë²ˆì§¸ ì˜µì…˜ ê°€ê²©:', {
            rawPrice: option.price,
            priceCNY,
            optionName1: option.optionName1,
            optionName2: option.optionName2
          });
        }

        const autoPrices = calculatePricesWithMargins(priceCNY);

        const costKRW = option.costKRW || autoPrices.costKRW;
        const supplyPrice = option.supplyPrice || autoPrices.supplyPrice;
        const sellPrice = option.sellPrice || autoPrices.sellPrice;

        // ìë™ ê³„ì‚°ëœ ê°’ë„ ì˜µì…˜ì— ì €ì¥ (ê²¬ì ì„œ ì‘ì„±ì‹œ ì‚¬ìš©)
        option.costKRW = costKRW;
        option.supplyPrice = supplyPrice;
        option.sellPrice = sellPrice;

        // ë§ˆì§„ ê³„ì‚°
        const supplyMargin = supplyPrice - costKRW;
        const supplyMarginPercent = costKRW > 0 ? ((supplyMargin / costKRW) * 100).toFixed(1) : 0;
        const saleMargin = sellPrice - supplyPrice;
        const saleMarginPercent = supplyPrice > 0 ? ((saleMargin / supplyPrice) * 100).toFixed(1) : 0;

        // ë§ˆì§„ ìƒ‰ìƒ ê²°ì •
        const supplyMarginClass = supplyMargin > 0 ? 'profit-positive' : 'profit-warning';
        const saleMarginClass = saleMargin >= settings.minMargin ? 'profit-positive' : 'profit-warning';

        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${imgHtml}</td>
          <td><input type="text" value="${option.optionName1 || ''}" onchange="updateOption(${index}, 'optionName1', this.value)"></td>
          <td><input type="text" value="${option.optionName2 || ''}" onchange="updateOption(${index}, 'optionName2', this.value)"></td>
          <td>
            <div class="price-cell">
              <input type="number" class="price-input" value="${costKRW}" readonly style="background: #f5f5f5; cursor: not-allowed;">
              <div class="price-sub">(${priceCNY.toLocaleString()} CNY)</div>
            </div>
          </td>
          <td>
            <div class="price-cell">
              <input type="number" class="price-input" value="${supplyPrice}" onchange="updateSupplyPrice(${index}, this.value)" step="1">
              <div class="price-sub ${supplyMarginClass}">
                ë§ˆì§„: ${supplyMargin.toLocaleString()}ì› (${supplyMarginPercent}%)
              </div>
            </div>
          </td>
          <td>
            <div class="price-cell">
              <input type="number" class="price-input" value="${sellPrice}" onchange="updateSellPrice(${index}, this.value)" step="1">
              <div class="price-sub ${saleMarginClass}">
                ë§ˆì§„: ${saleMargin.toLocaleString()}ì› (${saleMarginPercent}%)
              </div>
            </div>
          </td>
        `;
      });
    }

    // ê³µê¸‰ê°€ ì—…ë°ì´íŠ¸
    function updateSupplyPrice(index, value) {
      const supplyPrice = parseFloat(value) || 0;
      productData.results[index].supplyPrice = supplyPrice;

      // íŒë§¤ê°€ê°€ ì‚¬ìš©ì ì •ì˜ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ìë™ ê³„ì‚°
      if (!productData.results[index].sellPrice) {
        const priceCNY = productData.results[index].price || 0;
        const autoPrices = calculatePricesWithMargins(priceCNY);
        productData.results[index].sellPrice = autoPrices.sellPrice;
      }

      renderOptions();
    }

    // íŒë§¤ê°€ ì—…ë°ì´íŠ¸
    function updateSellPrice(index, value) {
      const sellPrice = parseFloat(value) || 0;
      productData.results[index].sellPrice = sellPrice;
      renderOptions();
    }

    // ê°€ê²© ê³„ì‚° í•¨ìˆ˜ (ë§ˆì§„% í¬í•¨)
    function calculatePricesWithMargins(priceCNY) {
      // 1. ì›í™” ì›ê°€
      const costKRW = priceCNY * settings.exchangeRate;

      // 2. ê³µê¸‰ ë§ˆì§„% ì„ íƒ (ì„¤ì •ì—ì„œ ê°€ì ¸ì˜´)
      let supplyMarginPercent = 30; // ê¸°ë³¸ê°’
      for (const rule of settings.supplyMargins) {
        if (costKRW < rule.amount) {
          supplyMarginPercent = rule.percent;
          break;
        }
      }

      // 3. ê³µê¸‰ê°€ = (ì›í™” ì›ê°€ / (1 - ê³µê¸‰ë§ˆì§„%)) + í¬ì¥ë¹„
      const supplyPrice = (costKRW / (1 - supplyMarginPercent / 100)) + settings.packagingCost;

      // 4. íŒë§¤ ë§ˆì§„% ì„ íƒ (ì„¤ì •ì—ì„œ ê°€ì ¸ì˜´)
      let saleMarginPercent = 15; // ê¸°ë³¸ê°’
      for (const rule of settings.saleMargins) {
        if (supplyPrice < rule.amount) {
          saleMarginPercent = rule.percent;
          break;
        }
      }

      // 5. íŒë§¤ê°€ = ê³µê¸‰ê°€ / (1 - íŒë§¤ë§ˆì§„%)
      let sellPrice = supplyPrice / (1 - saleMarginPercent / 100);

      // 6. ìµœì†Œ ë§ˆì§„ ë³´ì¥
      const margin = sellPrice - supplyPrice;
      if (margin < settings.minMargin) {
        sellPrice = supplyPrice + settings.minMargin;
      }

      return {
        costKRW: Math.round(costKRW),
        supplyPrice: Math.round(supplyPrice),
        sellPrice: Math.round(sellPrice),
        margin: Math.round(sellPrice - supplyPrice),
        supplyMarginPercent: supplyMarginPercent,
        saleMarginPercent: saleMarginPercent
      };
    }

    // ê°€ê²© ê³„ì‚° í•¨ìˆ˜ (ë§ˆì§„% ë¯¸í¬í•¨ - í•˜ìœ„ í˜¸í™˜ìš©)
    function calculatePrices(priceCNY) {
      const result = calculatePricesWithMargins(priceCNY);
      return {
        costKRW: result.costKRW,
        supplyPrice: result.supplyPrice,
        sellPrice: result.sellPrice,
        margin: result.margin
      };
    }

    // ê°€ê²© ì—…ë°ì´íŠ¸
    function updatePrice(index, value) {
      productData.results[index].price = parseFloat(value) || 0;
      renderOptions();
    }

    // ì˜µì…˜ ì—…ë°ì´íŠ¸
    function updateOption(index, field, value) {
      productData.results[index][field] = value;
    }

    // íƒ­ ì „í™˜
    function switchEditTab(tabName) {
      // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
      document.querySelectorAll('.edit-tab').forEach(btn => btn.classList.remove('active'));
      // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
      document.querySelectorAll('.edit-tab-content').forEach(content => content.classList.remove('active'));

      // ì„ íƒí•œ íƒ­ í™œì„±í™”
      event.target.classList.add('active');
      document.getElementById(`${tabName}-tab`).classList.add('active');
    }

    // ì¼ê´„ ì¹˜í™˜
    function bulkReplace() {
      const targetOption = document.getElementById('replaceTargetOption').value;
      const find = document.getElementById('findText').value;
      const replace = document.getElementById('replaceText').value;

      // ë¹ˆ ê°’ ì°¾ê¸° í—ˆìš©
      // if (find === '') {
      //   alert('ì°¾ì„ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
      //   return;
      // }

      let count = 0;

      if (find === '') {
        // ë¹ˆ ê°’ì„ ì°¾ì•„ì„œ replace í…ìŠ¤íŠ¸ë¡œ ì±„ìš°ê¸°
        productData.results.forEach(opt => {
          if (opt[targetOption] === '') {
            opt[targetOption] = replace;
            count++;
          }
        });
        showAlert(`${count}ê°œ ë¹ˆ í•­ëª©ì„ '${replace}'(ìœ¼)ë¡œ ì±„ì› ìŠµë‹ˆë‹¤.`, 'success');
      } else {
        // ì¼ë°˜ ì°¾ê¸°/ë°”ê¾¸ê¸°
        productData.results.forEach(opt => {
          if (opt[targetOption] && opt[targetOption].includes(find)) {
            opt[targetOption] = opt[targetOption].replace(new RegExp(find, 'g'), replace);
            count++;
          }
        });
        showAlert(`${count}ê°œ í•­ëª©ì´ ì¹˜í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
      }

      renderOptions();
    }

    // ì´ë¦„ ë§¤í•‘ ë‹¤ì´ì–¼ë¡œê·¸ ì—´ê¸°
    function openMappingDialog() {
      const targetOption = document.getElementById('mappingTargetOption').value;
      const optionLabel = targetOption === 'optionName1' ? 'ì˜µì…˜1' : 'ì˜µì…˜2';

      // ìœ ë‹ˆí¬í•œ ê°’ ì¶”ì¶œ
      const uniqueValues = [];
      const seen = new Set();

      productData.results.forEach(opt => {
        const value = opt[targetOption] || '';
        if (!seen.has(value)) {
          uniqueValues.push(value);
          seen.add(value);
        }
      });

      // ë§¤í•‘ í–‰ ìƒì„±
      const mappingRows = document.getElementById('mappingRows');
      mappingRows.innerHTML = '';

      uniqueValues.forEach(value => {
        const row = document.createElement('div');
        row.className = 'mapping-row';
        row.innerHTML = `
          <input type="text" value="${value || '(ë¹ˆ ê°’)'}" readonly>
          <span>â†’</span>
          <input type="text" value="${value}" data-old-value="${value}" placeholder="ìƒˆ ê°’ ì…ë ¥">
        `;
        mappingRows.appendChild(row);
      });

      // ì œëª© ì—…ë°ì´íŠ¸
      document.getElementById('mappingDialogTitle').textContent = `${optionLabel} ì´ë¦„ ë§¤í•‘`;

      // ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
      document.getElementById('mappingDialog').classList.add('active');
    }

    // ì´ë¦„ ë§¤í•‘ ì ìš©
    function applyMapping() {
      const targetOption = document.getElementById('mappingTargetOption').value;
      const mappingRows = document.querySelectorAll('#mappingRows .mapping-row');

      const mapping = {};
      mappingRows.forEach(row => {
        const inputs = row.querySelectorAll('input');
        const oldValue = inputs[1].dataset.oldValue;
        const newValue = inputs[1].value.trim();

        if (newValue && oldValue !== newValue) {
          mapping[oldValue] = newValue;
        }
      });

      // ë§¤í•‘ ì ìš©
      let count = 0;
      productData.results.forEach(opt => {
        const currentValue = opt[targetOption] || '';
        if (mapping.hasOwnProperty(currentValue)) {
          opt[targetOption] = mapping[currentValue];
          count++;
        }
      });

      renderOptions();
      closeMappingDialog();

      showAlert(`${count}ê°œ í•­ëª©ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }

    // ì´ë¦„ ë§¤í•‘ ë‹¤ì´ì–¼ë¡œê·¸ ë‹«ê¸°
    function closeMappingDialog() {
      document.getElementById('mappingDialog').classList.remove('active');
    }

    // ìˆœë²ˆ ë¶€ì—¬
    function applyNumbering() {
      const targetOption = document.getElementById('numberingTargetOption').value;
      const prefix = document.getElementById('numberingPrefix').value.trim();
      const type = document.getElementById('numberingType').value;

      // ìœ ë‹ˆí¬í•œ ê°’ ì¶”ì¶œ
      const uniqueValues = [];
      const seen = new Set();

      productData.results.forEach(opt => {
        const value = opt[targetOption] || '';
        if (!seen.has(value)) {
          uniqueValues.push(value);
          seen.add(value);
        }
      });

      // ìˆœë²ˆ ìƒì„±
      const mapping = {};
      uniqueValues.forEach((value, index) => {
        let suffix;
        if (type === 'number') {
          suffix = (index + 1).toString();
        } else {
          // ì•ŒíŒŒë²³ (A, B, C, ... Z, AA, AB, ...)
          suffix = numberToLetter(index);
        }
        mapping[value] = prefix + suffix;
      });

      // ì ìš©
      let count = 0;
      productData.results.forEach(opt => {
        const currentValue = opt[targetOption] || '';
        if (mapping.hasOwnProperty(currentValue)) {
          opt[targetOption] = mapping[currentValue];
          count++;
        }
      });

      renderOptions();
      showAlert(`${count}ê°œ í•­ëª©ì— ìˆœë²ˆì´ ë¶€ì—¬ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }

    // ìˆ«ìë¥¼ ì•ŒíŒŒë²³ìœ¼ë¡œ ë³€í™˜ (0=A, 1=B, ..., 25=Z, 26=AA, ...)
    function numberToLetter(num) {
      let result = '';
      num = num + 1; // 1ë¶€í„° ì‹œì‘

      while (num > 0) {
        const remainder = (num - 1) % 26;
        result = String.fromCharCode(65 + remainder) + result;
        num = Math.floor((num - 1) / 26);
      }

      return result;
    }

    // ìë™ ë²ˆì—­
    // silent: trueì¼ ê²½ìš° í™•ì¸ì°½ ë° ì•Œë¦¼ ì—†ì´ ìë™ ì‹¤í–‰ (ë¡œë“œì‹œ ì‚¬ìš©)
    async function autoTranslate(silent = false) {
      if (!silent && !confirm('ì¤‘êµ­ì–´ë¥¼ ìë™ ë²ˆì—­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }

      try {
        // ë²ˆì—­ì´ í•„ìš”í•œ í…ìŠ¤íŠ¸ë§Œ ìˆ˜ì§‘ (ì¤‘ë³µ ì œê±°)
        const textsToTranslate = new Set();

        // ìƒí’ˆëª… ë²ˆì—­ ëŒ€ìƒ
        if (productData.titleCn && productData.titleCn.trim() && (!productData.title || !productData.title.trim())) {
          textsToTranslate.add(productData.titleCn);
        }

        // ì˜µì…˜ëª… ë²ˆì—­ ëŒ€ìƒ
        if (productData.results && Array.isArray(productData.results)) {
          productData.results.forEach(opt => {
            // í•œêµ­ì–´ ì˜µì…˜1ì´ ë¹„ì–´ìˆê³  ì¤‘êµ­ì–´ê°€ ìˆìœ¼ë©´ ë²ˆì—­ ëŒ€ìƒ
            if (opt.optionName1Cn && opt.optionName1Cn.trim() && (!opt.optionName1 || !opt.optionName1.trim())) {
              textsToTranslate.add(opt.optionName1Cn);
            }
            // í•œêµ­ì–´ ì˜µì…˜2ê°€ ë¹„ì–´ìˆê³  ì¤‘êµ­ì–´ê°€ ìˆìœ¼ë©´ ë²ˆì—­ ëŒ€ìƒ
            if (opt.optionName2Cn && opt.optionName2Cn.trim() && (!opt.optionName2 || !opt.optionName2.trim())) {
              textsToTranslate.add(opt.optionName2Cn);
            }
          });
        }

        if (textsToTranslate.size === 0) {
          if (!silent) {
            showAlert('ë²ˆì—­í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
          }
          return;
        }

        if (silent) {
          console.log(`[ìë™ ë²ˆì—­] ${textsToTranslate.size}ê°œ í•­ëª© ë²ˆì—­ ì¤‘...`);
        }

        const response = await fetch('/api/translate/batch', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ texts: Array.from(textsToTranslate) })
        });

        if (!response.ok) throw new Error('ë²ˆì—­ ì‹¤íŒ¨');

        const data = await response.json();
        const translationMap = data.results || {};

        // ë²ˆì—­ ê²°ê³¼ ì ìš© (ë¹ˆ í•„ë“œë§Œ)
        let count = 0;

        // ìƒí’ˆëª… ë²ˆì—­ ì ìš©
        if (productData.titleCn && translationMap[productData.titleCn]) {
          if (!productData.title || !productData.title.trim()) {
            productData.title = translationMap[productData.titleCn];
            document.getElementById('productTitle').value = productData.title;
            count++;
          }
        }

        // ì˜µì…˜ëª… ë²ˆì—­ ì ìš©
        if (productData.results && Array.isArray(productData.results)) {
          productData.results.forEach(opt => {
            if (opt.optionName1Cn && translationMap[opt.optionName1Cn]) {
              if (!opt.optionName1 || !opt.optionName1.trim()) {
                opt.optionName1 = translationMap[opt.optionName1Cn];
                count++;
              }
            }
            if (opt.optionName2Cn && translationMap[opt.optionName2Cn]) {
              if (!opt.optionName2 || !opt.optionName2.trim()) {
                opt.optionName2 = translationMap[opt.optionName2Cn];
                count++;
              }
            }
          });
        }

        renderOptions();

        if (silent) {
          console.log(`[ìë™ ë²ˆì—­] ${count}ê°œ í•„ë“œ ë²ˆì—­ ì™„ë£Œ`);
        } else {
          showAlert(`${count}ê°œ í•„ë“œì˜ ë²ˆì—­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }
      } catch (error) {
        console.error('ë²ˆì—­ ì˜¤ë¥˜:', error);
        if (!silent) {
          showAlert('ë²ˆì—­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        }
      }
    }

    // ë§¤ì§ ë¸ŒëŸ¬ì‰¬ ì—´ê¸°
    function openMagicBrush(imageSrc, optionIndexes = null) {
      if (!imageSrc) return;

      // ì›ë³¸ URL ë° ì˜µì…˜ ì¸ë±ìŠ¤ ì €ì¥
      currentEditingImageUrl = imageSrc;
      currentEditingOptionIndexes = optionIndexes;

      currentEditingImage = new Image();
      currentEditingImage.crossOrigin = 'anonymous';
      currentEditingImage.onload = function() {
        // ì›ë³¸ í¬ê¸°ë¡œ ìº”ë²„ìŠ¤ ì„¤ì •
        canvas.width = this.width;
        canvas.height = this.height;
        ctx.drawImage(this, 0, 0);

        originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

        // ìº”ë²„ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        setupCanvasEvents();

        document.getElementById('magicBrushModal').classList.add('active');
      };
      currentEditingImage.src = imageSrc;
    }

    // ìº”ë²„ìŠ¤ ì´ë²¤íŠ¸ ì„¤ì •
    function setupCanvasEvents() {
      canvas.onmousedown = startDrawing;
      canvas.onmousemove = draw;
      canvas.onmouseup = stopDrawing;
      canvas.onmouseleave = stopDrawing;

      // í„°ì¹˜ ì´ë²¤íŠ¸ë„ ì§€ì›
      canvas.ontouchstart = (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;
        startDrawing({ offsetX: x, offsetY: y });
      };

      canvas.ontouchmove = (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;
        draw({ offsetX: x, offsetY: y });
      };

      canvas.ontouchend = stopDrawing;
    }

    // ë§¤ì§ ì´ë ˆì´ì € ëª¨ë“œ í† ê¸€
    function toggleMagicEraser() {
      isMagicErasing = !isMagicErasing;
      isErasing = false;

      const magicBtn = document.getElementById('magicEraserBtn');
      const eraserBtn = document.getElementById('eraserBtn');

      if (isMagicErasing) {
        magicBtn.classList.add('active');
        eraserBtn.classList.remove('active');
        canvas.classList.add('eraser-mode');

        // ë§ˆìŠ¤í¬ ìº”ë²„ìŠ¤ ìƒì„±
        if (!maskCanvas) {
          maskCanvas = document.createElement('canvas');
          maskCanvas.width = canvas.width;
          maskCanvas.height = canvas.height;
          maskCtx = maskCanvas.getContext('2d');
        }
      } else {
        magicBtn.classList.remove('active');
        canvas.classList.remove('eraser-mode');
      }
    }

    // ì¼ë°˜ ì§€ìš°ê°œ ëª¨ë“œ í† ê¸€
    function toggleEraser() {
      isErasing = !isErasing;
      isMagicErasing = false;

      const btn = document.getElementById('eraserBtn');
      const magicBtn = document.getElementById('magicEraserBtn');

      if (isErasing) {
        btn.classList.add('active');
        magicBtn.classList.remove('active');
        canvas.classList.add('eraser-mode');
      } else {
        btn.classList.remove('active');
        canvas.classList.remove('eraser-mode');
      }
    }

    // ë¸ŒëŸ¬ì‹œ í¬ê¸° ì—…ë°ì´íŠ¸
    function updateBrushSize() {
      brushSize = parseInt(document.getElementById('brushSizeSlider').value);
      document.getElementById('brushSizeValue').textContent = brushSize;
    }

    // ë“œë¡œì‰ ì‹œì‘
    function startDrawing(e) {
      if (!isErasing && !isMagicErasing) return;
      isDrawing = true;
      [lastX, lastY] = [e.offsetX, e.offsetY];
    }

    // ë“œë¡œì‰
    function draw(e) {
      if (!isDrawing) return;

      if (isErasing) {
        // ì¼ë°˜ ì§€ìš°ê°œ: íˆ¬ëª…í•˜ê²Œ
        ctx.globalCompositeOperation = 'destination-out';
        ctx.lineWidth = brushSize;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
      } else if (isMagicErasing) {
        // ë§¤ì§ ì´ë ˆì´ì €: ë§ˆìŠ¤í¬ì— ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œ
        // ë§ˆìŠ¤í¬ ìº”ë²„ìŠ¤ì— ê·¸ë¦¬ê¸°
        maskCtx.strokeStyle = 'rgba(255, 0, 0, 0.5)';
        maskCtx.lineWidth = brushSize;
        maskCtx.lineCap = 'round';
        maskCtx.lineJoin = 'round';

        maskCtx.beginPath();
        maskCtx.moveTo(lastX, lastY);
        maskCtx.lineTo(e.offsetX, e.offsetY);
        maskCtx.stroke();

        // ìº”ë²„ìŠ¤ì—ë„ í‘œì‹œ (ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ê¸° ìœ„í•´)
        ctx.save();
        ctx.globalAlpha = 0.5;
        ctx.strokeStyle = 'red';
        ctx.lineWidth = brushSize;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
        ctx.restore();
      }

      [lastX, lastY] = [e.offsetX, e.offsetY];
    }

    // ë“œë¡œì‰ ì¤‘ì§€
    function stopDrawing() {
      isDrawing = false;
      if (isErasing) {
        ctx.globalCompositeOperation = 'source-over'; // ì¼ë°˜ ëª¨ë“œë¡œ ë³µê·€
      }
    }

    // ë§¤ì§ ì´ë ˆì´ì € ì ìš© (OpenCV Inpainting API ì‚¬ìš©)
    async function applyMagicEraser() {
      if (!isMagicErasing || !maskCanvas) {
        alert('ë§¤ì§ ì´ë ˆì´ì € ëª¨ë“œë¥¼ í™œì„±í™”í•˜ê³  ì œê±°í•  ì˜ì—­ì„ ë“œë˜ê·¸í•˜ì„¸ìš”.');
        return;
      }

      if (!confirm('ì„ íƒí•œ ì˜ì—­ì„ AIë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì±„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }

      showAlert('AI ë§¤ì§ ì´ë ˆì´ì € ì²˜ë¦¬ ì¤‘... (5-10ì´ˆ ì†Œìš”)', 'success');

      try {
        // ì›ë³¸ ì´ë¯¸ì§€ë¥¼ Base64ë¡œ ë³€í™˜
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;
        const tempCtx = tempCanvas.getContext('2d');
        tempCtx.putImageData(originalImageData, 0, 0);
        const imageBase64 = tempCanvas.toDataURL('image/png');

        // ë§ˆìŠ¤í¬ë¥¼ Base64ë¡œ ë³€í™˜
        const maskBase64 = maskCanvas.toDataURL('image/png');

        console.log('[Magic Eraser] API í˜¸ì¶œ ì‹œì‘...');

        // API í˜¸ì¶œ
        const response = await fetch('/api/magic-erase', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            image: imageBase64,
            mask: maskBase64,
            method: 'telea' // 'telea' (ë¹ ë¦„) ë˜ëŠ” 'ns' (ëŠë¦¬ì§€ë§Œ ë” ìì—°ìŠ¤ëŸ¬ì›€)
          })
        });

        if (!response.ok) {
          throw new Error('ë§¤ì§ ì´ë ˆì´ì € API í˜¸ì¶œ ì‹¤íŒ¨');
        }

        const result = await response.json();

        if (!result.success) {
          throw new Error(result.message || 'ì²˜ë¦¬ ì‹¤íŒ¨');
        }

        console.log('[Magic Eraser] ì„±ê³µ!');

        // ê²°ê³¼ ì´ë¯¸ì§€ ë¡œë“œ
        const resultImg = new Image();
        resultImg.onload = () => {
          canvas.width = resultImg.width;
          canvas.height = resultImg.height;
          ctx.drawImage(resultImg, 0, 0);

          // ìƒˆë¡œìš´ originalImageData ì €ì¥
          originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

          // ë§ˆìŠ¤í¬ ì´ˆê¸°í™”
          maskCtx.clearRect(0, 0, maskCanvas.width, maskCanvas.height);

          showAlert('AI ë§¤ì§ ì´ë ˆì´ì € ì™„ë£Œ!', 'success');
        };
        resultImg.onerror = () => {
          showAlert('ê²°ê³¼ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨', 'error');
        };
        resultImg.src = result.result;

      } catch (error) {
        console.error('[Magic Eraser] ì˜¤ë¥˜:', error);
        showAlert('ë§¤ì§ ì´ë ˆì´ì € ì²˜ë¦¬ ì‹¤íŒ¨: ' + error.message, 'error');
      }
    }

    // ì¸í˜ì¸íŒ… ì•Œê³ ë¦¬ì¦˜ (ê°„ë‹¨í•œ ë²„ì „)
    function performInpainting(imageData, maskData) {
      const data = imageData.data;
      const mask = maskData.data;
      const width = imageData.width;
      const height = imageData.height;

      // ë§ˆìŠ¤í¬ëœ í”½ì…€ ì°¾ê¸°
      const maskedPixels = [];
      for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
          const i = (y * width + x) * 4;
          if (mask[i] > 0) { // ë¹¨ê°„ìƒ‰ ë§ˆìŠ¤í¬
            maskedPixels.push({ x, y, i });
          }
        }
      }

      // ê° ë§ˆìŠ¤í¬ëœ í”½ì…€ì„ ì£¼ë³€ í”½ì…€ì˜ í‰ê· ìœ¼ë¡œ ì±„ìš°ê¸°
      maskedPixels.forEach(pixel => {
        const neighbors = [];
        const radius = 3;

        for (let dy = -radius; dy <= radius; dy++) {
          for (let dx = -radius; dx <= radius; dx++) {
            const nx = pixel.x + dx;
            const ny = pixel.y + dy;

            if (nx >= 0 && nx < width && ny >= 0 && ny < height) {
              const ni = (ny * width + nx) * 4;

              // ë§ˆìŠ¤í¬ë˜ì§€ ì•Šì€ í”½ì…€ë§Œ ì‚¬ìš©
              if (mask[ni] === 0) {
                neighbors.push({
                  r: data[ni],
                  g: data[ni + 1],
                  b: data[ni + 2]
                });
              }
            }
          }
        }

        // í‰ê·  ê³„ì‚°
        if (neighbors.length > 0) {
          const avgR = neighbors.reduce((sum, p) => sum + p.r, 0) / neighbors.length;
          const avgG = neighbors.reduce((sum, p) => sum + p.g, 0) / neighbors.length;
          const avgB = neighbors.reduce((sum, p) => sum + p.b, 0) / neighbors.length;

          data[pixel.i] = avgR;
          data[pixel.i + 1] = avgG;
          data[pixel.i + 2] = avgB;
          data[pixel.i + 3] = 255; // ë¶ˆíˆ¬ëª…
        }
      });

      // ì—¬ëŸ¬ ë²ˆ ë°˜ë³µí•´ì„œ ë” ìì—°ìŠ¤ëŸ½ê²Œ
      for (let iter = 0; iter < 3; iter++) {
        maskedPixels.forEach(pixel => {
          const neighbors = [];
          const radius = 2;

          for (let dy = -radius; dy <= radius; dy++) {
            for (let dx = -radius; dx <= radius; dx++) {
              if (dx === 0 && dy === 0) continue;

              const nx = pixel.x + dx;
              const ny = pixel.y + dy;

              if (nx >= 0 && nx < width && ny >= 0 && ny < height) {
                const ni = (ny * width + nx) * 4;
                neighbors.push({
                  r: data[ni],
                  g: data[ni + 1],
                  b: data[ni + 2]
                });
              }
            }
          }

          if (neighbors.length > 0) {
            const avgR = neighbors.reduce((sum, p) => sum + p.r, 0) / neighbors.length;
            const avgG = neighbors.reduce((sum, p) => sum + p.g, 0) / neighbors.length;
            const avgB = neighbors.reduce((sum, p) => sum + p.b, 0) / neighbors.length;

            data[pixel.i] = avgR;
            data[pixel.i + 1] = avgG;
            data[pixel.i + 2] = avgB;
          }
        });
      }
    }

    // ìº”ë²„ìŠ¤ ì „ì²´ ì§€ìš°ê¸°
    function clearCanvas() {
      if (confirm('ìº”ë²„ìŠ¤ë¥¼ ì „ì²´ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    }

    // ë§¤ì§ ë¸ŒëŸ¬ì‰¬ ë‹«ê¸°
    function closeMagicBrush() {
      document.getElementById('magicBrushModal').classList.remove('active');

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
      canvas.onmousedown = null;
      canvas.onmousemove = null;
      canvas.onmouseup = null;
      canvas.onmouseleave = null;
      canvas.ontouchstart = null;
      canvas.ontouchmove = null;
      canvas.ontouchend = null;

      // ìƒíƒœ ì´ˆê¸°í™”
      isErasing = false;
      isMagicErasing = false;
      isDrawing = false;
      currentEditingImage = null;
      currentEditingImageUrl = null;
      currentEditingOptionIndexes = null;
      originalImageData = null;

      // ë§ˆìŠ¤í¬ ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
      if (maskCanvas) {
        maskCtx.clearRect(0, 0, maskCanvas.width, maskCanvas.height);
      }

      // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
      const eraserBtn = document.getElementById('eraserBtn');
      const magicBtn = document.getElementById('magicEraserBtn');
      if (eraserBtn) eraserBtn.classList.remove('active');
      if (magicBtn) magicBtn.classList.remove('active');
      canvas.classList.remove('eraser-mode');

      // ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
      document.getElementById('brightnessSlider').value = 0;
      document.getElementById('contrastSlider').value = 0;
      document.getElementById('brightnessValue').textContent = 0;
      document.getElementById('contrastValue').textContent = 0;
      document.getElementById('brushSizeSlider').value = 20;
      document.getElementById('brushSizeValue').textContent = 20;
      brushSize = 20;
    }

    // ë°°ê²½ ì œê±° (ê°„ë‹¨í•œ ë²„ì „)
    function removeBackground() {
      if (!originalImageData) return;

      alert('ë°°ê²½ ì œê±° ê¸°ëŠ¥ì€ ì¶”í›„ ê³ ê¸‰ AI ëª¨ë¸ì„ ì—°ë™í•˜ì—¬ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.\ní˜„ì¬ëŠ” ì‹œë®¬ë ˆì´ì…˜ ë²„ì „ì…ë‹ˆë‹¤.');

      // ì‹¤ì œë¡œëŠ” remove.bg APIë‚˜ rembg ê°™ì€ ë„êµ¬ í•„ìš”
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;

      // ê°„ë‹¨í•œ ë°°ê²½ ì œê±° ì‹œë®¬ë ˆì´ì…˜ (í°ìƒ‰ ë°°ê²½ ì œê±°)
      for (let i = 0; i < data.length; i += 4) {
        const r = data[i];
        const g = data[i + 1];
        const b = data[i + 2];

        // ë°ì€ ìƒ‰ìƒì„ íˆ¬ëª…í•˜ê²Œ
        if (r > 240 && g > 240 && b > 240) {
          data[i + 3] = 0; // ì•ŒíŒŒê°’ì„ 0ìœ¼ë¡œ
        }
      }

      ctx.putImageData(imageData, 0, 0);
    }

    // í¬ê¸° ì¡°ì •
    function resizeImage(width, height) {
      if (!currentEditingImage) return;

      canvas.width = width;
      canvas.height = height;

      ctx.drawImage(currentEditingImage, 0, 0, width, height);
      showAlert(`ì´ë¯¸ì§€ í¬ê¸°ê°€ ${width}x${height}ë¡œ ì¡°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }

    // ë°ê¸° ì¡°ì •
    function adjustBrightness() {
      if (!originalImageData) return;

      const brightness = parseInt(document.getElementById('brightnessSlider').value);
      document.getElementById('brightnessValue').textContent = brightness;

      const imageData = ctx.createImageData(originalImageData);
      const data = imageData.data;
      const origData = originalImageData.data;

      for (let i = 0; i < data.length; i += 4) {
        data[i] = Math.min(255, Math.max(0, origData[i] + brightness));
        data[i + 1] = Math.min(255, Math.max(0, origData[i + 1] + brightness));
        data[i + 2] = Math.min(255, Math.max(0, origData[i + 2] + brightness));
        data[i + 3] = origData[i + 3];
      }

      ctx.putImageData(imageData, 0, 0);
    }

    // ëŒ€ë¹„ ì¡°ì •
    function adjustContrast() {
      if (!originalImageData) return;

      const contrast = parseInt(document.getElementById('contrastSlider').value);
      document.getElementById('contrastValue').textContent = contrast;

      const factor = (259 * (contrast + 255)) / (255 * (259 - contrast));

      const imageData = ctx.createImageData(originalImageData);
      const data = imageData.data;
      const origData = originalImageData.data;

      for (let i = 0; i < data.length; i += 4) {
        data[i] = Math.min(255, Math.max(0, factor * (origData[i] - 128) + 128));
        data[i + 1] = Math.min(255, Math.max(0, factor * (origData[i + 1] - 128) + 128));
        data[i + 2] = Math.min(255, Math.max(0, factor * (origData[i + 2] - 128) + 128));
        data[i + 3] = origData[i + 3];
      }

      ctx.putImageData(imageData, 0, 0);
    }

    // í•„í„° ì ìš©
    function applyFilter(filterType) {
      if (!originalImageData) return;

      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;

      switch (filterType) {
        case 'grayscale':
          for (let i = 0; i < data.length; i += 4) {
            const gray = (data[i] + data[i + 1] + data[i + 2]) / 3;
            data[i] = data[i + 1] = data[i + 2] = gray;
          }
          break;
        case 'sepia':
          for (let i = 0; i < data.length; i += 4) {
            const r = data[i], g = data[i + 1], b = data[i + 2];
            data[i] = Math.min(255, r * 0.393 + g * 0.769 + b * 0.189);
            data[i + 1] = Math.min(255, r * 0.349 + g * 0.686 + b * 0.168);
            data[i + 2] = Math.min(255, r * 0.272 + g * 0.534 + b * 0.131);
          }
          break;
      }

      ctx.putImageData(imageData, 0, 0);
      showAlert(`${filterType} í•„í„°ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }

    // ì´ë¯¸ì§€ ì´ˆê¸°í™”
    function resetImage() {
      if (!originalImageData) return;
      ctx.putImageData(originalImageData, 0, 0);
      document.getElementById('brightnessSlider').value = 0;
      document.getElementById('contrastSlider').value = 0;
      document.getElementById('brightnessValue').textContent = 0;
      document.getElementById('contrastValue').textContent = 0;
    }

    // í¸ì§‘ëœ ì´ë¯¸ì§€ ì €ì¥
    function saveEditedImage() {
      if (!currentEditingImageUrl) {
        showAlert('ì €ì¥í•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
        return;
      }

      // í¸ì§‘ëœ ì´ë¯¸ì§€ë¥¼ Base64ë¡œ ë³€í™˜
      const editedImageDataURL = canvas.toDataURL('image/png');

      // ì›ë³¸ ì´ë¯¸ì§€ URLê³¼ ê°™ì€ imageLinkë¥¼ ê°€ì§„ ëª¨ë“  ì˜µì…˜ ì°¾ì•„ì„œ ì—…ë°ì´íŠ¸
      let updateCount = 0;
      productData.results.forEach(option => {
        if (option.imageLink === currentEditingImageUrl) {
          option.imageLink = editedImageDataURL;
          updateCount++;
        }
      });

      // mainImageë„ ê°™ì€ URLì´ë©´ ì—…ë°ì´íŠ¸
      if (productData.mainImage === currentEditingImageUrl) {
        productData.mainImage = editedImageDataURL;
        document.getElementById('mainImagePreview').src = editedImageDataURL;
      }

      // images ë°°ì—´ë„ í™•ì¸
      if (productData.images && productData.images.length > 0) {
        productData.images = productData.images.map(img =>
          img === currentEditingImageUrl ? editedImageDataURL : img
        );

        // ì¶”ê°€ ì´ë¯¸ì§€ ê·¸ë¦¬ë“œ ë‹¤ì‹œ ë Œë”ë§
        const additionalGrid = document.getElementById('additionalImagesGrid');
        additionalGrid.innerHTML = '';
        productData.images.forEach(img => {
          const imgEl = document.createElement('img');
          imgEl.src = img;
          imgEl.onclick = () => openMagicBrush(img);
          imgEl.onerror = function() { this.style.display = 'none'; };
          additionalGrid.appendChild(imgEl);
        });
      }

      // ì˜µì…˜ í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
      renderOptions();

      // ëª¨ë‹¬ ë‹«ê¸°
      closeMagicBrush();

      showAlert(`${updateCount}ê°œ ì˜µì…˜ì˜ ì´ë¯¸ì§€ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. ë³€ê²½ì‚¬í•­ì„ ì €ì¥í•˜ë ¤ë©´ ìƒë‹¨ì˜ "ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.`, 'success');
    }

    // detailPageItemsë¥¼ HTML ë¬¸ìì—´ë¡œ ë³€í™˜
    function generateDetailPageHtml(items) {
      if (!items || items.length === 0) {
        return '';
      }

      let html = '<div style="max-width: 800px; margin: 0 auto; font-family: Arial, sans-serif;">\n';

      items.forEach(item => {
        if (item.type === 'brand-image') {
          html += `  <img src="${item.imageSrc}" style="width: 100%; margin-bottom: 0;">\n`;
        }
        else if (item.type === 'title') {
          const text = item.text || 'ì œí’ˆëª…';
          html += `  <div style="font-size: 24px; font-weight: 700; text-align: center; padding: 30px 20px; color: #333;">\n`;
          html += `    ${text}\n`;
          html += `  </div>\n`;
        }
        else if (item.type === 'image') {
          const layout = item.layout || 'presentation';

          if (layout === 'presentation') {
            const align = item.align || 'center';
            const justifyContent = align === 'left' ? 'flex-start' : align === 'right' ? 'flex-end' : 'center';
            const maxWidth = align === 'center' ? '100%' : '50%';

            html += `  <div style="display: flex; justify-content: ${justifyContent}; margin: 20px 0; padding: 0 20px;">\n`;
            html += `    <img src="${item.imageSrc}" style="max-width: ${maxWidth}; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">\n`;
            html += `  </div>\n`;
          }
        }
        else if (item.type === 'text') {
          const text = item.text || '';
          html += `  <div style="padding: 20px; font-size: 15px; line-height: 1.8; color: #666;">\n`;
          html += `    ${text}\n`;
          html += `  </div>\n`;
        }
        else if (item.type === 'quality-table') {
          const title = item.title || 'í’ˆì§ˆ ì •ë³´';
          html += `  <div style="margin: 20px 0; padding: 20px; background: #f9f9f9; border-radius: 8px;">\n`;
          html += `    <h3 style="font-size: 18px; margin-bottom: 15px; color: #333;">${title}</h3>\n`;
          html += `    <table style="width: 100%; border-collapse: collapse;">\n`;

          if (item.rows && item.rows.length > 0) {
            item.rows.forEach(row => {
              html += `      <tr style="border-bottom: 1px solid #e0e0e0;">\n`;
              html += `        <td style="padding: 12px; font-weight: 600; color: #555; width: 30%;">${row.label || ''}</td>\n`;
              html += `        <td style="padding: 12px; color: #666;">${row.value || ''}</td>\n`;
              html += `      </tr>\n`;
            });
          }

          html += `    </table>\n`;
          html += `  </div>\n`;
        }
        else if (item.type === 'option-block') {
          const imageSrc = item.imageSrc || '';
          const optionName = item.optionName || '';
          const option2List = item.option2List || '';
          const template = item.template || 'horizontal';

          // í…œí”Œë¦¿ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ì„¤ì •
          let containerStyle = '';
          let imageContainerStyle = '';
          let textContainerStyle = '';
          let titleStyle = '';
          let listStyle = '';

          switch (template) {
            case 'gradient':
              containerStyle = 'margin: 20px 0; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; display: flex; align-items: center; gap: 30px;';
              imageContainerStyle = 'flex: 0 0 300px; border-radius: 8px; overflow: hidden;';
              textContainerStyle = 'flex: 1; color: #fff;';
              titleStyle = 'font-size: 24px; font-weight: 700; margin-bottom: 15px; color: #fff;';
              listStyle = 'font-size: 14px; line-height: 1.8; color: rgba(255, 255, 255, 0.9);';
              break;

            case 'modern':
              containerStyle = 'margin: 20px 0; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; display: flex; align-items: center; gap: 30px;';
              imageContainerStyle = 'flex: 0 0 300px; border-radius: 8px; overflow: hidden;';
              textContainerStyle = 'flex: 1; color: #fff;';
              titleStyle = 'font-size: 24px; font-weight: 700; margin-bottom: 15px; color: #fff;';
              listStyle = 'font-size: 14px; line-height: 1.8; color: rgba(255, 255, 255, 0.9);';
              break;

            case 'neon':
              containerStyle = 'margin: 20px 0; padding: 30px; background: linear-gradient(135deg, #ff0080 0%, #ff8c00 100%); border-radius: 12px; display: flex; align-items: center; gap: 30px;';
              imageContainerStyle = 'flex: 0 0 300px; border-radius: 8px; overflow: hidden;';
              textContainerStyle = 'flex: 1; color: #fff;';
              titleStyle = 'font-size: 24px; font-weight: 700; margin-bottom: 15px; color: #fff;';
              listStyle = 'font-size: 14px; line-height: 1.8; color: rgba(255, 255, 255, 0.9);';
              break;

            case 'ocean':
              containerStyle = 'margin: 20px 0; padding: 30px; background: linear-gradient(135deg, #2193b0 0%, #6dd5ed 100%); border-radius: 12px; display: flex; align-items: center; gap: 30px;';
              imageContainerStyle = 'flex: 0 0 300px; border-radius: 8px; overflow: hidden;';
              textContainerStyle = 'flex: 1; color: #fff;';
              titleStyle = 'font-size: 24px; font-weight: 700; margin-bottom: 15px; color: #fff;';
              listStyle = 'font-size: 14px; line-height: 1.8; color: rgba(255, 255, 255, 0.9);';
              break;

            case 'vertical':
              containerStyle = 'margin: 20px 0; padding: 30px; background: #f9f9f9; border-radius: 12px;';
              imageContainerStyle = 'margin-bottom: 20px; border-radius: 8px; overflow: hidden;';
              textContainerStyle = 'text-align: center;';
              titleStyle = 'font-size: 22px; font-weight: 700; margin-bottom: 15px; color: #333;';
              listStyle = 'font-size: 14px; line-height: 1.8; color: #666;';
              break;

            case 'card':
              containerStyle = 'margin: 20px 0; padding: 25px; background: #fff; border: 2px solid #e5e8eb; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); display: flex; align-items: center; gap: 25px;';
              imageContainerStyle = 'flex: 0 0 280px; border-radius: 8px; overflow: hidden;';
              textContainerStyle = 'flex: 1;';
              titleStyle = 'font-size: 22px; font-weight: 700; margin-bottom: 15px; color: #333;';
              listStyle = 'font-size: 14px; line-height: 1.8; color: #666;';
              break;

            default: // horizontal
              containerStyle = 'margin: 20px 0; padding: 25px; background: #f9f9f9; border-radius: 12px; display: flex; align-items: center; gap: 25px;';
              imageContainerStyle = 'flex: 0 0 280px; border-radius: 8px; overflow: hidden;';
              textContainerStyle = 'flex: 1;';
              titleStyle = 'font-size: 22px; font-weight: 700; margin-bottom: 15px; color: #333;';
              listStyle = 'font-size: 14px; line-height: 1.8; color: #666;';
          }

          html += `  <div style="${containerStyle}">\n`;

          // ì´ë¯¸ì§€
          if (imageSrc) {
            html += `    <div style="${imageContainerStyle}">\n`;
            html += `      <img src="${imageSrc}" style="width: 100%; height: auto; display: block;">\n`;
            html += `    </div>\n`;
          }

          // í…ìŠ¤íŠ¸ ì˜ì—­
          html += `    <div style="${textContainerStyle}">\n`;
          html += `      <h3 style="${titleStyle}">${optionName}</h3>\n`;

          // ì˜µì…˜2 ëª©ë¡ì„ ì‰¼í‘œë¡œ ë¶„ë¦¬í•´ì„œ ë¦¬ìŠ¤íŠ¸ë¡œ í‘œì‹œ
          if (option2List) {
            const options = option2List.split(',').map(opt => opt.trim()).filter(opt => opt);
            if (options.length > 0) {
              html += `      <div style="${listStyle}">\n`;
              options.forEach(opt => {
                html += `        â€¢ ${opt}<br>\n`;
              });
              html += `      </div>\n`;
            }
          }

          html += `    </div>\n`;
          html += `  </div>\n`;
        }
      });

      html += '</div>\n';
      return html;
    }

    // ìƒí’ˆ ì €ì¥
    async function saveProduct() {
      productData.title = document.getElementById('productTitle').value;

      if (!productData.title && !productData.titleCn) {
        showAlert('ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
        return;
      }

      // detailPageItemsë¥¼ ì €ì¥ (í¸ì§‘ê¸° ìƒíƒœ ìœ ì§€ìš©)
      productData.detailPageItems = detailPageItems;

      // detailPageItemsë¥¼ HTMLë¡œ ë³€í™˜í•´ì„œ productData.detailHtmlì— ì €ì¥ (ì´ë¯¸ì§€ ìƒì„±ìš©)
      if (detailPageItems && detailPageItems.length > 0) {
        productData.detailHtml = generateDetailPageHtml(detailPageItems);
        console.log('[Save] detailPageItems ì €ì¥ (' + detailPageItems.length + 'ê°œ) ë° HTML ìƒì„± ì™„ë£Œ (' + productData.detailHtml.length + 'ì)');
      } else {
        console.log('[Save] detailPageItemsê°€ ë¹„ì–´ìˆìŒ, detailHtml ìœ ì§€');
      }

      try {
        const url = productId ? `/api/products/${productId}` : '/api/products/save';
        const method = productId ? 'PUT' : 'POST';

        const response = await fetch(url, {
          method: method,
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify(productData)
        });

        if (!response.ok) {
          throw new Error('ì €ì¥ ì‹¤íŒ¨');
        }

        const data = await response.json();
        productId = data.id || data.product.id;

        showAlert('ìƒí’ˆì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');

        if (!window.location.search.includes('id=')) {
          window.history.pushState({}, '', `?id=${productId}`);
        }
      } catch (error) {
        console.error('ì €ì¥ ì˜¤ë¥˜:', error);
        showAlert('ìƒí’ˆ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    }

    // ì•Œë¦¼ í‘œì‹œ
    function showAlert(message, type) {
      const container = document.getElementById('alertContainer');
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.textContent = message;
      container.appendChild(alert);

      setTimeout(() => {
        alert.remove();
      }, 5000);
    }

    // AI ì´ë¯¸ì§€ í¸ì§‘ ëª¨ë‹¬ ì—´ê¸°
    async function openAIImageEditor(imageType) {
      // ì´ë¯¸ì§€ íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ ì´ë¯¸ì§€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
      let imagesToEdit = [];

      if (imageType === 'additional') {
        // ì¶”ê°€ ì´ë¯¸ì§€ë“¤
        imagesToEdit = productData.images || [];
      } else if (imageType === 'option') {
        // ì˜µì…˜ ì´ë¯¸ì§€ë“¤ (ìœ ë‹ˆí¬ ê°’ë§Œ)
        const uniqueOptionImages = new Set();
        productData.results.forEach(option => {
          const imgSrc = option.imageLink || option.titleImage?.[0] || '';
          if (imgSrc) {
            uniqueOptionImages.add(imgSrc);
          }
        });
        imagesToEdit = Array.from(uniqueOptionImages);
      }

      if (imagesToEdit.length === 0) {
        showAlert('í¸ì§‘í•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
        return;
      }

      // AI ì´ë¯¸ì§€ í¸ì§‘ ëª¨ë‹¬ HTML
      const modalHTML = `
        <div id="ai-image-modal" style="
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.7);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10000;
        ">
          <div style="
            background: white;
            border-radius: 16px;
            max-width: 1200px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
          ">
            <!-- í—¤ë” -->
            <div style="
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 24px 32px;
              border-radius: 16px 16px 0 0;
            ">
              <h2 style="margin: 0; font-size: 24px;">ğŸ¨ AI ì´ë¯¸ì§€ í¸ì§‘</h2>
              <p style="margin: 8px 0 0 0; opacity: 0.9; font-size: 14px;">
                Gemini AIë¡œ ì´ë¯¸ì§€ë¥¼ ìë™ìœ¼ë¡œ í¸ì§‘í•©ë‹ˆë‹¤
              </p>
            </div>

            <!-- ë³¸ë¬¸ -->
            <div style="padding: 32px;">
              <!-- í”„ë¡¬í”„íŠ¸ ì„¹ì…˜ -->
              <div style="margin-bottom: 24px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">
                  AI í”„ë¡¬í”„íŠ¸
                </label>
                <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px;">
                  <button class="btn btn-secondary" onclick="setAIPrompt('remove the background')" style="font-size: 12px; padding: 6px 12px;">ë°°ê²½ ì œê±°</button>
                  <button class="btn btn-secondary" onclick="setAIPrompt('make the product image more professional and clean')" style="font-size: 12px; padding: 6px 12px;">ì „ë¬¸ì ìœ¼ë¡œ</button>
                  <button class="btn btn-secondary" onclick="setAIPrompt('enhance the lighting and colors')" style="font-size: 12px; padding: 6px 12px;">ìƒ‰ìƒ ê°œì„ </button>
                  <button class="btn btn-secondary" onclick="setAIPrompt('center the product and add white background')" style="font-size: 12px; padding: 6px 12px;">ì¤‘ì•™ ì •ë ¬ + í° ë°°ê²½</button>
                </div>
                <textarea id="ai-prompt-input" style="
                  width: 100%;
                  padding: 12px;
                  border: 2px solid #e1e5e9;
                  border-radius: 8px;
                  font-size: 14px;
                  min-height: 80px;
                  resize: vertical;
                " placeholder="AIì—ê²Œ ì–´ë–»ê²Œ ì´ë¯¸ì§€ë¥¼ í¸ì§‘í•˜ê¸¸ ì›í•˜ëŠ”ì§€ ì„¤ëª…í•˜ì„¸ìš”...">remove the background and make it professional for e-commerce</textarea>
              </div>

              <!-- ì´ë¯¸ì§€ ì„ íƒ -->
              <div style="margin-bottom: 24px;">
                <label style="display: block; font-weight: 600; margin-bottom: 12px; color: #333;">
                  í¸ì§‘í•  ì´ë¯¸ì§€ ì„ íƒ (í´ë¦­í•˜ì—¬ ì„ íƒ)
                </label>
                <div id="ai-images-grid" style="
                  display: grid;
                  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                  gap: 12px;
                ">
                  ${imagesToEdit.map((img, idx) => `
                    <div class="ai-image-item" data-index="${idx}" onclick="toggleAIImageSelection(${idx})" style="
                      position: relative;
                      cursor: pointer;
                      border-radius: 8px;
                      overflow: hidden;
                      border: 3px solid #e1e5e9;
                      transition: all 0.2s;
                    ">
                      <img src="${img}" style="
                        width: 100%;
                        aspect-ratio: 1;
                        object-fit: cover;
                        display: block;
                      ">
                    </div>
                  `).join('')}
                </div>
              </div>

              <!-- ì§„í–‰ ìƒí™© -->
              <div id="ai-progress" style="display: none; margin-bottom: 24px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
                <div style="font-weight: 600; margin-bottom: 8px;">ì§„í–‰ ì¤‘...</div>
                <div id="ai-progress-text" style="color: #666; font-size: 14px;">ì¤€ë¹„ ì¤‘...</div>
              </div>

              <!-- ë²„íŠ¼ -->
              <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeAIImageModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="startAIImageGeneration('${imageType}')">
                  ì„ íƒí•œ ì´ë¯¸ì§€ AI í¸ì§‘ ì‹œì‘
                </button>
              </div>
            </div>
          </div>
        </div>
      `;

      // ëª¨ë‹¬ ì¶”ê°€
      document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    // AI ì´ë¯¸ì§€ ëª¨ë‹¬ ë‹«ê¸°
    function closeAIImageModal() {
      const modal = document.getElementById('ai-image-modal');
      if (modal) {
        modal.remove();
      }
      selectedAIImages.clear();
    }

    // AI í”„ë¡¬í”„íŠ¸ ì„¤ì •
    function setAIPrompt(text) {
      document.getElementById('ai-prompt-input').value = text;
    }

    // ì„ íƒëœ AI ì´ë¯¸ì§€ ì¶”ì 
    let selectedAIImages = new Set();

    // AI ì´ë¯¸ì§€ ì„ íƒ í† ê¸€
    function toggleAIImageSelection(index) {
      const item = document.querySelector(`.ai-image-item[data-index="${index}"]`);

      if (selectedAIImages.has(index)) {
        selectedAIImages.delete(index);
        item.style.borderColor = '#e1e5e9';
        item.style.boxShadow = 'none';
      } else {
        selectedAIImages.add(index);
        item.style.borderColor = '#4CAF50';
        item.style.boxShadow = '0 0 0 3px rgba(76, 175, 80, 0.2)';
      }
    }

    // AI ì´ë¯¸ì§€ ìƒì„± ì‹œì‘
    async function startAIImageGeneration(imageType) {
      if (selectedAIImages.size === 0) {
        showAlert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
        return;
      }

      const prompt = document.getElementById('ai-prompt-input').value.trim();
      if (!prompt) {
        showAlert('í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }

      // ì§„í–‰ ìƒí™© í‘œì‹œ
      const progressDiv = document.getElementById('ai-progress');
      const progressText = document.getElementById('ai-progress-text');
      progressDiv.style.display = 'block';

      let imagesToEdit = [];
      if (imageType === 'additional') {
        imagesToEdit = productData.images || [];
      } else if (imageType === 'option') {
        const uniqueOptionImages = new Set();
        productData.results.forEach(option => {
          const imgSrc = option.imageLink || option.titleImage?.[0] || '';
          if (imgSrc) {
            uniqueOptionImages.add(imgSrc);
          }
        });
        imagesToEdit = Array.from(uniqueOptionImages);
      }

      let successCount = 0;
      let failCount = 0;

      for (const index of selectedAIImages) {
        try {
          const imageUrl = imagesToEdit[index];
          progressText.textContent = `ì²˜ë¦¬ ì¤‘: ${successCount + failCount + 1}/${selectedAIImages.size}`;

          // ì´ë¯¸ì§€ë¥¼ Base64ë¡œ ë³€í™˜
          const imageData = await imageUrlToBase64(imageUrl);

          // Gemini API í˜¸ì¶œ
          const response = await fetch('/api/gemini/generate-image', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              imageData,
              prompt,
              productName: productData.title
            })
          });

          const result = await response.json();

          if (result.success) {
            // ìƒì„±ëœ ì´ë¯¸ì§€ë¡œ êµì²´
            if (imageType === 'additional') {
              productData.images[index] = result.imageData;
            } else if (imageType === 'option') {
              // ì˜µì…˜ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
              const oldUrl = imagesToEdit[index];
              productData.results.forEach(option => {
                const optionImgSrc = option.imageLink || option.titleImage?.[0] || '';
                if (optionImgSrc === oldUrl) {
                  if (option.imageLink) {
                    option.imageLink = result.imageData;
                  } else if (option.titleImage && option.titleImage.length > 0) {
                    option.titleImage[0] = result.imageData;
                  }
                }
              });
            }
            successCount++;
          } else {
            failCount++;
            console.error(`ì´ë¯¸ì§€ ${index + 1} ìƒì„± ì‹¤íŒ¨:`, result.message);
          }

        } catch (error) {
          failCount++;
          console.error(`ì´ë¯¸ì§€ ${index + 1} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:`, error);
        }
      }

      // ì™„ë£Œ
      progressDiv.style.display = 'none';
      closeAIImageModal();

      showAlert(
        `AI ì´ë¯¸ì§€ í¸ì§‘ ì™„ë£Œ! ì„±ê³µ: ${successCount}ê°œ, ì‹¤íŒ¨: ${failCount}ê°œ`,
        failCount === 0 ? 'success' : 'warning'
      );

      // í™”ë©´ ìƒˆë¡œê³ ì¹¨
      if (successCount > 0) {
        // ì´ë¯¸ì§€ íƒ­ ë‹¤ì‹œ ë Œë”ë§
        refreshImageTabs();
      }
    }

    // ì´ë¯¸ì§€ íƒ­ ìƒˆë¡œê³ ì¹¨
    function refreshImageTabs() {
      // ì¶”ê°€ ì´ë¯¸ì§€ íƒ­ ìƒˆë¡œê³ ì¹¨
      const additionalGridTab = document.getElementById('additionalImagesGridTab');
      additionalGridTab.innerHTML = '';

      const allImages = [];
      if (productData.mainImage) {
        allImages.push(productData.mainImage);
      }
      if (productData.images && productData.images.length > 0) {
        allImages.push(...productData.images);
      }

      if (allImages.length > 0) {
        allImages.forEach(img => {
          const container = document.createElement('div');
          container.className = 'image-item-container additional-image-item';
          container.setAttribute('data-additional-image', img);

          if (selectedAdditionalImages.has(img)) {
            container.classList.add('selected');
          }

          const imgElement = document.createElement('img');
          imgElement.src = img;
          imgElement.onerror = function() {
            this.parentElement.innerHTML = '<div style="padding: 20px; background: #f5f5f5; text-align: center; border-radius: 6px;">ğŸ“·</div>';
          };

          const editBtn = document.createElement('button');
          editBtn.className = 'image-edit-btn';
          editBtn.textContent = 'í¸ì§‘';
          editBtn.onclick = (e) => {
            e.stopPropagation();
            openMagicBrush(img, null);
          };

          container.onclick = (e) => {
            if (!e.target.classList.contains('image-edit-btn')) {
              toggleAdditionalImageSelection(img, e);
            }
          };

          container.appendChild(imgElement);
          container.appendChild(editBtn);
          additionalGridTab.appendChild(container);
        });
      } else {
        additionalGridTab.innerHTML = '<p style="color: #888; padding: 20px;">ì¶”ê°€ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
      }

      // ì˜µì…˜ ì´ë¯¸ì§€ íƒ­ ìƒˆë¡œê³ ì¹¨
      renderUniqueOptionImages();
    }

    // ì´ë¯¸ì§€ URLì„ Base64ë¡œ ë³€í™˜
    async function imageUrlToBase64(url) {
      // Data URLì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ë°˜í™˜
      if (url.startsWith('data:')) {
        return url;
      }

      const response = await fetch(url);
      const blob = await response.blob();
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(blob);
      });
    }
  </script>
</body>
</html>

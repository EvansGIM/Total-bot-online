<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>TotalBot - ë°œì£¼ ë¦¬ìŠ¤íŠ¸</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f6f7;
      color: #333;
    }

    /* Sidebar Styles */
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 999;
    }

    .sidebar-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: -280px;
      width: 280px;
      height: 100%;
      background: #1a1a2e;
      transition: left 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
    }

    .sidebar.active {
      left: 0;
    }

    .sidebar-header {
      padding: 24px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .sidebar-header h2 {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .sidebar-header p {
      font-size: 12px;
      opacity: 0.8;
    }

    .sidebar-menu {
      padding: 16px 0;
    }

    .sidebar-menu-title {
      padding: 12px 20px 8px;
      font-size: 11px;
      font-weight: 600;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .sidebar-menu-item {
      display: flex;
      align-items: center;
      padding: 14px 20px;
      color: #ccc;
      text-decoration: none;
      font-size: 14px;
      transition: all 0.2s;
      cursor: pointer;
      border-left: 3px solid transparent;
    }

    .sidebar-menu-item:hover {
      background: rgba(255, 255, 255, 0.08);
      color: white;
    }

    .sidebar-menu-item.active {
      background: rgba(102, 126, 234, 0.2);
      color: #667eea;
      border-left-color: #667eea;
    }

    .sidebar-menu-item .menu-icon {
      width: 24px;
      margin-right: 12px;
      font-size: 18px;
      text-align: center;
    }

    .sidebar-divider {
      height: 1px;
      background: rgba(255, 255, 255, 0.1);
      margin: 12px 20px;
    }

    /* Hamburger Button */
    .hamburger-btn {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 40px;
      height: 40px;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      transition: background 0.2s;
    }

    .hamburger-btn:hover {
      background: #f0f0f0;
    }

    .hamburger-btn span {
      display: block;
      width: 22px;
      height: 2px;
      background: #333;
      margin: 2px 0;
      border-radius: 1px;
    }

    .header {
      background: white;
      border-bottom: 1px solid #e5e8eb;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }

    /* Cards */
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 24px;
      margin-bottom: 24px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title .icon {
      font-size: 22px;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .stat-card .stat-icon {
      font-size: 28px;
      margin-bottom: 12px;
    }

    .stat-card .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #333;
    }

    .stat-card .stat-label {
      font-size: 13px;
      color: #888;
      margin-top: 4px;
    }

    .stat-card.primary { border-left: 4px solid #667eea; }
    .stat-card.success { border-left: 4px solid #10b981; }
    .stat-card.warning { border-left: 4px solid #f59e0b; }
    .stat-card.danger { border-left: 4px solid #ef4444; }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    /* Filters */
    .filters {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-group label {
      font-size: 13px;
      font-weight: 600;
      color: #555;
    }

    .filter-group select,
    .filter-group input {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
    }

    /* Table */
    .table-container {
      overflow-x: auto;
    }

    .order-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .order-table th {
      background: #f9fafb;
      padding: 14px 12px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #e5e8eb;
      white-space: nowrap;
    }

    .order-table td {
      padding: 14px 12px;
      border-bottom: 1px solid #f0f0f0;
    }

    .order-table tr:hover {
      background: #f9fafb;
    }

    .order-table .checkbox-cell {
      width: 40px;
      text-align: center;
    }

    /* Badge */
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .badge-pending { background: #fef3c7; color: #92400e; }
    .badge-confirmed { background: #d1fae5; color: #065f46; }
    .badge-processing { background: #dbeafe; color: #1e40af; }
    .badge-completed { background: #d1fae5; color: #065f46; }
    .badge-rejected { background: #fee2e2; color: #991b1b; }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-top: 20px;
    }

    .pagination button {
      padding: 8px 16px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
    }

    .pagination button:hover {
      background: #f0f0f0;
    }

    .pagination button.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .pagination button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #888;
    }

    .empty-state .icon {
      font-size: 64px;
      margin-bottom: 16px;
    }

    .empty-state h3 {
      font-size: 18px;
      color: #333;
      margin-bottom: 8px;
    }

    /* Toast */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }

    .toast {
      padding: 12px 20px;
      border-radius: 8px;
      margin-bottom: 8px;
      font-size: 14px;
      animation: slideIn 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .toast.success { background: #10b981; color: white; }
    .toast.error { background: #ef4444; color: white; }
    .toast.warning { background: #f59e0b; color: white; }
    .toast.info { background: #3b82f6; color: white; }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Action Buttons in Table */
    .action-btn {
      padding: 4px 8px;
      font-size: 11px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 4px;
    }

    .action-btn.view { background: #e0e7ff; color: #4338ca; }
    .action-btn.download { background: #d1fae5; color: #065f46; }
    .action-btn.delete { background: #fee2e2; color: #991b1b; }

    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .filters {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>TotalBot</h2>
      <p>ì¿ íŒ¡ ìë™í™” í”Œë«í¼</p>
    </div>

    <div class="sidebar-menu">
      <div class="sidebar-menu-title">ìƒí’ˆ ê´€ë¦¬</div>
      <a class="sidebar-menu-item" href="products.html">
        <span class="menu-icon">ğŸ“¦</span>
        ìˆ˜ì§‘ ìƒí’ˆ
      </a>
      <a class="sidebar-menu-item" href="uploaded.html">
        <span class="menu-icon">ğŸš€</span>
        ì—…ë¡œë“œ ì™„ë£Œ
      </a>
      <a class="sidebar-menu-item" href="quotations.html">
        <span class="menu-icon">ğŸ“‹</span>
        ê²¬ì ì„œ ê´€ë¦¬
      </a>

      <div class="sidebar-divider"></div>

      <div class="sidebar-menu-title">ë°œì£¼ ê´€ë¦¬</div>
      <a class="sidebar-menu-item" href="orders.html">
        <span class="menu-icon">ğŸ›’</span>
        ìë™ ë°œì£¼
      </a>
      <a class="sidebar-menu-item active" href="order-list.html">
        <span class="menu-icon">ğŸ“‘</span>
        ë°œì£¼ ë¦¬ìŠ¤íŠ¸
      </a>
      <a class="sidebar-menu-item" href="shipments.html">
        <span class="menu-icon">ğŸšš</span>
        ë°°ì†¡ ê´€ë¦¬
      </a>

      <div class="sidebar-divider"></div>

      <div class="sidebar-menu-title">ë¶„ì„/ì„¤ì •</div>
      <a class="sidebar-menu-item" href="settlement.html">
        <span class="menu-icon">ğŸ’°</span>
        ì •ì‚°
      </a>
      <a class="sidebar-menu-item" href="settings.html">
        <span class="menu-icon">âš™ï¸</span>
        ì„¤ì •
      </a>
    </div>
  </nav>

  <div class="header">
    <div class="header-left">
      <button class="hamburger-btn" onclick="toggleSidebar()" title="ë©”ë‰´">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <h1>ë°œì£¼ ë¦¬ìŠ¤íŠ¸</h1>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" onclick="refreshOrders()">
        <span>ğŸ”„</span> ìƒˆë¡œê³ ì¹¨
      </button>
      <button class="btn btn-primary" onclick="exportOrders()">
        <span>ğŸ“¥</span> ë‚´ë³´ë‚´ê¸°
      </button>
    </div>
  </div>

  <div class="container">
    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card primary">
        <div class="stat-icon">ğŸ“‹</div>
        <div class="stat-value" id="totalOrders">0</div>
        <div class="stat-label">ì „ì²´ ë°œì£¼</div>
      </div>
      <div class="stat-card warning">
        <div class="stat-icon">â³</div>
        <div class="stat-value" id="pendingOrders">0</div>
        <div class="stat-label">ë¯¸í™•ì •</div>
      </div>
      <div class="stat-card success">
        <div class="stat-icon">âœ…</div>
        <div class="stat-value" id="confirmedOrders">0</div>
        <div class="stat-label">í™•ì • ì™„ë£Œ</div>
      </div>
      <div class="stat-card danger">
        <div class="stat-icon">âŒ</div>
        <div class="stat-value" id="rejectedOrders">0</div>
        <div class="stat-label">ë°˜ë ¤</div>
      </div>
    </div>

    <!-- Filters and Table -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          <span class="icon">ğŸ“‘</span>
          ë°œì£¼ ëª©ë¡
        </div>
        <div>
          <button class="btn btn-danger" onclick="deleteSelected()" id="deleteBtn" disabled>
            ì„ íƒ ì‚­ì œ
          </button>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters">
        <div class="filter-group">
          <label>ìƒíƒœ</label>
          <select id="filterStatus" onchange="applyFilters()">
            <option value="">ì „ì²´</option>
            <option value="pending">ë¯¸í™•ì •</option>
            <option value="confirmed">í™•ì • ì™„ë£Œ</option>
            <option value="processing">ì²˜ë¦¬ ì¤‘</option>
            <option value="rejected">ë°˜ë ¤</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ì„¼í„°</label>
          <select id="filterCenter" onchange="applyFilters()">
            <option value="">ì „ì²´</option>
            <option value="GMK1">GMK1</option>
            <option value="GMK2">GMK2</option>
            <option value="GMK3">GMK3</option>
            <option value="GMK4">GMK4</option>
            <option value="GMK5">GMK5</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ê¸°ê°„</label>
          <input type="date" id="filterStartDate" onchange="applyFilters()">
          <span>~</span>
          <input type="date" id="filterEndDate" onchange="applyFilters()">
        </div>
        <div class="filter-group">
          <label>ê²€ìƒ‰</label>
          <input type="text" id="searchQuery" placeholder="ë°œì£¼ë²ˆí˜¸, ìƒí’ˆëª…..." onkeyup="applyFilters()">
        </div>
      </div>

      <!-- Table -->
      <div class="table-container">
        <table class="order-table">
          <thead>
            <tr>
              <th class="checkbox-cell">
                <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
              </th>
              <th>ë°œì£¼ë²ˆí˜¸</th>
              <th>ìƒíƒœ</th>
              <th>ë¬¼ë¥˜ì„¼í„°</th>
              <th>ì…ê³ ì˜ˆì •ì¼</th>
              <th>ìƒí’ˆëª…</th>
              <th>ë°”ì½”ë“œ</th>
              <th>ìˆ˜ëŸ‰</th>
              <th>ë§¤ì…ê°€</th>
              <th>ê³µê¸‰ê°€</th>
              <th>ë§ˆì§„</th>
              <th>ì²˜ë¦¬ì¼ì‹œ</th>
              <th>ì‘ì—…</th>
            </tr>
          </thead>
          <tbody id="orderTableBody">
            <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div class="empty-state" id="emptyState" style="display: none;">
        <div class="icon">ğŸ“‹</div>
        <h3>ë°œì£¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
        <p>ìë™ ë°œì£¼ë¥¼ ì‹¤í–‰í•˜ë©´ ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
      </div>

      <!-- Pagination -->
      <div class="pagination" id="pagination">
        <button onclick="changePage(-1)" id="prevBtn" disabled>ì´ì „</button>
        <span id="pageInfo">1 / 1</span>
        <button onclick="changePage(1)" id="nextBtn" disabled>ë‹¤ìŒ</button>
      </div>
    </div>
  </div>

  <script>
    // ë²„ì „ í™•ì¸
    console.log('ğŸ”„ TotalBot ë°œì£¼ ë¦¬ìŠ¤íŠ¸ v2025-11-27');

    // ìƒíƒœ ë³€ìˆ˜
    let allOrders = [];
    let filteredOrders = [];
    let currentPage = 1;
    const pageSize = 20;
    let selectedOrders = new Set();

    // ì‚¬ì´ë“œë°” í† ê¸€
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
    }

    // Toast ì•Œë¦¼
    function showToast(message, type = 'info', duration = 4000) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      container.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease forwards';
        setTimeout(() => toast.remove(), 300);
      }, duration);
    }

    // ë°œì£¼ ë°ì´í„° ë¡œë“œ
    async function loadOrders() {
      try {
        // ì„œë²„ì—ì„œ ë°œì£¼ ë°ì´í„° ë¡œë“œ ì‹œë„
        const response = await fetch('/api/orders');
        if (response.ok) {
          allOrders = await response.json();
        } else {
          // ëª©ì—… ë°ì´í„° ì‚¬ìš©
          allOrders = generateMockOrders();
        }
      } catch (e) {
        console.log('ì„œë²„ ì—°ê²° ì‹¤íŒ¨, ëª©ì—… ë°ì´í„° ì‚¬ìš©');
        allOrders = generateMockOrders();
      }

      updateStats();
      applyFilters();
    }

    // í†µê³„ ì—…ë°ì´íŠ¸
    function updateStats() {
      const total = allOrders.length;
      const pending = allOrders.filter(o => o.status === 'pending' || o.status === 'ë¯¸í™•ì •').length;
      const confirmed = allOrders.filter(o => o.status === 'confirmed' || o.status === 'í™•ì •').length;
      const rejected = allOrders.filter(o => o.status === 'rejected' || o.status === 'ë°˜ë ¤').length;

      document.getElementById('totalOrders').textContent = total;
      document.getElementById('pendingOrders').textContent = pending;
      document.getElementById('confirmedOrders').textContent = confirmed;
      document.getElementById('rejectedOrders').textContent = rejected;
    }

    // í•„í„° ì ìš©
    function applyFilters() {
      const status = document.getElementById('filterStatus').value;
      const center = document.getElementById('filterCenter').value;
      const startDate = document.getElementById('filterStartDate').value;
      const endDate = document.getElementById('filterEndDate').value;
      const query = document.getElementById('searchQuery').value.toLowerCase();

      filteredOrders = allOrders.filter(order => {
        // ìƒíƒœ í•„í„°
        if (status && order.status !== status && !order.status.includes(status)) {
          return false;
        }

        // ì„¼í„° í•„í„°
        if (center && order.center !== center) {
          return false;
        }

        // ë‚ ì§œ í•„í„°
        if (startDate && order.expectedDate < startDate.replace(/-/g, '')) {
          return false;
        }
        if (endDate && order.expectedDate > endDate.replace(/-/g, '')) {
          return false;
        }

        // ê²€ìƒ‰ì–´ í•„í„°
        if (query) {
          const searchFields = [
            order.poNumber,
            order.productName,
            order.barcode,
            order.center
          ].map(f => (f || '').toLowerCase());

          if (!searchFields.some(f => f.includes(query))) {
            return false;
          }
        }

        return true;
      });

      currentPage = 1;
      renderTable();
    }

    // í…Œì´ë¸” ë Œë”ë§
    function renderTable() {
      const tbody = document.getElementById('orderTableBody');
      const emptyState = document.getElementById('emptyState');

      if (filteredOrders.length === 0) {
        tbody.innerHTML = '';
        emptyState.style.display = 'block';
        document.getElementById('pagination').style.display = 'none';
        return;
      }

      emptyState.style.display = 'none';
      document.getElementById('pagination').style.display = 'flex';

      // í˜ì´ì§•
      const startIdx = (currentPage - 1) * pageSize;
      const endIdx = startIdx + pageSize;
      const pageOrders = filteredOrders.slice(startIdx, endIdx);
      const totalPages = Math.ceil(filteredOrders.length / pageSize);

      // í…Œì´ë¸” ë Œë”ë§
      tbody.innerHTML = pageOrders.map(order => `
        <tr>
          <td class="checkbox-cell">
            <input type="checkbox" value="${order.id}" onchange="toggleSelect('${order.id}')" ${selectedOrders.has(order.id) ? 'checked' : ''}>
          </td>
          <td><strong>${order.poNumber || '-'}</strong></td>
          <td>${getStatusBadge(order.status)}</td>
          <td>${order.center || '-'}</td>
          <td>${formatDate(order.expectedDate)}</td>
          <td>${order.productName || '-'}</td>
          <td><code>${order.barcode || '-'}</code></td>
          <td>${order.quantity || 0}</td>
          <td>${formatNumber(order.purchasePrice)}ì›</td>
          <td>${formatNumber(order.supplyPrice)}ì›</td>
          <td style="color: ${order.margin >= 0 ? '#10b981' : '#ef4444'}">
            ${formatNumber(order.margin)}ì›
          </td>
          <td>${formatDateTime(order.processedAt)}</td>
          <td>
            <button class="action-btn view" onclick="viewOrder('${order.id}')">ìƒì„¸</button>
            <button class="action-btn download" onclick="downloadOrder('${order.id}')">ë‹¤ìš´</button>
          </td>
        </tr>
      `).join('');

      // í˜ì´ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
      document.getElementById('pageInfo').textContent = `${currentPage} / ${totalPages}`;
      document.getElementById('prevBtn').disabled = currentPage <= 1;
      document.getElementById('nextBtn').disabled = currentPage >= totalPages;
    }

    // ìƒíƒœ ë±ƒì§€
    function getStatusBadge(status) {
      const badges = {
        'pending': '<span class="badge badge-pending">ë¯¸í™•ì •</span>',
        'ë¯¸í™•ì •': '<span class="badge badge-pending">ë¯¸í™•ì •</span>',
        'confirmed': '<span class="badge badge-confirmed">í™•ì •</span>',
        'í™•ì •': '<span class="badge badge-confirmed">í™•ì •</span>',
        'processing': '<span class="badge badge-processing">ì²˜ë¦¬ì¤‘</span>',
        'rejected': '<span class="badge badge-rejected">ë°˜ë ¤</span>',
        'ë°˜ë ¤': '<span class="badge badge-rejected">ë°˜ë ¤</span>'
      };
      return badges[status] || `<span class="badge">${status}</span>`;
    }

    // ë‚ ì§œ í¬ë§·
    function formatDate(dateStr) {
      if (!dateStr) return '-';
      const d = String(dateStr);
      if (d.length === 8) {
        return `${d.substring(0, 4)}-${d.substring(4, 6)}-${d.substring(6, 8)}`;
      }
      return d;
    }

    // ë‚ ì§œì‹œê°„ í¬ë§·
    function formatDateTime(dateStr) {
      if (!dateStr) return '-';
      try {
        const d = new Date(dateStr);
        return d.toLocaleString('ko-KR');
      } catch (e) {
        return dateStr;
      }
    }

    // ìˆ«ì í¬ë§·
    function formatNumber(num) {
      if (num === null || num === undefined) return '0';
      return Number(num).toLocaleString('ko-KR');
    }

    // í˜ì´ì§€ ë³€ê²½
    function changePage(delta) {
      const totalPages = Math.ceil(filteredOrders.length / pageSize);
      const newPage = currentPage + delta;

      if (newPage >= 1 && newPage <= totalPages) {
        currentPage = newPage;
        renderTable();
      }
    }

    // ì „ì²´ ì„ íƒ í† ê¸€
    function toggleSelectAll() {
      const selectAll = document.getElementById('selectAll').checked;
      const checkboxes = document.querySelectorAll('#orderTableBody input[type="checkbox"]');

      checkboxes.forEach(cb => {
        cb.checked = selectAll;
        if (selectAll) {
          selectedOrders.add(cb.value);
        } else {
          selectedOrders.delete(cb.value);
        }
      });

      updateDeleteButton();
    }

    // ê°œë³„ ì„ íƒ í† ê¸€
    function toggleSelect(id) {
      if (selectedOrders.has(id)) {
        selectedOrders.delete(id);
      } else {
        selectedOrders.add(id);
      }
      updateDeleteButton();
    }

    // ì‚­ì œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateDeleteButton() {
      document.getElementById('deleteBtn').disabled = selectedOrders.size === 0;
    }

    // ì„ íƒ ì‚­ì œ
    async function deleteSelected() {
      if (selectedOrders.size === 0) return;

      if (!confirm(`${selectedOrders.size}ê°œì˜ ë°œì£¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }

      // TODO: ì„œë²„ API í˜¸ì¶œ
      allOrders = allOrders.filter(o => !selectedOrders.has(o.id));
      selectedOrders.clear();

      updateStats();
      applyFilters();
      showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
    }

    // ë°œì£¼ ìƒì„¸ ë³´ê¸°
    function viewOrder(id) {
      const order = allOrders.find(o => o.id === id);
      if (order) {
        alert(JSON.stringify(order, null, 2));
      }
    }

    // ë°œì£¼ ë‹¤ìš´ë¡œë“œ
    function downloadOrder(id) {
      showToast('ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
    }

    // ìƒˆë¡œê³ ì¹¨
    async function refreshOrders() {
      showToast('ìƒˆë¡œê³ ì¹¨ ì¤‘...', 'info');
      await loadOrders();
      showToast('ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ', 'success');
    }

    // ë‚´ë³´ë‚´ê¸°
    function exportOrders() {
      // CSV ë‚´ë³´ë‚´ê¸°
      const headers = ['ë°œì£¼ë²ˆí˜¸', 'ìƒíƒœ', 'ë¬¼ë¥˜ì„¼í„°', 'ì…ê³ ì˜ˆì •ì¼', 'ìƒí’ˆëª…', 'ë°”ì½”ë“œ', 'ìˆ˜ëŸ‰', 'ë§¤ì…ê°€', 'ê³µê¸‰ê°€', 'ë§ˆì§„'];
      const rows = filteredOrders.map(o => [
        o.poNumber,
        o.status,
        o.center,
        formatDate(o.expectedDate),
        o.productName,
        o.barcode,
        o.quantity,
        o.purchasePrice,
        o.supplyPrice,
        o.margin
      ]);

      const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
      const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = `ë°œì£¼ë¦¬ìŠ¤íŠ¸_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();

      showToast('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
    }

    // ëª©ì—… ë°ì´í„° ìƒì„±
    function generateMockOrders() {
      const centers = ['GMK1', 'GMK2', 'GMK3', 'GMK4', 'GMK5'];
      const statuses = ['pending', 'confirmed', 'processing', 'rejected'];
      const products = ['ìŠ¤ë§ˆíŠ¸í° ì¼€ì´ìŠ¤', 'USB ì¼€ì´ë¸”', 'ë¬´ì„  ì´ì–´í°', 'ë³´ì¡°ë°°í„°ë¦¬', 'LED ì¡°ëª…'];
      const orders = [];

      for (let i = 1; i <= 50; i++) {
        const purchasePrice = 10000 + Math.floor(Math.random() * 20000);
        const supplyPrice = purchasePrice + Math.floor(Math.random() * 10000);

        const baseDate = new Date();
        baseDate.setDate(baseDate.getDate() + Math.floor(Math.random() * 14) - 7);

        orders.push({
          id: `order_${i}`,
          poNumber: `PO-2025${String(i).padStart(6, '0')}`,
          status: statuses[Math.floor(Math.random() * statuses.length)],
          center: centers[Math.floor(Math.random() * centers.length)],
          expectedDate: baseDate.toISOString().split('T')[0].replace(/-/g, ''),
          productName: products[Math.floor(Math.random() * products.length)],
          barcode: `R${100000 + i}`,
          quantity: Math.floor(Math.random() * 50) + 1,
          purchasePrice: purchasePrice,
          supplyPrice: supplyPrice,
          margin: supplyPrice - purchasePrice,
          processedAt: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString()
        });
      }

      return orders;
    }

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      // ë‚ ì§œ í•„í„° ê¸°ë³¸ê°’ ì„¤ì •
      const today = new Date();
      const monthAgo = new Date();
      monthAgo.setMonth(monthAgo.getMonth() - 1);

      document.getElementById('filterStartDate').value = monthAgo.toISOString().split('T')[0];
      document.getElementById('filterEndDate').value = today.toISOString().split('T')[0];

      loadOrders();
    });
  </script>
</body>
</html>
